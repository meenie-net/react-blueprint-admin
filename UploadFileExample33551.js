import{_ as It,d as St,P as Rt,G as At,H as Pt,J as wt,K as Nt,r as E,L as Ot,v as Tt,M as yt,g as ue,R as A,N as jt,j as i,O as Bt,B as Te,Q as F}from"./index33551.js";import{u as Ct,a as Dt,E as ee}from"./EnhancedFileInput33551.js";import{C as Ft}from"./card33551.js";var Ut=function(e){It(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.render=function(){var n,r=this.props,s=r.animate,a=s===void 0?!0:s,o=r.className,l=r.intent,c=r.stripes,h=c===void 0?!0:c,u=r.value,m=St(Rt,At(l),(n={},n[Pt]=!a,n[wt]=!h,n),o),d=u==null?void 0:100*Nt(u,0,1),f=d==null?void 0:d+"%";return E.createElement("div",{"aria-valuemax":100,"aria-valuemin":0,"aria-valuenow":d==null?void 0:Math.round(d),className:m,role:"progressbar"},E.createElement("div",{className:Ot,style:{width:f}}))},t.displayName="".concat(Tt,".ProgressBar"),t}(yt),_t=function(e,t,n,r,s,a,o,l){if(!e){var c;if(t===void 0)c=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var h=[n,r,s,a,o,l],u=0;c=new Error(t.replace(/%s/g,function(){return h[u++]})),c.name="Invariant Violation"}throw c.framesToPop=1,c}},Lt=_t;const P=ue(Lt);var Mt=Ht;function Ht(e,t,n){var r=null,s=null,a=n&&n.leading,o=n&&n.trailing;a==null&&(a=!0),o==null&&(o=!a),a==!0&&(o=!1);var l=function(){r&&(clearTimeout(r),r=null)},c=function(){var u=s;l(),u&&u()},h=function(){var u=a&&!r,m=this,d=arguments;if(s=function(){return e.apply(m,d)},r||(r=setTimeout(function(){if(r=null,o)return s()},t)),u)return u=!1,s()};return h.cancel=l,h.flush=c,h}const ye="__rpldy-logger-debug__",I={PENDING:"pending",ADDED:"added",PROCESSING:"processing",UPLOADING:"uploading",CANCELLED:"cancelled",FINISHED:"finished",ABORTED:"aborted",ERROR:"error"},b={PENDING:"pending",ADDED:"added",UPLOADING:"uploading",CANCELLED:"cancelled",FINISHED:"finished",ERROR:"error",ABORTED:"aborted"},O=()=>typeof window=="object"&&!!window.document;let Q=null;const je=()=>(typeof Q!="boolean"&&(Q=O()&&("location"in window&&!!~window.location.search.indexOf("rpldy_debug=true")||window[ye]===!0)),!!Q),Gt=e=>{O()&&(window[ye]=e),Q=e?!0:null},v=function(){je()&&console.log(...arguments)},$t=function(e,t){const n=function(o){for(var l=arguments.length,c=new Array(l>1?l-1:0),h=1;h<l;h++)c[h-1]=arguments[h];return new Promise((u,m)=>{const d=e(o,...c);d&&d.length?Promise.all(d).catch(m).then(f=>f&&u(!!~f.findIndex(p=>p===!1))):u(!1)})};for(var r=arguments.length,s=new Array(r>2?r-2:0),a=2;a<r;a++)s[a-2]=arguments[a];return t?n(t,...s):n};function Vt(e){return typeof e=="function"}var Qt=Vt;const j=ue(Qt),Wt=e=>{const t=[].concat(e);return n=>n.map(r=>t.map(s=>r[s]).join())},zt=(e,t,n)=>{let r=!0;const s=Wt(n);if(e&&t&&e.length===t.length){const a=s(e),o=s(t);r=!!a.find((l,c)=>l!==o[c])}return!r};function Xt(){return!0}var Yt=Xt;const y=ue(Yt),_=e=>y()?e:Object.freeze(e),he=e=>{var t;return!!e&&typeof e=="object"&&(((t=Object.getPrototypeOf(e))===null||t===void 0?void 0:t.constructor.name)==="Object"||Object.getPrototypeOf(e)===null)},Be=e=>he(e)||Array.isArray(e),Zt=(e,t)=>{const n=Object.keys(e);return t.withSymbols?n.concat(Object.getOwnPropertySymbols(e)):n},fe=function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=function(n){for(var r=arguments.length,s=new Array(r>1?r-1:0),a=1;a<r;a++)s[a-1]=arguments[a];return n&&s.length&&s.forEach(o=>{o&&Zt(o,e).forEach(l=>{const c=o[l];(!e.predicate||e.predicate(l,c))&&(typeof c<"u"||e.undefinedOverwrites)&&(Be(c)?((typeof n[l]>"u"||!he(n[l]))&&(n[l]=Array.isArray(c)?[]:{}),t(n[l],c)):n[l]=c)})}),n};return t},L=fe(),Ce=function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:L;return Be(e)?t(Array.isArray(e)?[]:{},e):e},Jt=(e,t)=>e&&Object.keys(e).reduce((n,r)=>(~t.indexOf(r)&&(n[r]=e[r]),n),{});function me(e){return!!e&&typeof e=="object"&&typeof e.then=="function"}const pe=O()&&window.requestIdleCallback,Kt=pe?window.requestIdleCallback:setTimeout,kt=pe?window.cancelIdleCallback:clearTimeout,De=function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const n=Kt(e,pe?{timeout:t}:t);return()=>kt(n)};function ve(e){return e==null}const qt=function(e,t){const n=function(o){for(var l=arguments.length,c=new Array(l>1?l-1:0),h=1;h<l;h++)c[h-1]=arguments[h];return new Promise((u,m)=>{const d=e(o,...c);d&&d.length?Promise.all(d).catch(m).then(f=>{let p;if(f)for(;ve(p)&&f.length;)p=f.pop();u(ve(p)?void 0:p)}):u()})};for(var r=arguments.length,s=new Array(r>2?r-2:0),a=2;a<r;a++)s[a-2]=arguments[a];return t?n(t,...s):n},Fe=Symbol.for("__rpldy-bi__");let be=0;const en=(e,t)=>(e.url=t,e),tn=(e,t)=>(e.file=t,e),nn=e=>e&&(e instanceof File||e instanceof Blob||!!(typeof e=="object"&&e.name&&e.type)),Ue=e=>!!(typeof e=="object"&&e.id&&e.batchId&&e[Fe]===!0),rn=function(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;const r=Ue(e);be+=r?0:1;const s=r&&e.id&&typeof e.id=="string"?e.id:`${t}.item-${be}`,a=n?b.PENDING:b.ADDED;let o={id:s,batchId:t,state:a,uploadStatus:0,completed:0,loaded:0,recycled:r,previousBatch:r?e.batchId:null};Object.defineProperty(o,Fe,{value:!0,writable:!0});const l=r?e.file||e.url:e;if(typeof l=="string")o=en(o,l);else if(nn(l))o=tn(o,l);else throw new Error(`Unknown type of file added: ${typeof l}`);return o};function sn(e,t,n){return t=an(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function an(e){var t=on(e,"string");return typeof t=="symbol"?t:String(t)}function on(e,t){if(typeof e!="object"||e===null)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t||"default");if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}class ln extends Promise{constructor(t,n){super(t),sn(this,"xhr",void 0),this.xhr=n}}const cn=(e,t)=>{t&&Object.keys(t).forEach(n=>{t[n]!==void 0&&e.setRequestHeader(n,t[n])})},dn=function(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const r=new XMLHttpRequest;return new ln((s,a)=>{var o;r.onerror=()=>a(r),r.ontimeout=()=>a(r),r.onabort=()=>a(r),r.onload=()=>s(r),r.open((n==null?void 0:n.method)||"GET",e),cn(r,n==null?void 0:n.headers),r.withCredentials=!!(n!=null&&n.withCredentials),n==null||(o=n.preSend)===null||o===void 0||o.call(n,r),r.send(t)},r)},un=e=>{let t;try{t=e.getAllResponseHeaders().trim().split(/[\r\n]+/).reduce((n,r)=>{const[s,a]=r.split(": ");return n[s]=a,n},{})}catch{v("uploady.request: failed to read response headers",e)}return t},hn=_({allowRegisterNonExistent:!0,canAddEvents:!0,canRemoveEvents:!0,collectStats:!1}),fn=(e,t)=>{if(!j(e))throw new Error(`'${t}' is not a valid function`)},mn=e=>typeof e>"u",_e=Symbol.for("__le__"),Le=Symbol.for("__le__pack__"),Me=e=>e?e[_e]:null,T=e=>{const t=Me(e);if(!t)throw new Error("Didnt find LE internal object. Something very bad happened!");return t},pn=e=>!!Me(e),He=function(e,t,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;fn(n,"cb");const s=T(e);if(!s.options.allowRegisterNonExistent&&!~s.events.indexOf(t))throw new Error(`Cannot register for event ${t.toString()} that wasn't already defined (allowRegisterNonExistent = false)`);const a=s.registry[t]||[];return a.find(o=>o.cb===n)||(a.push({name:t,cb:n,once:r}),s.registry[t]=a),()=>Qe.call(e,t,n)},Ge=(e,t)=>{const n=T(e).registry;return t?n[t]?n[t].slice():[]:Object.values(n).flat()},gn={on:bn,once:En,off:Qe,getEvents:xn},vn=()=>Object.entries(gn).reduce((e,t)=>{let[n,r]=t;return e[n]={value:r},e},{}),te={trigger:In,addEvent:Rn,removeEvent:An,hasEvent:Pn,hasEventRegistrations:wn,assign:Sn},$e=e=>Object.keys(te).reduce((t,n)=>(t[n]=te[n].bind(e),t),{target:e,...te}),Ee=function(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;const r=T(e).registry;r[t]&&(n||!r[t].length)&&delete r[t]},Ve=(e,t,n)=>{const r=T(e).registry;r[t]&&(n?(r[t]=r[t].filter(s=>s.cb!==n),Ee(e,t)):Ee(e,t,!0))};function bn(e,t){return He(this,e,t)}function En(e,t){return He(this,e,t,!0)}function Qe(e,t){Ve(this,e,t)}function xn(){return T(this).events.slice()}function In(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];const s=Ge(this,e);let a;if(s.length){var o;let l;n.length===1&&((o=n[0])===null||o===void 0?void 0:o[Le])===!0&&(l=n[0].resolve()),a=s.map(c=>{let h;return c.once&&Ve(this,e,c.cb),l?h=c.cb(...l):n.length?n.length===1?h=c.cb(n[0]):n.length===2?h=c.cb(n[0],n[1]):n.length===3?h=c.cb(n[0],n[1],n[2]):h=c.cb(...n):h=c.cb(),h}).filter(c=>!mn(c)).map(c=>me(c)?c:Promise.resolve(c))}return a&&(a.length?a:void 0)}function Sn(e){const t=T(this);return We(e,t.options,t.events,t.registry,t.stats),$e(e)}function Rn(e){const t=T(this);if(t.options.canAddEvents)if(!~t.events.indexOf(e))t.events.push(e);else throw new Error(`Event '${e}' already defined`);else throw new Error("Cannot add new events (canAddEvents = false)")}function An(e){const t=T(this);if(t.options.canRemoveEvents){const n=t.events.indexOf(e);t.events.splice(n,1)}else throw new Error("Cannot remove events (canRemoveEvents = false)")}function Pn(e){return!!~T(this).events.indexOf(e)}function wn(e){return!!Ge(this,e).length}const We=function(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{},s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};Object.defineProperties(e,{[_e]:{value:Object.seal({registry:r,events:n,options:t,stats:s})},...vn()})},ze=function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0;const r=e||{},s={...hn,...n};return pn(r)||We(r,s,t),$e(r)},Nn=e=>{const t={resolve:()=>[].concat(e())};return Object.defineProperty(t,Le,{value:!0,configurable:!1}),t},On=(e,t)=>{e.items.forEach(n=>{var r;let{id:s}=n;return(r=t[s])===null||r===void 0?void 0:r.call(t)})},Tn=e=>{Object.values(e).forEach(t=>t())},xe=(e,t,n)=>(v(`abort: aborting ${e.state} item  - `,e),n(e.id,{status:0,state:b.ABORTED,response:"aborted"}),!0),yn={[b.UPLOADING]:(e,t)=>(v("abort: aborting uploading item  - ",e),t[e.id]()),[b.ADDED]:xe,[b.PENDING]:xe},Xe=(e,t,n)=>{const r=e==null?void 0:e.state,s=!!r&&yn[r];return s?s(e,t,n):!1},Ye=(e,t,n,r)=>Xe(t[e],n,r),Ze=(e,t)=>{let n=!1;return t!==0&&t&&(n=e>=t),n},jn=(e,t,n,r,s)=>{const a=Object.values(n).flat(),o=Ze(a.length,s.fastAbortThreshold);return v(`abort: doing abort-all (${o?"fast":"normal"} abort)`),o?Tn(t):a.forEach(l=>Ye(l,e,t,r)),{isFast:o}},Bn=(e,t,n,r,s,a)=>{const o=t.fastAbortThreshold===0?0:t.fastAbortThreshold||a.fastAbortThreshold,l=Ze(r[e.id].length,o);return v(`abort: doing abort-batch on: ${e.id} (${l?"fast":"normal"} abort)`),l?On(e,n):e.items.forEach(c=>Xe(c,n,s)),{isFast:l}},Je=()=>e=>(e.update({abortAll:jn,abortBatch:Bn,abortItem:Ye}),e),z=Symbol.for("__rpldy-sstt-proxy__"),X=Symbol.for("__rpldy-sstt-state__"),M=e=>!y()&&!!e&&!!~Object.getOwnPropertySymbols(e).indexOf(z),Cn=e=>O()&&e instanceof File||e.name&&e.size&&e.uri,Ke=e=>Array.isArray(e)||he(e)&&!Cn(e),Dn=fe({withSymbols:!0,predicate:e=>e!==z&&e!==X}),ne=e=>y()?!0:e[X].isUpdateable,Ie=(e,t)=>{y()||(e[X].isUpdateable=t)},se=(e,t)=>{let n;return Ke(e)&&(M(e)||(e[z]=!0,n=new Proxy(e,t)),Object.keys(e).forEach(r=>{e[r]=se(e[r],t)})),n||e},U=e=>M(e)?Ce(e,Dn):e,Fn=e=>{const t={set:(r,s,a)=>(ne(n)&&(r[s]=se(a,t)),!0),get:(r,s)=>s===z?U(r):r[s],defineProperty:()=>{throw new Error("Simple State doesnt support defining property")},setPrototypeOf:()=>{throw new Error("Simple State doesnt support setting prototype")},deleteProperty:(r,s)=>(ne(n)&&delete r[s],!0)};!y()&&!M(e)&&Object.defineProperty(e,X,{value:{isUpdateable:!1},configurable:!0});const n=y()?e:se(e,t);return{state:n,update:r=>{if(!y()&&ne(n))throw new Error("Can't call update on State already being updated!");try{Ie(n,!0),r(n)}finally{Ie(n,!1)}return n},unwrap:r=>r?U(r):M(n)?U(n):n}},g=_({BATCH_ADD:"BATCH-ADD",BATCH_START:"BATCH-START",BATCH_PROGRESS:"BATCH_PROGRESS",BATCH_FINISH:"BATCH-FINISH",BATCH_ABORT:"BATCH-ABORT",BATCH_CANCEL:"BATCH-CANCEL",BATCH_ERROR:"BATCH-ERROR",BATCH_FINALIZE:"BATCH-FINALIZE",ITEM_START:"FILE-START",ITEM_CANCEL:"FILE-CANCEL",ITEM_PROGRESS:"FILE-PROGRESS",ITEM_FINISH:"FILE-FINISH",ITEM_ABORT:"FILE-ABORT",ITEM_ERROR:"FILE-ERROR",ITEM_FINALIZE:"FILE-FINALIZE",REQUEST_PRE_SEND:"REQUEST_PRE_SEND",ALL_ABORT:"ALL_ABORT"}),Un=50,H=_({ITEM_PROGRESS:"ITEM_PROGRESS",BATCH_PROGRESS:"BATCH_PROGRESS"}),ke=[b.FINISHED,b.ERROR,b.CANCELLED,b.ABORTED],qe=function(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;e.updateState(r=>{const{batchId:s}=r.items[t]||{batchId:null};n&&delete r.items[t];const a=s?r.itemQueue[s].indexOf(t):-1;~a&&s&&r.itemQueue[s].splice(a,1);const o=r.activeIds.indexOf(t);~o&&r.activeIds.splice(o,1)})},et=(e,t)=>!!e.getState().items[t],Y=e=>ke.includes(e.state),_n=fe({undefinedOverwrites:!0}),Ln=(e,t,n,r)=>{let s=n,a=t;if(r){if(v(`uploader.queue: REQUEST_PRE_SEND(${e}) event returned updated items/options`,r),r.items){if(r.items.length!==t.length||!zt(r.items,t,["id","batchId","recycled"]))throw new Error(`REQUEST_PRE_SEND(${e}) event handlers must return same items with same ids`);a=r.items}r.options&&(s=_n({},n,r.options))}return{items:a,options:s,cancelled:r===!1}},Mn=(e,t,n,r,s,a)=>qt(e.trigger,s,t,r).then(o=>(a==null||a(o),Ln(s,n,r,o))),Hn=(e,t)=>{if(t.items[0]&&e.getState().batches[t.items[0].batchId]){e.updateState(r=>{t.items.forEach(s=>{Y(r.items[s.id])||(r.items[s.id]=s)}),r.batches[t.items[0].batchId].batchOptions=t.options});const n=e.getState();t.items=t.items.map(r=>n.items[r.id]),t.options=n.batches[t.items[0].batchId].batchOptions}},Gn=(e,t,n,r,s,a)=>{const o=n(t),l=e.getState().batches[o[0].batchId].batchOptions,c=(r==null?void 0:r(t,l))||t;return Mn(e,c,o,l,a,s).then(h=>(h.cancelled||Hn(e,h),h))},tt=function(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;return(s,a)=>Gn(s,a,t,n,r,e)},$n=tt(g.BATCH_START,e=>e.items,null,function(){let{batch:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{batch:!1};if(e)throw new Error("BATCH_START event handlers cannot update batch data. Only items & options")}),Vn=[I.ADDED,I.PROCESSING,I.UPLOADING],Qn=[I.ABORTED,I.CANCELLED,I.FINISHED,I.ERROR],B=(e,t)=>e.batches[t].batch,Wn=(e,t)=>B(e.getState(),t),nt=(e,t)=>{const n=e.getState(),r=n.items[t];return n.batches[r.batchId]},V=(e,t)=>nt(e,t).batch,Z=(e,t)=>{Wn(e,t).items.forEach(r=>{let{id:s}=r;return qe(e,s,!0)})},J=(e,t)=>{e.updateState(n=>{delete n.batches[t],delete n.itemQueue[t];const r=n.batchQueue.indexOf(t);~r&&n.batchQueue.splice(r,1);const s=n.batchesStartPending.indexOf(t);~s&&n.batchesStartPending.splice(s,1)})},K=function(e,t,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:I.FINISHED,s=arguments.length>4?arguments[4]:void 0;e.updateState(a=>{const o=B(a,t);o.state=r,s&&(o.additionalInfo=s)}),ae(e,t,n),ae(e,t,g.BATCH_FINALIZE)},rt=(e,t)=>{v("uploady.uploader.batchHelpers: cancelling batch: ",t),K(e,t,g.BATCH_CANCEL,I.CANCELLED),Z(e,t),J(e,t)},zn=(e,t)=>{if(et(e,t)){const n=nt(e,t),r=n==null?void 0:n.batch.id;r?rt(e,r):v(`uploady.uploader.batchHelpers: cancel batch called for batch already removed (item id = ${t})`)}},Xn=(e,t,n)=>{const r=V(e,t),s=r.id;v("uploady.uploader.batchHelpers: failing batch: ",{batch:r}),K(e,s,g.BATCH_ERROR,I.ERROR,n.message),Z(e,s),J(e,s)},Yn=(e,t)=>{const n=V(e,t);return e.getState().batchesStartPending.includes(n.id)},Zn=(e,t)=>{const n=V(e,t);return e.getState().currentBatch!==n.id},Jn=(e,t)=>{const n=V(e,t);return e.updateState(r=>{r.batchesStartPending.push(n.id)}),$n(e,n).then(r=>{let{cancelled:s}=r,a=!1;return e.updateState(o=>{const l=o.batchesStartPending.indexOf(n.id);o.batchesStartPending.splice(l,1)}),s||(a=!et(e,t),a||e.updateState(o=>{o.currentBatch=n.id})),!s&&!a})},Kn=e=>{De(()=>{const t=e.getState();Object.keys(t.batches).forEach(n=>{const{batch:r,finishedCounter:s}=t.batches[n],{orgItemCount:a}=r,o=st(r);a===s&&(!o&&r.completed!==100&&(e.updateState(l=>{const c=B(l,n);c.completed=100,c.loaded=c.items.reduce((h,u)=>{let{loaded:m}=u;return h+m},0)}),ae(e,n,g.BATCH_PROGRESS)),e.updateState(l=>{l.currentBatch===n&&(l.currentBatch=null)}),v(`uploady.uploader.batchHelpers: cleaning up batch: ${r.id}`),o||K(e,n,g.BATCH_FINISH),Z(e,n),J(e,n))})})},ae=(e,t,n)=>{const r=e.getState(),s=B(r,t),a=r.items,o={...U(s),items:s.items.map(l=>{let{id:c}=l;return U(a[c])})};e.trigger(n,o)},kn=(e,t)=>{const n=B(e.getState(),t);return Vn.includes(n.state)},qn=(e,t)=>{const{previousBatch:n}=t;if(t.recycled&&n&&e.getState().batches[n]){const{id:r}=V(e,t.id);r===n&&e.updateState(s=>{const a=B(s,r),o=a.items.findIndex(l=>{let{id:c}=l;return c===t.id});~o&&a.items.splice(o,1)})}},er=(e,t)=>{e.updateState(n=>{Object.keys(n.batches).forEach(r=>{const s=n.batches[r],{batch:a,batchOptions:o}=s;a.state===I.PENDING&&(a.items.forEach(l=>{l.state=b.ADDED}),a.state=I.ADDED,s.batchOptions=L({},o,t))})})},tr=e=>{const t=e.getState().batches;Object.keys(t).filter(n=>t[n].batch.state===I.PENDING).forEach(n=>{Z(e,n),J(e,n)})},nr=(e,t)=>{e.updateState(n=>{n.batches[t].finishedCounter+=1})},st=e=>Qn.includes(e.state),rr=(e,t)=>{e.updateState(n=>{const{items:r}=B(n,t);delete n.batches[t],delete n.itemQueue[t];const s=n.batchQueue.indexOf(t);~s&&n.batchQueue.splice(s,1),n.currentBatch===t&&(n.currentBatch=null),r.forEach(a=>{let{id:o}=a;delete n.items[o];const l=n.activeIds.indexOf(o);~l&&n.activeIds.splice(l,1)})})},Se={[b.PENDING]:null,[b.ADDED]:g.ITEM_START,[b.FINISHED]:g.ITEM_FINISH,[b.ERROR]:g.ITEM_ERROR,[b.CANCELLED]:g.ITEM_CANCEL,[b.ABORTED]:g.ITEM_ABORT,[b.UPLOADING]:g.ITEM_PROGRESS},Re=e=>!!~ke.indexOf(e.state),k=(e,t,n)=>{t.forEach(r=>{const s=e.getState(),{id:a,info:o}=r;if(v("uploader.processor.queue: request finished for item - ",{id:a,info:o}),s.items[a]){e.updateState(c=>{const h=c.items[a];h.state=o.state,h.uploadResponse=o.response,h.uploadStatus=o.status,Re(h)&&delete c.aborts[a]});const l=e.getState().items[a];o.state===b.FINISHED&&l.completed<100&&e.handleItemProgress(l,100,l.file?l.file.size:0),Se[l.state]&&e.trigger(Se[l.state],l),Re(l)&&(nr(e,l.batchId),e.trigger(g.ITEM_FINALIZE,l))}qe(e,a)}),Kn(e),n(e)},sr=tt(g.REQUEST_PRE_SEND,e=>e,(e,t)=>({items:e,options:t})),ar=(e,t,n)=>{e.updateState(r=>{t.forEach(s=>{const a=r.items[s.id];a.state=b.UPLOADING,r.aborts[s.id]=n.abort})})},or=(e,t,n)=>{var r;const{items:s,options:a}=t,o=(r=e.getState().batches[s[0].batchId])===null||r===void 0?void 0:r.batch;if(o){let l;try{l=e.sender.send(s,o,a)}catch(h){v("uploader.queue: sender failed with unexpected error",h),l={request:Promise.resolve({status:0,state:b.ERROR,response:h.message}),abort:()=>!1,senderType:"exception-handler"}}const{request:c}=l;ar(e,s,l),c.then(h=>{const u=s.map(m=>({id:m.id,info:h}));k(e,u,n)})}},ir=(e,t,n,r)=>{const s=n.map((a,o)=>a?t[o].id:null).filter(Boolean);if(s.length){const a=s.map(o=>({id:o,info:{status:0,state:b.CANCELLED,response:"cancel"}}));k(e,a,r)}return!!s.length},lr=(e,t,n,r)=>{const s=n.map(a=>{let{id:o}=a;return{id:o,info:{status:0,state:b.ERROR,response:e}}});k(t,s,r)},cr=(e,t)=>{const n=t.getState().items[e];return n&&!Y(n)?n:void 0},dr=e=>{let{allowedItems:t,cancelledResults:n,queue:r,items:s,ids:a,next:o}=e;const l=t.length?sr(r,t):Promise.resolve();let c=n;return l.catch(h=>{v("uploader.queue: encountered error while preparing items for request",h),lr(h,r,s,o)}).then(h=>{let u;return h&&(h.cancelled?c=a.map(()=>!0):h.items.some(d=>Y(d))?v("uploader.queue: send data contains aborted items - not sending"):or(r,{items:h.items,options:h.options},o)),ir(r,s,c,o)||(u=o(r)),u})},ur=(e,t,n)=>{const r=e.getState();let s=Object.values(r.items);return s=s.filter(a=>t.includes(a.id)&&!Y(a)),Promise.all(s.map(a=>e.runCancellable(g.ITEM_START,a))).then(a=>({allowedItems:a.map((l,c)=>l?null:cr(s[c].id,e)).filter(Boolean),cancelledResults:a,queue:e,items:s,ids:t,next:n})).then(dr)},hr=(e,t)=>e.getState().activeIds.flat().includes(t),fr=e=>e.state===b.ADDED,mr=e=>{const t=e.getState(),n=t.itemQueue,r=t.items;let s=null,a=0,o=0,l=t.batchQueue[a];for(;l&&!s;){if(kn(e,l))for(s=n[l][o];s&&(hr(e,s)||!fr(r[s]));)o+=1,s=n[l][o];s||(a+=1,l=t.batchQueue[a],o=0)}return s?[l,o]:null},pr=e=>{const t=e.getState(),n=t.itemQueue,[r,s]=mr(e)||[];let a=r&&~s?n[r][s]:null,o;if(a){const{batchOptions:l}=t.batches[r],c=l.maxGroupSize||0;l.grouped&&c>1?o=t.itemQueue[r].slice(s,s+c):o=[a]}return o},gr=(e,t)=>{e.updateState(n=>{n.activeIds=n.activeIds.concat(t)})},vr=(e,t)=>{let n;return Yn(e,t[0])?n=Promise.resolve(!0):(gr(e,t),Zn(e,t[0])?n=Jn(e,t[0]).then(r=>{let s=!r;return s&&(zn(e,t[0]),D(e)),s}).catch(r=>(v("uploader.processor: encountered error while preparing batch for request",r),Xn(e,t[0],r),D(e),!0)):n=Promise.resolve(!1)),n},D=e=>{let t;const n=pr(e);if(n){const r=e.getCurrentActiveCount(),{concurrent:s=!1,maxConcurrent:a=0}=e.getOptions();(!r||s&&r<a)&&(v("uploader.processor: Processing next upload - ",{ids:n,currentCount:r}),t=vr(e,n).then(o=>{o||(ur(e,n,D),s&&D(e))}))}return t},ge=e=>(t,n)=>k(e,[{id:t,info:n}],D),br=(e,t)=>{const n=e.getOptions().abortItem;P(!!n,"Abort Item method not provided yet abortItem was called");const r=e.getState();return n(t,r.items,r.aborts,ge(e))},Er=(e,t)=>{const n=e.getOptions().abortBatch;P(!!n,"Abort Batch method not provided yet abortItem was called");const r=e.getState(),s=r.batches[t],a=s==null?void 0:s.batch;if(a&&!st(a)){K(e,t,g.BATCH_ABORT,I.ABORTED);const{isFast:o}=n(a,s.batchOptions,r.aborts,r.itemQueue,ge(e),e.getOptions());o&&e.clearBatchUploads(a.id)}},xr=e=>{const t=e.getOptions().abortAll;P(!!t,"Abort All method not provided yet abortAll was called"),e.trigger(g.ALL_ABORT);const n=e.getState(),{isFast:r}=t(n.items,n.aborts,n.itemQueue,ge(e),e.getOptions());r&&e.clearAllUploads()},Ir=(e,t,n,r,s)=>{const{state:a,update:o}=Fn({itemQueue:{},batchQueue:[],currentBatch:null,batchesStartPending:[],batches:{},items:{},activeIds:[],aborts:{}}),l=()=>a,c=d=>{o(d)},h=d=>{if(a.items[d.id]&&!d.recycled)throw new Error(`Uploader queue conflict - item ${d.id} already exists`);d.recycled&&qn(m,d),c(f=>{f.items[d.id]=d})},u=(d,f,p)=>{a.items[d.id]&&(c(x=>{const R=x.items[d.id];R.loaded=p,R.completed=f}),t(g.ITEM_PROGRESS,l().items[d.id]))};r.on(H.ITEM_PROGRESS,u),r.on(H.BATCH_PROGRESS,d=>{var f;const p=(f=a.batches[d.id])===null||f===void 0?void 0:f.batch.items;if(p){const[x,R]=p.reduce((w,C)=>{let{id:bt}=C;const{completed:Et,loaded:xt}=a.items[bt];return w[0]+=Et,w[1]+=xt,w},[0,0]);c(w=>{const C=w.batches[d.id].batch;C.completed=x/p.length,C.loaded=R}),t(g.BATCH_PROGRESS,a.batches[d.id].batch)}});const m={uploaderId:s,getOptions:()=>e,getCurrentActiveCount:()=>a.activeIds.length,getState:l,updateState:c,trigger:t,runCancellable:function(d){if(!j(n))throw new Error("Uploader queue - cancellable is of wrong type");for(var f=arguments.length,p=new Array(f>1?f-1:0),x=1;x<f;x++)p[x-1]=arguments[x];return n(d,...p)},sender:r,handleItemProgress:u,clearAllUploads:()=>{m.updateState(d=>{d.itemQueue={},d.batchQueue=[],d.currentBatch=null,d.batches={},d.items={},d.activeIds=[]})},clearBatchUploads:d=>{De(()=>{v(`uploader.queue: started scheduled work to clear batch uploads (${d})`),l().batches[d]&&rr(m,d)})}};return O()&&je()&&(window[`__rpldy_${s}_queue_state`]=m),{updateState:c,getState:m.getState,runCancellable:m.runCancellable,uploadBatch:(d,f)=>{f&&c(p=>{p.batches[d.id].batchOptions=f}),D(m)},addBatch:(d,f)=>(c(p=>{p.batches[d.id]={batch:d,batchOptions:f,finishedCounter:0},p.batchQueue.push(d.id),p.itemQueue[d.id]=d.items.map(x=>{let{id:R}=x;return R})}),d.items.forEach(h),B(a,d.id)),abortItem:function(){for(var d=arguments.length,f=new Array(d),p=0;p<d;p++)f[p]=arguments[p];return br(m,...f)},abortBatch:function(){for(var d=arguments.length,f=new Array(d),p=0;p<d;p++)f[p]=arguments[p];return Er(m,...f)},abortAll:function(){for(var d=arguments.length,f=new Array(d),p=0;p<d;p++)f[p]=arguments[p];return xr(m,...f)},clearPendingBatches:()=>{tr(m)},uploadPendingBatches:d=>{er(m,d),D(m)},cancelBatch:d=>rt(m,d.id)}},Ae="rpldy-sender";class Sr extends Error{constructor(t){super(`${t} didn't receive upload URL`),this.name="MissingUrlError"}}const oe=function(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),s=2;s<n;s++)r[s-2]=arguments[s];"set"in e?e.set(t,...r):("delete"in e&&e.delete(t),e.append(t,...r))},Rr=(e,t,n)=>{const r=t.length===1;t.forEach((s,a)=>{const o=r?n.paramName:j(n.formatGroupParamName)?n.formatGroupParamName(a,n.paramName):`${n.paramName}[${a}]`;s.file?oe(e,o,s.file,s.file.name):s.url&&oe(e,o,s.url)})},Ar=(e,t)=>{const n=new FormData;return t.params&&Object.entries(t.params).forEach(r=>{let[s,a]=r;(t.formDataAllowUndefined||a!==void 0)&&oe(n,s,a)}),Rr(n,e,t),n},Pr=[200,201,202,203,204],wr=(e,t)=>{let n;if(t.sendWithFormData)v(`uploady.sender: sending ${e.length} item(s) as form data`),n=Ar(e,t);else{if(e.length>1)throw new Error(`XHR Sender - Request without form data can only contain 1 item. received ${e.length}`);const r=e[0];v(`uploady.sender: sending item ${r.id} as request body`),n=r.file||r.url}return n},Nr=(e,t,n,r,s)=>{let a;const o=s!=null&&s.getRequestData?s.getRequestData(e,n):wr(e,n),l=function(){let h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:t,u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:o,m=arguments.length>2?arguments[2]:void 0;const d=L({...Jt(n,["method","headers","withCredentials"]),preSend:p=>{p.upload.onprogress=x=>{x.lengthComputable&&r&&r(x,e.slice())}}},m),f=dn(h,u,d);return a=f.xhr,f},c=s!=null&&s.preRequestHandler?s.preRequestHandler(l,e,t,n,r,s):l();return{url:t,count:e.length,pXhr:c,getXhr:()=>a,aborted:!1}},Or=(e,t,n)=>{let r=e;const s=t==null?void 0:t["content-type"];if(n.forceJsonResponse||s!=null&&s.includes("json"))try{r=JSON.parse(e)}catch{}return r},Tr=(e,t)=>{const n=t.isSuccessfulCall?t.isSuccessfulCall(e):Pr.includes(e.status);return me(n)?n:Promise.resolve(n)},yr=(e,t)=>e.pXhr.then(n=>(v("uploady.sender: received upload response ",n),Tr(n,t).then(r=>{var s,a;const o=r?b.FINISHED:b.ERROR,l=n.status,c=un(n),h={data:(s=(a=t.formatServerResponse)===null||a===void 0?void 0:a.call(t,n.response,l,c))!==null&&s!==void 0?s:Or(n.response,c,t),headers:c};return{status:l,state:o,response:h}}))).catch(n=>{let r,s;return e.aborted?(r=b.ABORTED,s="aborted"):(v("uploady.sender: upload failed: ",n),r=b.ERROR,s=n),{error:!0,state:r,response:s,status:0}}),jr=e=>{let t=!1;const{aborted:n,getXhr:r}=e,s=r();return!n&&s&&s.readyState&&s.readyState!==4&&(v(`uploady.sender: cancelling request with ${e.count} items to: ${e.url}`),s.abort(),e.aborted=!0,t=!0),t},Br=e=>(t,n,r,s)=>{if(!n)throw new Sr(Ae);v("uploady.sender: sending file: ",{items:t,url:n,options:r});const a=Nr(t,n,r,s,e);return{request:yr(a,r),abort:()=>jr(a),senderType:Ae}},Cr=Br(),Dr="file",at=()=>!0,ot=_({autoUpload:!0,clearPendingOnAdd:!1,inputFieldName:"file",concurrent:!1,maxConcurrent:2,grouped:!1,maxGroupSize:5,method:"POST",params:{},fileFilter:at,forceJsonResponse:!1,withCredentials:!1,destination:{},send:null,sendWithFormData:!0,formDataAllowUndefined:!1,fastAbortThreshold:100}),Fr=(e,t,n,r)=>{e.forEach(s=>{v(`uploady.uploader.processor: file: ${s.id} progress event: loaded(${n}) - completed(${t})`),r(H.ITEM_PROGRESS,s,t,n)})},Ur=(e,t,n,r)=>{const s=Math.min(n.loaded/n.total*100,100),a=s/e.length,o=n.loaded/e.length;Fr(e,a,o,r),r(H.BATCH_PROGRESS,t)},_r=()=>{const{trigger:e,target:t}=ze({send:(n,r,s)=>{const a=s.destination,o=a==null?void 0:a.url,l=Mt(h=>Ur(n,r,h,e),Un,!0);return(j(s.send)?s.send:Cr)(n,o,{method:(a==null?void 0:a.method)||s.method||ot.method,paramName:(a==null?void 0:a.filesParamName)||s.inputFieldName||Dr,params:{...s.params,...a==null?void 0:a.params},forceJsonResponse:s.forceJsonResponse,withCredentials:s.withCredentials,formatGroupParamName:s.formatGroupParamName,headers:a==null?void 0:a.headers,sendWithFormData:s.sendWithFormData,formatServerResponse:s.formatServerResponse,formDataAllowUndefined:s.formDataAllowUndefined,isSuccessfulCall:s.isSuccessfulCall},l)}},Object.values(H));return t},Lr=O()&&"FileList"in window,Mr=e=>({params:{},...e}),Hr=e=>({...ot,...e,destination:e&&e.destination?Mr(e.destination):null}),Gr=e=>Lr&&e instanceof FileList||e.toString()==="[object FileList]",ie=function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=e;return y()||(t<3&&M(e)?n=U(e):t<3&&Ke(e)&&(n=Array.isArray(e)?e.map(r=>ie(r,t+1)):Object.keys(e).reduce((r,s)=>(r[s]=ie(e[s],t+1),r),{}))),n};let Pe=0;const $r=(e,t,n,r)=>{const s=r?Array.prototype.map.call(t,a=>Ue(a)?a.file||a.url:a):[];return Promise.all(Array.prototype.map.call(t,(a,o)=>{const l=(r||at)(s[o],o,s);return me(l)?l.then(c=>!!c&&a):!!l&&a})).then(a=>a.filter(Boolean).map(o=>rn(o,e,n)))},Vr=(e,t,n)=>{Pe+=1;const r=`batch-${Pe}`,s=Gr(e),a=Array.isArray(e)||s?e:[e],o=!n.autoUpload;return $r(r,a,o,n.fileFilter).then(l=>({id:r,uploaderId:t,items:l,state:o?I.PENDING:I.ADDED,completed:0,loaded:0,orgItemCount:l.length,additionalInfo:null}))},Qr=(e,t,n,r)=>{const s=_r(),a=Ir(n,e,t,s,r);return{abortBatch:o=>{a.abortBatch(o)},abort:o=>{o?a.abortItem(o):a.abortAll()},addNewBatch:(o,l)=>Vr(o,r,l).then(c=>{let h;if(c.items.length){const u=a.addBatch(c,l);h=a.runCancellable(g.BATCH_ADD,u,l).then(m=>(m?a.cancelBatch(u):(v(`uploady.uploader [${r}]: new items added - auto upload =
                       ${String(l.autoUpload)}`,u.items),l.autoUpload&&a.uploadBatch(u)),u))}else v(`uploady.uploader: no items to add. batch ${c.id} is empty. check fileFilter if this isn't intended`);return h||Promise.resolve(null)}),clearPendingBatches:()=>{a.clearPendingBatches()},processPendingBatches:o=>{a.uploadPendingBatches(o)}}},Wr=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(r){for(var s=arguments.length,a=new Array(s>1?s-1:0),o=1;o<s;o++)a[o-1]=arguments[o];return t.reduce((l,c)=>c(l,...a)||l,r)}},zr=Object.values(g),Xr="Uploady - uploader extensions can only be registered by enhancers",Yr="Uploady - uploader extension by this name [%s] already exists";let re=0;const Zr=e=>Wr(Je(),e),Jr=(e,t,n,r)=>{const s=t.enhancer?Zr(t.enhancer):Je();r(!0);const a=s(e,n);return r(!1),a||e},Kr=e=>{re+=1;const t=`uploader-${re}`;let n=!1;const r={};v(`uploady.uploader: creating new instance (${t})`,{options:e,counter:re});let s=Hr(e);const a=()=>{d.clearPendingBatches()},o=()=>Ce(s);let{trigger:l,target:c}=ze({id:t,update:f=>(s=L({},s,f),c),add:(f,p)=>{const x=L({},s,p);return x.clearPendingOnAdd&&a(),d.addNewBatch(f,x).then(()=>{v("uploady.uploader: finished adding file data to be processed")})},upload:f=>{d.processPendingBatches(f)},abort:f=>{d.abort(f)},abortBatch:f=>{d.abortBatch(f)},getOptions:o,clearPending:a,registerExtension:(f,p)=>{P(n,Xr),P(!r[f],Yr,f),v(`uploady.uploader: registering extension: ${f.toString()}`,p),r[f]=p},getExtension:f=>r[f]},zr,{canAddEvents:!1,canRemoveEvents:!1});const h=function(f){for(var p=arguments.length,x=new Array(p>1?p-1:0),R=1;R<p;R++)x[R-1]=arguments[R];const w=Nn(()=>x.map(ie));return l(f,w)},u=$t(h),m=Jr(c,s,h,f=>{n=f}),d=Qr(h,u,s,m.id);return _(m)},it=Symbol.for("_rpldy-version_"),lt=()=>"1.4.1",ct=()=>O()?window:globalThis||process,dt=()=>ct()[it],kr=()=>{ct()[it]=lt()},qr=()=>{const e=dt();return!!e&&e!==lt()},ut=A.createContext(null),we="Uploady - Context. File input isn't available",es=(e,t)=>{let n,r,s=!1;t?n=t:v("Uploady context - didn't receive input field ref - waiting for external ref");const a=()=>{var u;return(u=n)===null||u===void 0?void 0:u.current},o=()=>(n&&(s=!0),n),l=()=>s,c=()=>{const u=a();P(u,we),u.removeEventListener("change",c);const m=r;r=null,h(u.files,m)},h=(u,m)=>{e.add(u,m)};return kr(),{hasUploader:()=>!!e,getInternalFileInput:o,setExternalFileInput:u=>{s=!0,n=u},getIsUsingExternalInput:l,showFileUpload:u=>{const m=a();P(m,we),r=u,m.removeEventListener("change",c),m.addEventListener("change",c),m.value="",m.click()},upload:h,processPending:u=>{e.upload(u)},clearPending:()=>{e.clearPending()},setOptions:u=>{e.update(u)},getOptions:()=>e.getOptions(),getExtension:u=>e.getExtension(u),abort:u=>{e.abort(u)},abortBatch:u=>{e.abortBatch(u)},on:(u,m)=>e.on(u,m),once:(u,m)=>e.once(u,m),off:(u,m)=>e.off(u,m)}},ts="Uploady - Valid UploadyContext not found. Make sure you render inside <Uploady>",ns=`Uploady - Valid UploadyContext not found.
You may be using packages of different Uploady versions. <Uploady> and all other packages using the context provider must be of the same version: %s`,rs=e=>(P(!qr(),ns,dt()),P(e&&e.hasUploader(),ts),e),q=()=>rs(E.useContext(ut)),ht=(e,t)=>{const n=q(),{on:r,off:s}=n;E.useEffect(()=>(r(e,t),()=>{s(e,t)}),[e,t,r,s])},ft=(e,t)=>(n,r)=>{const[s,a]=E.useState(null);let o=n,l=r;n&&!j(n)&&(l=n,o=void 0);const c=E.useCallback(function(h){if(!l||h.id===l){for(var u=arguments.length,m=new Array(u>1?u-1:0),d=1;d<u;d++)m[d-1]=arguments[d];a(t(h,...m)),j(o)&&o(h,...m)}},[o,l]);return ht(e,c),s},S=function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return(n,r)=>{const s=E.useCallback(function(a){for(var o=arguments.length,l=new Array(o>1?o-1:0),c=1;c<o;c++)l[c-1]=arguments[c];return n&&(!t||!r||a.id===r)?n(a,...l):void 0},[n,r]);ht(e,s)}};S(g.BATCH_ADD,!1);const ss=S(g.BATCH_START);S(g.BATCH_FINISH);S(g.BATCH_CANCEL);S(g.BATCH_ERROR);S(g.BATCH_FINALIZE);S(g.BATCH_ABORT);ft(g.BATCH_PROGRESS,e=>({...e}));S(g.ITEM_START);const as=S(g.ITEM_FINISH);S(g.ITEM_CANCEL);S(g.ITEM_ERROR);S(g.ITEM_ABORT);S(g.ITEM_FINALIZE);const Ne=ft(g.ITEM_PROGRESS,e=>({...e}));S(g.REQUEST_PRE_SEND,!1);S(g.ALL_ABORT,!1);const os=Symbol.for("rpldy_component"),is=e=>{e[os]=!0},ls=(e,t)=>{const n=E.useMemo(()=>(v("Uploady creating a new uploader instance",e),Kr(e)),[e.enhancer]);return n.update(e),E.useEffect(()=>(t&&(v("Uploady setting event listeners",t),Object.entries(t).forEach(r=>{let[s,a]=r;n.on(s,a)})),()=>{t&&(v("Uploady removing event listeners",t),Object.entries(t).forEach(r=>{let[s,a]=r;return n.off(s,a)}))}),[t,n]),n},cs=e=>{const{listeners:t,debug:n,children:r,inputRef:s,...a}=e;Gt(!!n),v("@@@@@@ Uploady Rendering @@@@@@",e);const o=ls(a,t),l=E.useMemo(()=>es(o,s),[o,s]);return A.createElement(ut.Provider,{value:l},r)},ds=e=>{const t=q();return e&&t.setOptions(e),t.getOptions()};function le(){return le=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},le.apply(this,arguments)}const mt=e=>{let{eventType:t,getIsValidEventData:n,getRequestData:r}=e;return s=>a=>{const o=q(),[l,c]=E.useState({updateRequest:null,requestData:null}),{id:h}=a;return E.useLayoutEffect(()=>{const u=function(){for(var m=arguments.length,d=new Array(m),f=0;f<m;f++)d[f]=arguments[f];return n(h,...d)===!0?new Promise(p=>{c({updateRequest:x=>{o.off(t,u),p(x)},requestData:r(...d)})}):void 0};return h&&o.on(t,u),()=>{h&&o.off(t,u)}},[o,h]),A.createElement(s,le({},a,l))}};mt({eventType:g.REQUEST_PRE_SEND,getIsValidEventData:(e,t)=>{let{items:n}=t;return!!n.find(r=>r.id===e)},getRequestData:e=>{let{items:t,options:n}=e;return{items:t,options:n}}});mt({eventType:g.BATCH_START,getIsValidEventData:(e,t)=>t.id===e,getRequestData:(e,t)=>({batch:e,items:e.items,options:t})});function ce(){return ce=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},ce.apply(this,arguments)}const pt=e=>{const t=(n,r)=>{const{showFileUpload:s}=q(),{id:a,className:o,text:l,children:c,extraProps:h,onClick:u,...m}=n,d=E.useRef();d.current=m;const f=E.useCallback(p=>{s(d.current),u==null||u(p)},[s,d,u]);return A.createElement(e,ce({ref:r,onClick:f,id:a,className:o,children:c||l||"Upload"},h))};return is(t),E.forwardRef(t)};function de(){return de=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},de.apply(this,arguments)}pt(E.forwardRef((e,t)=>A.createElement("button",de({ref:t},e))));const G={IMAGE:"image",VIDEO:"video"},us=_({rememberPreviousBatches:!1,loadFirstOnly:!1,maxPreviewImageSize:2e7,maxPreviewVideoSize:1e8,fallbackUrl:"",imageMimeTypes:["image/jpeg","image/webp","image/gif","image/png","image/apng","image/bmp","image/x-icon","image/svg+xml"],videoMimeTypes:["video/mp4","video/webm","video/ogg"],previewComponentProps:void 0}),hs=e=>({...us,...e}),gt=(e,t)=>{let n=j(e)?e(t):e;return typeof n=="string"&&(n={url:n,name:t.name,type:G.IMAGE}),n},Oe=(e,t,n,r)=>{let s;return t&&~t.indexOf(r.type)&&(!n||r.size<=n)&&(s={url:URL.createObjectURL(r),name:r.name,type:e}),s},fs=(e,t)=>{let n=Oe(G.IMAGE,t.imageMimeTypes,t.maxPreviewImageSize||0,e);return n||(n=Oe(G.VIDEO,t.videoMimeTypes,t.maxPreviewVideoSize||0,e)),n},ms=(e,t,n,r)=>j(e)?e(t,n,r):e,ps=(e,t,n)=>{let r,s=!1;if(e.file){const a=e.file;r=fs(e.file,t),r||(r=gt(t.fallbackUrl,a),s=!0)}else r={url:e.url,name:e.url,type:G.IMAGE};return r&&{...r,id:e.id,isFallback:s,removePreview:()=>n(e.id)}},gs=(e,t)=>{const n=[];return t.forEach(r=>{const s=e.findIndex(a=>a.id===r.id);~s?e.splice(s,1,r):n.push(r)}),e.concat(n)},vs=(e,t,n)=>{let r=e;return n&&(r=e.map(s=>({...s,props:ms(n,t.find(a=>{let{id:o}=a;return o===s.id}),s.url,s.type)}))),r},bs=e=>t=>{const n=t.previewComponentProps,[r,s]=E.useState({previews:[],items:[]}),a=hs(t),o=E.useCallback(()=>{s({previews:[],items:[]})},[]),l=E.useCallback(h=>{s(u=>{let{previews:m,items:d}=u;return{previews:m.filter(f=>f.id!==h),items:d.filter(f=>f.id!==h)}})},[]);return e(h=>{const u=a.loadFirstOnly?h.items.slice(0,1):h.items,m=u.map(d=>ps(d,a,l)).filter(Boolean);s({previews:t.rememberPreviousBatches?gs(r.previews,m):m,items:t.rememberPreviousBatches?r.items.concat(u):u})}),{previews:E.useMemo(()=>vs(r.previews,r.items,n),[r,n]),clearPreviews:o,removeItemFromPreview:l}};function $(){return $=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},$.apply(this,arguments)}const Es=(e,t,n,r)=>e===G.VIDEO?A.createElement("video",$({key:t,src:t,controls:!0},n)):A.createElement("img",$({key:t,onError:r,src:t},n)),xs=(e,t,n,r,s)=>{E.useImperativeHandle(n,()=>({clear:t,removePreview:s}),[t,s]),E.useEffect(()=>{r&&r(e)},[e,r])},Is=function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:ss;const t=bs(e);return n=>{const{PreviewComponent:r,previewMethodsRef:s,onPreviewsChanged:a,...o}=n,{previews:l,clearPreviews:c,removeItemFromPreview:h}=t(o),u=E.useCallback(m=>{const d=m.currentTarget,f=gt(n.fallbackUrl,d.src);f&&(d.src=f.url)},[n.fallbackUrl]);return xs(l,c,s,a,h),l.map(m=>{const{id:d,url:f,type:p,name:x,isFallback:R,removePreview:w,props:C}=m;return r?A.createElement(r,$({key:d+f,id:d,url:f,type:p,name:x,isFallback:R,removePreview:w},C)):Es(p,f,C,u)})}},Ss=Is();function W(){return W=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},W.apply(this,arguments)}const Rs="Uploady - Container for file input must be a valid dom element",vt=(e,t,n)=>A.createElement("input",W({},e,{name:t.inputFieldName,type:"file",ref:n})),As=(e,t,n,r,s)=>e&&t?jt.createPortal(vt(n,r,s),e):null,Ps=E.memo(E.forwardRef((e,t)=>{let{container:n,noPortal:r,...s}=e;const a=ds(),o=n&&n.nodeType===1;return P(o||!O(),Rs),r?vt(s,a,t):As(n,o,s,a,t)})),ws=e=>{const{multiple:t=!0,capture:n,accept:r,webkitdirectory:s,children:a,inputFieldContainer:o,customInput:l,fileInputId:c,noPortal:h=!1,...u}=e,m=l?null:o||(O()?document.body:null),d=E.useRef();return A.createElement(cs,W({},u,{inputRef:d}),l?null:A.createElement(Ps,{container:m,multiple:t,capture:n,accept:r,webkitdirectory:s==null?void 0:s.toString(),style:{display:"none"},ref:d,id:c,noPortal:h}),a)},N=({controllerConfig:e={name:"image"},formgroupProps:t={},childrenProps:{uploadButton:n,type:r="thumbnail"}})=>{const{field:s,fieldState:{error:a}}=Ct(e),o=()=>{const[u,m]=E.useState(0);return Ne(d=>{m(d.completed),console.log(`>>>>> (hook) File ${d.file.name} completed: ${d.completed}`)}),u===0||u===100?null:i.jsx(Ut,{intent:"danger",value:u})},l=()=>{const[u,m]=E.useState("");return Ne(d=>{m(d.file.name)}),i.jsx("div",{children:u})},c=pt(u=>n?i.jsx("button",{...u,children:n}):i.jsx(Te,{...u,style:{cursor:"pointer"},small:!0,children:"点击选择"})),h=()=>(as(u=>{console.log(`item ${u.id} finished uploading, response was: `,u.uploadResponse,u.uploadStatus)}),null);return i.jsx(Bt,{...t,helperText:a!=null&&a.message?a==null?void 0:a.message:t.helperText,intent:s.value?a?"danger":"success":"none",children:i.jsxs(ws,{destination:{url:"http://localhost:3000/file/imgUpload"},inputFieldName:"img",children:[r==="thumbnail"?i.jsxs("div",{className:"flex gap-2",children:[i.jsxs("div",{className:"relative border",children:[i.jsx(Ss,{previewComponentProps:{className:"w-36 h-24 border cover"},fallbackUrl:"https://icon-library.net/images/image-placeholder-icon/image-placeholder-icon-6.jpg"}),i.jsx("div",{className:"absolute bottom-0 w-full",children:i.jsx(o,{})})]}),i.jsx(c,{})]}):i.jsxs("div",{children:[i.jsx(c,{}),i.jsxs("div",{className:"border",children:[i.jsx(l,{}),i.jsx("div",{className:"w-full",children:i.jsx(o,{})})]})]}),i.jsx(h,{})]})})},ys=()=>{const{control:e}=Dt({mode:"all"});return i.jsx(Ft,{className:"h-full overflow-y-auto",children:i.jsxs("div",{className:"grid grid-cols-1 gap-2 px-2",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"py-2 text-2xl",children:"依赖包：react-uploady"}),i.jsxs("table",{className:"my-2 text-center",children:[i.jsx("thead",{children:i.jsxs("tr",{className:"bg-slate-100",children:[i.jsx("th",{className:"border",children:"属性"}),i.jsx("th",{className:"border",children:"说明"}),i.jsx("th",{className:"border",children:"类型"}),i.jsx("th",{className:"border",children:"默认值"})]})}),i.jsxs("tbody",{children:[i.jsxs("tr",{children:[i.jsx("td",{className:"border",children:i.jsx("pre",{children:"uploadButton"})}),i.jsxs("td",{className:"border",children:["包含在一个",i.jsx("code",{children:"button"}),"中，定制入口样式"]}),i.jsx("td",{className:"border px-2",children:i.jsx("code",{className:"rounded-sm bg-gray-200 px-1",children:"ReactElement"})}),i.jsx("td",{className:"border p-2",children:i.jsx(Te,{small:!0,children:"点击选择"})})]}),i.jsxs("tr",{children:[i.jsx("td",{className:"border",children:i.jsx("pre",{children:"type"})}),i.jsx("td",{className:"border",children:"等待区显示类型"}),i.jsx("td",{className:"border px-2",children:i.jsx("code",{className:"rounded-sm bg-gray-200 px-1",children:'"fileName" | "thumbnail"'})}),i.jsx("td",{className:"border",children:'"fileName"'})]}),i.jsxs("tr",{children:[i.jsx("td",{className:"border",children:i.jsx("pre",{children:"crop"})}),i.jsx("td",{className:"border",children:"是否裁剪"}),i.jsx("td",{className:"border px-2",children:i.jsx("code",{className:"rounded-sm bg-gray-200 px-1",children:"boolean"})}),i.jsx("td",{className:"border",children:"false"})]}),i.jsxs("tr",{children:[i.jsx("td",{className:"border",children:i.jsx("pre",{children:"preview"})}),i.jsx("td",{className:"border",children:"是否预览"}),i.jsx("td",{className:"border px-2",children:i.jsx("code",{className:"rounded-sm bg-gray-200 px-1",children:"boolean"})}),i.jsx("td",{className:"border",children:"false"})]})]})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[i.jsxs("div",{className:"border",children:[i.jsx("h1",{children:"单图片上传（无裁剪）"}),i.jsx("div",{className:"bg-slate-200 p-3",children:i.jsx(N,{controllerConfig:{name:"file",control:e,defaultValue:""},formgroupProps:{label:i.jsx("div",{children:"上传图片"}),labelInfo:i.jsx("div",{children:"(必填)"}),inline:!0},childrenProps:{}})})]}),i.jsxs("div",{className:"border",children:[i.jsx("h1",{children:"单图片上传（裁剪）"}),i.jsx("div",{className:"bg-slate-200 p-3",children:i.jsx(N,{controllerConfig:{name:"file",control:e,defaultValue:""},formgroupProps:{helperText:"填写说明：",label:i.jsx("div",{children:"上传图片"}),labelInfo:i.jsx("div",{children:"(必填)"}),inline:!0},childrenProps:{uploadButton:i.jsxs("div",{className:"flex h-24 w-36 flex-col items-center justify-center rounded border border-dashed border-gray-300 bg-white hover:border-blue-600 ",children:[i.jsx("div",{children:i.jsx(F,{icon:"ph:image",height:"1.5em"})}),i.jsx("div",{children:"选择"})]}),preview:!0}})})]}),i.jsxs("div",{className:"border",children:[i.jsx("h1",{children:"选择头像（单图裁剪固定比例及大小）"}),i.jsx("div",{className:"bg-slate-200 p-3",children:i.jsx(N,{controllerConfig:{name:"file",control:e,defaultValue:""},formgroupProps:{helperText:"填写说明：",label:i.jsx("div",{children:"上传图片"}),labelInfo:i.jsx("div",{children:"(必填)"}),inline:!0},childrenProps:{uploadButton:i.jsxs("div",{className:"flex h-24 w-36 flex-col items-center justify-center rounded border border-dashed border-gray-300 bg-white hover:border-blue-600 ",children:[i.jsx("div",{children:i.jsx(F,{icon:"ph:image",height:"1.5em"})}),i.jsx("div",{children:"选择"})]}),preview:!0}})})]}),i.jsxs("div",{className:"border",children:[i.jsx("h1",{children:"多图片上传（无裁剪）"}),i.jsx("div",{className:"bg-slate-200 p-3",children:i.jsx(N,{controllerConfig:{name:"file",control:e,defaultValue:""},formgroupProps:{helperText:"填写说明：",label:i.jsx("div",{children:"上传图片"}),labelInfo:i.jsx("div",{children:"(必填)"}),inline:!0},childrenProps:{uploadButton:i.jsxs("div",{className:"flex h-24 w-36 flex-col items-center justify-center rounded border border-dashed border-gray-300 bg-white hover:border-blue-600 ",children:[i.jsx("div",{children:i.jsx(F,{icon:"ph:image",height:"1.5em"})}),i.jsx("div",{children:"选择"})]}),preview:!0}})})]}),i.jsxs("div",{className:"border",children:[i.jsx("h1",{children:"多图片上传（裁剪）"}),i.jsx("div",{className:"bg-slate-200 p-3",children:i.jsx(N,{controllerConfig:{name:"file",control:e,defaultValue:""},formgroupProps:{helperText:"填写说明：",label:i.jsx("div",{children:"上传图片"}),labelInfo:i.jsx("div",{children:"(必填)"}),inline:!0},childrenProps:{uploadButton:i.jsxs("div",{className:"flex h-24 w-36 flex-col items-center justify-center rounded border border-dashed border-gray-300 bg-white hover:border-blue-600 ",children:[i.jsx("div",{children:i.jsx(F,{icon:"ph:image",height:"1.5em"})}),i.jsx("div",{children:"选择"})]}),preview:!0}})})]}),i.jsxs("div",{className:"border",children:[i.jsx("h1",{children:"图片视频上传（预览）"}),i.jsx("div",{className:"bg-slate-200 p-3",children:i.jsx(N,{controllerConfig:{name:"file",control:e,defaultValue:""},formgroupProps:{helperText:"填写说明：",label:i.jsx("div",{children:"上传图片"}),labelInfo:i.jsx("div",{children:"(必填)"}),inline:!0},childrenProps:{uploadButton:i.jsxs("div",{className:"flex h-24 w-36 flex-col items-center justify-center rounded border border-dashed border-gray-300 bg-white hover:border-blue-600 ",children:[i.jsx("div",{children:i.jsx(F,{icon:"ph:image",height:"1.5em"})}),i.jsx("div",{children:"选择"})]}),preview:!0}})})]}),i.jsxs("div",{className:"border",children:[i.jsx("h1",{children:"文件上传（进度条）"}),i.jsx("div",{className:"bg-slate-200 p-3",children:i.jsx(N,{controllerConfig:{name:"file",control:e,defaultValue:""},formgroupProps:{helperText:"填写说明：",label:i.jsx("div",{children:"上传图片"}),labelInfo:i.jsx("div",{children:"(必填)"}),inline:!0},childrenProps:{uploadButton:i.jsxs("div",{className:"flex h-24 w-36 flex-col items-center justify-center rounded border border-dashed border-gray-300 bg-white hover:border-blue-600 ",children:[i.jsx("div",{children:i.jsx(F,{icon:"ph:image",height:"1.5em"})}),i.jsx("div",{children:"选择"})]}),preview:!0}})})]})]})]}),i.jsxs("div",{children:[i.jsx("h1",{className:"py-2 text-2xl",children:"依赖包：react-filepond"}),i.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[i.jsxs("div",{className:"border",children:[i.jsx("h1",{children:"单图片上传（裁剪）"}),i.jsx("div",{className:"bg-slate-200 p-3",children:i.jsx(ee,{controllerConfig:{name:"file",control:e,defaultValue:""},formgroupProps:{helperText:"填写说明：",label:i.jsx("div",{children:"单图片上传（裁剪）"}),labelInfo:i.jsx("div",{children:"(必填)"})},childrenProps:{text:"请选择要上传的图片",buttonText:"点击选择",small:!0}})})]}),i.jsxs("div",{className:"border",children:[i.jsx("h1",{children:"选择头像（单图裁剪固定比例及大小）"}),i.jsx("div",{className:"bg-slate-200 p-3",children:i.jsx(ee,{controllerConfig:{name:"file",control:e,defaultValue:""},formgroupProps:{helperText:"填写说明：比例1：1；大小不超过120k",label:i.jsx("div",{children:"选择头像"}),labelInfo:i.jsx("div",{children:"(必填)"})},childrenProps:{text:"请选择图片",buttonText:"点击选择",small:!0}})})]})]})]}),i.jsxs("div",{children:[i.jsx("h1",{className:"py-2 text-2xl",children:"依赖包：react-dropzone-uploader"}),i.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[i.jsxs("div",{className:"border",children:[i.jsx("h1",{children:"图片视频上传（预览）"}),i.jsx("div",{className:"bg-slate-200 p-3",children:i.jsx(N,{controllerConfig:{name:"file",control:e,defaultValue:""},formgroupProps:{label:i.jsx("div",{children:"上传图片"}),labelInfo:i.jsx("div",{children:"(必填)"})},childrenProps:{preview:!0}})})]}),i.jsxs("div",{className:"border",children:[i.jsx("h1",{children:"文件上传（进度条）"}),i.jsx("div",{className:"bg-slate-200 p-3",children:i.jsx(ee,{controllerConfig:{name:"file",control:e,defaultValue:""},formgroupProps:{helperText:"填写说明：",label:i.jsx("div",{children:"文件上传"}),labelInfo:i.jsx("div",{children:"(必填)"})},childrenProps:{text:"请选择要上传的文件",buttonText:"点击选择",small:!0}})})]}),i.jsxs("div",{className:"border",children:[i.jsx("h1",{children:"图片视频上传（预览）"}),i.jsx("div",{className:"bg-slate-200 p-3",children:i.jsx(N,{controllerConfig:{name:"file",control:e,defaultValue:""},formgroupProps:{label:i.jsx("div",{children:"上传图片"}),labelInfo:i.jsx("div",{children:"(必填)"}),inline:!0},childrenProps:{preview:!0}})})]})]})]})]})})};export{ys as default};
