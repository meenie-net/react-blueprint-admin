import{r as g,bc as L,bd as T,be as M,j as e,B as r,a7 as O,O as S,b8 as B,bf as k,e as E,E as D,ar as F,bg as v}from"./index33551.js";import{a as R,T as G,S as W,C as w,b as y}from"./table233551.js";import _ from"./UserDrawer33551.js";import{C as A}from"./controlGroup33551.js";import{H as $}from"./htmlSelect33551.js";import{u as V}from"./useButtonPermission33551.js";import{C as z}from"./card33551.js";import"./abstractComponent233551.js";import"./useRouteHandle33551.js";function I(a,d){const[h,l]=g.useState({pageSize:5,currentPage:1,total:0}),[p,b]=g.useState([...L(()=>({}),13)]),[j,x]=g.useState([]),[i,C]=g.useState([R.CELLS,R.COLUMN_HEADERS,R.ROW_HEADERS]),c=g.useRef(null),N=async s=>{C([R.CELLS,R.COLUMN_HEADERS,R.ROW_HEADERS]);const o=s||(d==null?void 0:d.param)||{pageSize:h.pageSize,pageNum:h.currentPage},{data:m}=await a(o);m.data&&(b([...m.data]),l({pageSize:m.pageSize||o.pageSize,currentPage:m.pageNum||o.pageNum,total:m.total||m.data.length}),C([]))};g.useEffect(()=>{N()},[]);const t=(s,o)=>{const m=s.map(f=>{if(f.rows!=null)return T(f.rows[0],f.rows[1],1)}).flat().map(f=>p[f][o]);x(m)};return g.useEffect(()=>{const s=new ResizeObserver(()=>{if(!c.current)return;const o=c.current;if(!o.locator)return;const m=o.locator.getViewportRect();d!=null&&d.widthArr&&o.setState({...o.state,viewportRect:m}),o.componentDidMount()});return s.observe(document.body),()=>{s.disconnect()}},[p]),{tableData:p,tableRef:c,updateTable:N,loading:i,pager:h,onSelection:t,multiSelectedArr:j}}const K=a=>{const{onChange:d,pageSizeArr:h=[5,10,15,20,50,100],currentPage:l=1,pageSize:p=5,total:b=0,pagerCount:j=7}=a,x=Math.ceil(b/p),i=M(x,j,l),C=t=>{d(1,parseInt(t.target.value))},c=t=>{t===l||t===0||t===x+1||d(t,p)},N=t=>{if(t.key==="Enter"){const s=parseInt(t.target.value);if(s<0||s>x||s===l)return;d(s,p)}};return e.jsxs("div",{className:"flex items-center",children:[`共${b}条`,e.jsx(A,{className:"ml-4",children:e.jsx($,{options:h.map(t=>({labal:t,value:`${t}条/页`})),fill:!0,onChange:C})}),e.jsxs(A,{className:"ml-4",children:[e.jsx(r,{icon:"caret-left",onClick:()=>c(l-1)}),i[0]&&i[0].map((t,s)=>e.jsx(r,{onClick:()=>c(t),intent:l===t?"primary":"none",children:t},s)),i[1]&&i[1].length>0&&e.jsx(r,{className:"before:absolute before:bottom-0.5 text-2xl before:content-['···'] hover:before:content-['«']",onClick:()=>c(l-j)}),i[2]&&i[2].map((t,s)=>e.jsx(r,{onClick:()=>c(t),intent:l===t?"primary":"none",children:t},s)),i[3]&&i[3].length>0&&e.jsx(r,{className:"before:absolute before:bottom-0.5 text-2xl before:content-['···'] hover:before:content-['»']",onClick:()=>c(l+j)}),i[4]&&i[4].map((t,s)=>e.jsx(r,{onClick:()=>c(t),intent:l===t?"primary":"none",children:t},s)),e.jsx(r,{icon:"caret-right",onClick:()=>c(l+1)})]}),e.jsxs("div",{className:"flex items-center ml-4",children:[e.jsx("span",{children:"前往"}),e.jsx(O,{defaultValue:"1",className:"w-16 mx-2",inputClassName:"text-center",onKeyUp:N}),e.jsx("span",{children:"页"})]})]})},se=()=>{const{tableData:a,tableRef:d,updateTable:h,loading:l,pager:p,onSelection:b,multiSelectedArr:j}=I(k.getUserList,{}),{BUTTONS:x}=V(),i=(()=>Object.keys(x).reduce((n,u)=>n+u.length*14+43,100))(),C=()=>{E.emit(D.OpenUserDrawer,{state:"add"})},c=n=>{E.emit(D.OpenUserDrawer,{user:n,state:"edit"})},N=n=>{E.emit(D.OpenUserDrawer,{user:n,state:"edit"})},t=async n=>{await v({handler:k.deleteUser,param:{id:n.id},message:`确认重置${n.nick}的密码吗？`,intent:"warning"})},s=async n=>{await v({handler:k.deleteUser,param:{id:n.id},message:`确认删除${n.nick}吗？`,icon:"trash",intent:"danger"})},o=(n,u)=>{h({pageNum:n,pageSize:u})},m=n=>e.jsx(y,{className:"flex items-center justify-center",children:n+1}),f=n=>e.jsx(y,{className:"flex items-center justify-center",children:e.jsxs(F,{minimal:!0,children:[e.jsx(r,{onClick:()=>c(a[n]),intent:"primary",icon:"eye-open",children:"查看"}),x.edit&&e.jsx(r,{onClick:()=>N(a[n]),intent:"primary",icon:"edit",children:"编辑"}),x.edit&&e.jsx(r,{onClick:()=>t(a[n]),intent:"success",icon:"refresh",children:"重置密码"}),x.delete&&e.jsx(r,{onClick:()=>s(a[n]),intent:"danger",icon:"delete",children:"删除"})]})}),P=n=>{var u;return e.jsx(y,{className:"flex items-center justify-center",children:(u=a[n])==null?void 0:u.id})},U=n=>{var u;return e.jsx(y,{className:"flex items-center justify-center",children:(u=a[n])==null?void 0:u.nick})},H=n=>{var u;return e.jsx(y,{className:"flex items-center justify-center",children:(u=a[n])==null?void 0:u.tel})};return e.jsxs("div",{className:"flex h-full flex-col",children:[e.jsxs(z,{className:"flex justify-between pb-0",children:[e.jsxs("div",{className:"flex",children:[e.jsx(S,{inline:!0,label:"姓名",labelFor:"search-input",className:"mr-2",children:e.jsx(O,{id:"search-input",placeholder:"请输入姓名",intent:"none"})}),e.jsx(S,{inline:!0,label:"电话",labelFor:"text-input",className:"mr-2",children:e.jsx(O,{id:"text-input",placeholder:"请输入电话",intent:"none"})})]}),e.jsxs("div",{className:"flex",children:[e.jsx(S,{inline:!0,className:"mr-2",children:e.jsx(r,{icon:"search",text:"搜索"})}),e.jsx(S,{inline:!0,children:e.jsx(r,{icon:"reset",text:"重置"})})]})]}),e.jsxs(z,{className:"mt-3 flex min-h-0 flex-auto flex-col",children:[e.jsx("div",{className:"flex",children:x.delete&&e.jsxs(e.Fragment,{children:[e.jsx(S,{inline:!0,className:"mr-2",children:e.jsx(r,{onClick:C,icon:"search",text:"新增用户"})}),e.jsx(S,{inline:!0,className:"mr-2",children:e.jsx(r,{icon:"search",text:"批量删除",disabled:j.length===0})})]})}),e.jsx("div",{className:"min-h-0 flex-auto",children:e.jsx(B,{children:e.jsxs(G,{ref:d,className:"overflow-x-hidden",numRows:a.length,rowHeights:L(()=>40,a.length),loadingOptions:l,rowHeaderCellRenderer:m,onSelection:n=>b(n,"id"),selectionModes:W.ROWS_ONLY,columnWidths:[i,50,100,100],numFrozenColumns:1,cellRendererDependencies:[a],children:[e.jsx(w,{id:"user-operation",name:"操作",cellRenderer:f}),e.jsx(w,{id:"user-id",name:"ID",cellRenderer:P}),e.jsx(w,{id:"user-nick",name:"昵称",cellRenderer:U}),e.jsx(w,{id:"user-tel",name:"电话",cellRenderer:H})]})})}),e.jsx("div",{className:"mt-4 flex justify-center",children:e.jsx(K,{...p,pagerCount:7,pageSizeArr:[5,10,15,20,50,100,500],onChange:o})})]}),e.jsx(_,{})]})};export{se as default};
