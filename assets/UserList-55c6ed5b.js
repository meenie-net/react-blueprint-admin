import{r as S,aB as G,aC as P,aD as U,j as e,B as i,K as v,aE as k,aF as j,aG as g,aH as T,F as w,aA as M,aI as D,H as F}from"./index-06fe1d62.js";import{a as y,T as _,S as B,C as E,b as A}from"./table2-dccd9926.js";import W from"./UserDrawer-67d14ed7.js";import{C as O,H as $}from"./htmlSelect-5ae7b7dd.js";import{C as H}from"./card-40fe2055.js";function I(r,c){const[p,l]=S.useState({pageSize:5,currentPage:1,total:0}),[u,C]=S.useState([...G(()=>({}),13)]),[h,f]=S.useState([]),[a,b]=S.useState([y.CELLS,y.COLUMN_HEADERS,y.ROW_HEADERS]),o=S.useRef(null),R=async s=>{b([y.CELLS,y.COLUMN_HEADERS,y.ROW_HEADERS]);const d=s||(c==null?void 0:c.param)||{pageSize:p.pageSize,pageNum:p.currentPage},{data:m}=await r(d);m.data&&(C([...m.data]),l({pageSize:m.pageSize||d.pageSize,currentPage:m.pageNum||d.pageNum,total:m.total||m.data.length}),b([]))};S.useEffect(()=>{R()},[]);const t=(s,d)=>{const m=s.map(N=>{if(N.rows!=null)return P(N.rows[0],N.rows[1],1)}).flat().map(N=>u[N][d]);f(m)};return S.useEffect(()=>{const s=new ResizeObserver(()=>{if(!o.current)return;const d=o.current;if(!d.locator)return;const m=d.locator.getViewportRect();c!=null&&c.widthArr&&d.setState({...d.state,viewportRect:m}),d.componentDidMount()});return s.observe(document.body),()=>{s.disconnect()}},[u]),{tableData:u,tableRef:o,updateTable:R,loading:a,pager:p,onSelection:t,multiSelectedArr:h}}const V=r=>{const{onChange:c,pageSizeArr:p=[5,10,15,20,50,100],currentPage:l=1,pageSize:u=5,total:C=0,pagerCount:h=7}=r,f=Math.ceil(C/u),a=U(f,h,l),b=t=>{c(1,parseInt(t.target.value))},o=t=>{t===l||t===0||t===f+1||c(t,u)},R=t=>{if(t.key==="Enter"){const s=parseInt(t.target.value);if(s<0||s>f||s===l)return;c(s,u)}};return e.jsxs("div",{className:"flex items-center",children:[`共${C}条`,e.jsx(O,{className:"ml-4",children:e.jsx($,{options:p.map(t=>({labal:t,value:`${t}条/页`})),fill:!0,onChange:b})}),e.jsxs(O,{className:"ml-4",children:[e.jsx(i,{icon:"caret-left",onClick:()=>o(l-1)}),a[0]&&a[0].map((t,s)=>e.jsx(i,{onClick:()=>o(t),intent:l===t?"primary":"none",children:t},s)),a[1]&&a[1].length>0&&e.jsx(i,{className:"before:absolute before:bottom-0.5 text-2xl before:content-['···'] hover:before:content-['«']",onClick:()=>o(l-h)}),a[2]&&a[2].map((t,s)=>e.jsx(i,{onClick:()=>o(t),intent:l===t?"primary":"none",children:t},s)),a[3]&&a[3].length>0&&e.jsx(i,{className:"before:absolute before:bottom-0.5 text-2xl before:content-['···'] hover:before:content-['»']",onClick:()=>o(l+h)}),a[4]&&a[4].map((t,s)=>e.jsx(i,{onClick:()=>o(t),intent:l===t?"primary":"none",children:t},s)),e.jsx(i,{icon:"caret-right",onClick:()=>o(l+1)})]}),e.jsxs("div",{className:"flex items-center ml-4",children:[e.jsx("span",{children:"前往"}),e.jsx(v,{defaultValue:"1",className:"w-16 mx-2",inputClassName:"text-center",onKeyUp:R}),e.jsx("span",{children:"页"})]})]})},z=r=>{const{handler:c,param:p,message:l,icon:u,intent:C}=r;return k.clear(),j.emit(g.OpenGlobalAlert,{message:l,icon:u,intent:C}),new Promise((h,f)=>{const a=async()=>{const{code:b}=await c(p);b===T.SUCCESS?(k.show({message:"成功",icon:"tick",intent:"success",timeout:1e3}),h(!0)):(f(!1),k.show({message:"失败",icon:"cross",intent:"danger"})),j.off(g.GlobalAlertConfirm,a),j.emit(g.CloseGlobalAlert)};j.on(g.GlobalAlertConfirm,a),j.on(g.GlobalAlertCancel,()=>{j.off(g.GlobalAlertConfirm,a)})})},X=()=>{const{tableData:r,tableRef:c,updateTable:p,loading:l,pager:u,onSelection:C,multiSelectedArr:h}=I(D.getUserList,{}),f=()=>{j.emit(g.OpenUserDrawer,{state:"add"})},a=n=>{j.emit(g.OpenUserDrawer,{user:n,state:"edit"})},b=n=>{j.emit(g.OpenUserDrawer,{user:n,state:"edit"})},o=async n=>{await z({handler:D.deleteUser,param:{id:n.id},message:`确认重置${n.nick}的密码吗？`,intent:"warning"})},R=async n=>{await z({handler:D.deleteUser,param:{id:n.id},message:`确认删除${n.nick}吗？`,icon:"trash",intent:"danger"})},t=(n,x)=>{p({pageNum:n,pageSize:x})},s=n=>e.jsx(A,{className:"flex items-center justify-center",children:n+1}),d=n=>e.jsx(A,{className:"flex items-center justify-center",children:e.jsxs(F,{minimal:!0,children:[e.jsx(i,{onClick:()=>a(r[n]),intent:"primary",icon:"eye-open",children:"查看"}),e.jsx(i,{onClick:()=>b(r[n]),intent:"primary",icon:"edit",children:"编辑"}),e.jsx(i,{onClick:()=>o(r[n]),intent:"success",icon:"refresh",children:"重置密码"}),e.jsx(i,{onClick:()=>R(r[n]),intent:"danger",icon:"delete",children:"删除"})]})}),m=n=>{var x;return e.jsx(A,{className:"flex items-center justify-center",children:(x=r[n])==null?void 0:x.id})},N=n=>{var x;return e.jsx(A,{className:"flex items-center justify-center",children:(x=r[n])==null?void 0:x.nick})},L=n=>{var x;return e.jsx(A,{className:"flex items-center justify-center",children:(x=r[n])==null?void 0:x.tel})};return e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs(H,{className:"flex justify-between pb-0",children:[e.jsxs("div",{className:"flex",children:[e.jsx(w,{inline:!0,label:"姓名",labelFor:"search-input",className:"mr-2",children:e.jsx(v,{id:"search-input",placeholder:"请输入姓名",intent:"none"})}),e.jsx(w,{inline:!0,label:"电话",labelFor:"text-input",className:"mr-2",children:e.jsx(v,{id:"text-input",placeholder:"请输入电话",intent:"none"})})]}),e.jsxs("div",{className:"flex",children:[e.jsx(w,{inline:!0,className:"mr-2",children:e.jsx(i,{icon:"search",text:"搜索"})}),e.jsx(w,{inline:!0,children:e.jsx(i,{icon:"reset",text:"重置"})})]})]}),e.jsxs(H,{className:"flex flex-col flex-auto min-h-0 mt-3",children:[e.jsxs("div",{className:"flex",children:[e.jsx(w,{inline:!0,className:"mr-2",children:e.jsx(i,{onClick:f,icon:"search",text:"新增用户"})}),e.jsx(w,{inline:!0,className:"mr-2",children:e.jsx(i,{icon:"search",text:"批量删除",disabled:h.length===0})})]}),e.jsx("div",{className:"flex-auto min-h-0",children:e.jsx(M,{children:e.jsxs(_,{ref:c,className:"overflow-x-hidden",numRows:r.length,rowHeights:G(()=>40,r.length),loadingOptions:l,rowHeaderCellRenderer:s,onSelection:n=>C(n,"id"),selectionModes:B.ROWS_ONLY,columnWidths:[350,50,100,100],numFrozenColumns:1,cellRendererDependencies:[r],children:[e.jsx(E,{id:"user-operation",name:"操作",cellRenderer:d}),e.jsx(E,{id:"user-id",name:"ID",cellRenderer:m}),e.jsx(E,{id:"user-nick",name:"昵称",cellRenderer:N}),e.jsx(E,{id:"user-tel",name:"电话",cellRenderer:L})]})})}),e.jsx("div",{className:"flex justify-center mt-4",children:e.jsx(V,{...u,pagerCount:7,pageSizeArr:[5,10,15,20,50,100,500],onChange:t})})]}),e.jsx(W,{})]})};export{X as default};
