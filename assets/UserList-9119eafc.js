import{_ as T,b as z,c as M,aB as U,D as I,e as F,L as B,aC as W,r as g,h as k,ap as $,A as V,aD as H,aE as K,aF as J,j as e,G as p,I as P,aG as D,aH as N,aI as S,aJ as Y,av as v,aA as q,aK as L,C as Q}from"./index-6b90eefa.js";import{a as E,T as X,S as Z,C as A,b as y}from"./table2-52b35ecc.js";import ee from"./UserDrawer-0dd5413a.js";import{C as O}from"./controlGroup-3bef5b1b.js";import{C as _}from"./card-c50cd6bf.js";var te=function(l){T(i,l);function i(){return l!==null&&l.apply(this,arguments)||this}return i.prototype.render=function(){var c,n=this.props,h=n.className,x=n.disabled,f=n.elementRef,j=n.fill,r=n.iconName,b=r===void 0?"double-caret-vertical":r,o=n.iconProps,R=n.large,t=n.minimal,s=n.options,d=s===void 0?[]:s,m=z(n,["className","disabled","elementRef","fill","iconName","iconProps","large","minimal","options"]),C=M(U,(c={},c[I]=x,c[F]=j,c[B]=R,c[W]=t,c),h),w=d.map(function(a){var u=typeof a=="object"?a:{value:a};return g.createElement("option",k({},u,{key:u.value,children:u.label||u.value}))});return g.createElement("div",{className:C},g.createElement("select",k({disabled:x,ref:f,value:this.props.value},m,{multiple:!1}),w,m.children),g.createElement($,k({icon:b,title:"Open dropdown"},o)))},i}(V);function ae(l,i){const[c,n]=g.useState({pageSize:5,currentPage:1,total:0}),[h,x]=g.useState([...H(()=>({}),13)]),[f,j]=g.useState([]),[r,b]=g.useState([E.CELLS,E.COLUMN_HEADERS,E.ROW_HEADERS]),o=g.useRef(null),R=async s=>{b([E.CELLS,E.COLUMN_HEADERS,E.ROW_HEADERS]);const d=s||(i==null?void 0:i.param)||{pageSize:c.pageSize,pageNum:c.currentPage},{data:m}=await l(d);m.data&&(x([...m.data]),n({pageSize:m.pageSize||d.pageSize,currentPage:m.pageNum||d.pageNum,total:m.total||m.data.length}),b([]))};g.useEffect(()=>{R()},[]);const t=(s,d)=>{const m=s.map(C=>{if(C.rows!=null)return K(C.rows[0],C.rows[1],1)}).flat().map(C=>h[C][d]);j(m)};return g.useEffect(()=>{const s=new ResizeObserver(()=>{if(!o.current)return;const d=o.current;if(!d.locator)return;const m=d.locator.getViewportRect();i!=null&&i.widthArr&&d.setState({...d.state,viewportRect:m}),d.componentDidMount()});return s.observe(document.body),()=>{s.disconnect()}},[h]),{tableData:h,tableRef:o,updateTable:R,loading:r,pager:c,onSelection:t,multiSelectedArr:f}}const ne=l=>{const{onChange:i,pageSizeArr:c=[5,10,15,20,50,100],currentPage:n=1,pageSize:h=5,total:x=0,pagerCount:f=7}=l,j=Math.ceil(x/h),r=J(j,f,n),b=t=>{i(1,parseInt(t.target.value))},o=t=>{t===n||t===0||t===j+1||i(t,h)},R=t=>{if(t.key==="Enter"){const s=parseInt(t.target.value);if(s<0||s>j||s===n)return;i(s,h)}};return e.jsxs("div",{className:"flex items-center",children:[`共${x}条`,e.jsx(O,{className:"ml-4",children:e.jsx(te,{options:c.map(t=>({labal:t,value:`${t}条/页`})),fill:!0,onChange:b})}),e.jsxs(O,{className:"ml-4",children:[e.jsx(p,{icon:"caret-left",onClick:()=>o(n-1)}),r[0]&&r[0].map((t,s)=>e.jsx(p,{onClick:()=>o(t),intent:n===t?"primary":"none",children:t},s)),r[1]&&r[1].length>0&&e.jsx(p,{className:"before:absolute before:bottom-0.5 text-2xl before:content-['···'] hover:before:content-['«']",onClick:()=>o(n-f)}),r[2]&&r[2].map((t,s)=>e.jsx(p,{onClick:()=>o(t),intent:n===t?"primary":"none",children:t},s)),r[3]&&r[3].length>0&&e.jsx(p,{className:"before:absolute before:bottom-0.5 text-2xl before:content-['···'] hover:before:content-['»']",onClick:()=>o(n+f)}),r[4]&&r[4].map((t,s)=>e.jsx(p,{onClick:()=>o(t),intent:n===t?"primary":"none",children:t},s)),e.jsx(p,{icon:"caret-right",onClick:()=>o(n+1)})]}),e.jsxs("div",{className:"flex items-center ml-4",children:[e.jsx("span",{children:"前往"}),e.jsx(P,{defaultValue:"1",className:"w-16 mx-2",inputClassName:"text-center",onKeyUp:R}),e.jsx("span",{children:"页"})]})]})},G=l=>{const{handler:i,param:c,message:n,icon:h,intent:x}=l;return D.clear(),N.emit(S.OpenGlobalAlert,{message:n,icon:h,intent:x}),new Promise((f,j)=>{const r=async()=>{const{code:b}=await i(c);b===Y.SUCCESS?(D.show({message:"成功",icon:"tick",intent:"success",timeout:1e3}),f(!0)):(j(!1),D.show({message:"失败",icon:"cross",intent:"danger"})),N.off(S.GlobalAlertConfirm,r),N.emit(S.CloseGlobalAlert)};N.on(S.GlobalAlertConfirm,r),N.on(S.GlobalAlertCancel,()=>{N.off(S.GlobalAlertConfirm,r)})})},oe=()=>{const{tableData:l,tableRef:i,updateTable:c,loading:n,pager:h,onSelection:x,multiSelectedArr:f}=ae(L.getUserList,{}),j=()=>{N.emit(S.OpenUserDrawer,{state:"add"})},r=a=>{N.emit(S.OpenUserDrawer,{user:a,state:"edit"})},b=a=>{N.emit(S.OpenUserDrawer,{user:a,state:"edit"})},o=async a=>{await G({handler:L.deleteUser,param:{id:a.id},message:`确认重置${a.nick}的密码吗？`,intent:"warning"})},R=async a=>{await G({handler:L.deleteUser,param:{id:a.id},message:`确认删除${a.nick}吗？`,icon:"trash",intent:"danger"})},t=(a,u)=>{c({pageNum:a,pageSize:u})},s=a=>e.jsx(y,{className:"flex items-center justify-center",children:a+1}),d=a=>e.jsx(y,{className:"flex items-center justify-center",children:e.jsxs(Q,{minimal:!0,children:[e.jsx(p,{onClick:()=>r(l[a]),intent:"primary",icon:"eye-open",children:"查看"}),e.jsx(p,{onClick:()=>b(l[a]),intent:"primary",icon:"edit",children:"编辑"}),e.jsx(p,{onClick:()=>o(l[a]),intent:"success",icon:"refresh",children:"重置密码"}),e.jsx(p,{onClick:()=>R(l[a]),intent:"danger",icon:"delete",children:"删除"})]})}),m=a=>{var u;return e.jsx(y,{className:"flex items-center justify-center",children:(u=l[a])==null?void 0:u.id})},C=a=>{var u;return e.jsx(y,{className:"flex items-center justify-center",children:(u=l[a])==null?void 0:u.nick})},w=a=>{var u;return e.jsx(y,{className:"flex items-center justify-center",children:(u=l[a])==null?void 0:u.tel})};return e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs(_,{className:"flex justify-between pb-0",children:[e.jsxs("div",{className:"flex",children:[e.jsx(v,{inline:!0,label:"姓名",labelFor:"search-input",className:"mr-2",children:e.jsx(P,{id:"search-input",placeholder:"请输入姓名",intent:"none"})}),e.jsx(v,{inline:!0,label:"电话",labelFor:"text-input",className:"mr-2",children:e.jsx(P,{id:"text-input",placeholder:"请输入电话",intent:"none"})})]}),e.jsxs("div",{className:"flex",children:[e.jsx(v,{inline:!0,className:"mr-2",children:e.jsx(p,{icon:"search",text:"搜索"})}),e.jsx(v,{inline:!0,children:e.jsx(p,{icon:"reset",text:"重置"})})]})]}),e.jsxs(_,{className:"flex flex-col flex-auto min-h-0 mt-3",children:[e.jsxs("div",{className:"flex",children:[e.jsx(v,{inline:!0,className:"mr-2",children:e.jsx(p,{onClick:j,icon:"search",text:"新增用户"})}),e.jsx(v,{inline:!0,className:"mr-2",children:e.jsx(p,{icon:"search",text:"批量删除",disabled:f.length===0})})]}),e.jsx("div",{className:"flex-auto min-h-0",children:e.jsx(q,{children:e.jsxs(X,{ref:i,className:"overflow-x-hidden",numRows:l.length,rowHeights:H(()=>40,l.length),loadingOptions:n,rowHeaderCellRenderer:s,onSelection:a=>x(a,"id"),selectionModes:Z.ROWS_ONLY,columnWidths:[350,50,100,100],numFrozenColumns:1,cellRendererDependencies:[l],children:[e.jsx(A,{id:"user-operation",name:"操作",cellRenderer:d}),e.jsx(A,{id:"user-id",name:"ID",cellRenderer:m}),e.jsx(A,{id:"user-nick",name:"昵称",cellRenderer:C}),e.jsx(A,{id:"user-tel",name:"电话",cellRenderer:w})]})})}),e.jsx("div",{className:"flex justify-center mt-4",children:e.jsx(ne,{...h,pagerCount:7,pageSizeArr:[5,10,15,20,50,100,500],onChange:t})})]}),e.jsx(ee,{})]})};export{oe as default};
