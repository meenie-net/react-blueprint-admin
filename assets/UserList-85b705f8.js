import{_ as T,b as M,c as H,C as F,F as U,V,r as g,d as L,D as B,A as z,e as W,f as $,L as Y,M as K,I as X,g as I,h as q,i as J,j as e,B as u,k as P,l as k,m as R,E as S,R as Q,n as E,H as Z,o as D,p as ee}from"./index-a7a6237e.js";import{a as y,T as te,S as ne,C as w,b as A}from"./table2-ac485f5d.js";import ae from"./UserDrawer-f6cb7c12.js";import{C as O}from"./card-82cc5906.js";var _=function(s){T(r,s);function r(){return s!==null&&s.apply(this,arguments)||this}return r.prototype.render=function(){var c,t=this.props,d=t.children,h=t.className,f=t.elementRef,x=t.fill,l=t.vertical,j=M(t,["children","className","elementRef","fill","vertical"]),o=H(F,(c={},c[U]=x,c[V]=l,c),h);return g.createElement("div",L({},j,{className:o,ref:f}),d)},r.displayName="".concat(B,".ControlGroup"),r}(z),se=function(s){T(r,s);function r(){return s!==null&&s.apply(this,arguments)||this}return r.prototype.render=function(){var c,t=this.props,d=t.className,h=t.disabled,f=t.elementRef,x=t.fill,l=t.iconProps,j=t.large,o=t.minimal,N=t.options,n=N===void 0?[]:N,i=M(t,["className","disabled","elementRef","fill","iconProps","large","minimal","options"]),m=H(W,(c={},c[$]=h,c[U]=x,c[Y]=j,c[K]=o,c),d),p=n.map(function(b){var v=typeof b=="object"?b:{value:b};return g.createElement("option",L({},v,{key:v.value,children:v.label||v.value}))});return g.createElement("div",{className:m},g.createElement("select",L({disabled:h,ref:f,value:this.props.value},i,{multiple:!1}),p,i.children),g.createElement(X,L({icon:"double-caret-vertical",title:"Open dropdown"},l)))},r}(z);function re(s,r){const[c,t]=g.useState({pageSize:5,currentPage:1,total:0}),[d,h]=g.useState([...I(()=>({}),13)]),[f,x]=g.useState([]),[l,j]=g.useState([y.CELLS,y.COLUMN_HEADERS,y.ROW_HEADERS]),o=g.useRef(null),N=async i=>{j([y.CELLS,y.COLUMN_HEADERS,y.ROW_HEADERS]);const m=i||(r==null?void 0:r.param)||{pageSize:c.pageSize,pageNum:c.currentPage},{data:p}=await s(m);p.data&&(h([...p.data]),t({pageSize:p.pageSize||m.pageSize,currentPage:p.pageNum||m.pageNum,total:p.total||p.data.length}),j([]))};g.useEffect(()=>{N()},[]);const n=(i,m)=>{const p=i.map(b=>{if(b.rows!=null)return q(b.rows[0],b.rows[1],1)}).flat().map(b=>d[b][m]);x(p)};return g.useEffect(()=>{const i=new ResizeObserver(()=>{if(!o.current)return;const m=o.current;if(!m.locator)return;const p=m.locator.getViewportRect();r!=null&&r.widthArr&&m.setState({...m.state,viewportRect:p}),m.componentDidMount()});return i.observe(document.body),()=>{i.disconnect()}},[d]),{tableData:d,tableRef:o,updateTable:N,loading:l,pager:c,onSelection:n,multiSelectedArr:f}}const le=s=>{const{onChange:r,pageSizeArr:c=[5,10,15,20,50,100],currentPage:t=1,pageSize:d=5,total:h=0,pagerCount:f=7}=s,x=Math.ceil(h/d),l=J(x,f,t),j=n=>{r(1,parseInt(n.target.value))},o=n=>{n===t||n===0||n===x+1||r(n,d)},N=n=>{if(n.key==="Enter"){const i=parseInt(n.target.value);if(i<0||i>x||i===t)return;r(i,d)}};return e.jsxs("div",{className:"flex items-center",children:[`共${h}条`,e.jsx(_,{className:"ml-4",children:e.jsx(se,{options:c.map(n=>({labal:n,value:`${n}条/页`})),fill:!0,onChange:j})}),e.jsxs(_,{className:"ml-4",children:[e.jsx(u,{icon:"caret-left",onClick:()=>o(t-1)}),l[0]&&l[0].map((n,i)=>e.jsx(u,{onClick:()=>o(n),intent:t===n?"primary":"none",children:n},i)),l[1]&&l[1].length>0&&e.jsx(u,{className:"before:absolute before:bottom-0.5 text-2xl before:content-['···'] hover:before:content-['«']",onClick:()=>o(t-f)}),l[2]&&l[2].map((n,i)=>e.jsx(u,{onClick:()=>o(n),intent:t===n?"primary":"none",children:n},i)),l[3]&&l[3].length>0&&e.jsx(u,{className:"before:absolute before:bottom-0.5 text-2xl before:content-['···'] hover:before:content-['»']",onClick:()=>o(t+f)}),l[4]&&l[4].map((n,i)=>e.jsx(u,{onClick:()=>o(n),intent:t===n?"primary":"none",children:n},i)),e.jsx(u,{icon:"caret-right",onClick:()=>o(t+1)})]}),e.jsxs("div",{className:"flex items-center ml-4",children:[e.jsx("span",{children:"前往"}),e.jsx(P,{defaultValue:"1",className:"w-16 mx-2",inputClassName:"text-center",onKeyUp:N}),e.jsx("span",{children:"页"})]})]})},G=s=>{const{handler:r,param:c,message:t,icon:d,intent:h}=s;return k.clear(),R.emit(S.OpenGlobalAlert,{message:t,icon:d,intent:h}),new Promise((f,x)=>{const l=async()=>{const{code:j}=await r(c);j===Q.SUCCESS?(k.show({message:"成功",icon:"tick",intent:"success",timeout:1e3}),f(!0)):(x(!1),k.show({message:"失败",icon:"cross",intent:"danger"})),R.off(S.GlobalAlertConfirm,l),R.emit(S.CloseGlobalAlert)};R.on(S.GlobalAlertConfirm,l),R.on(S.GlobalAlertCancel,()=>{R.off(S.GlobalAlertConfirm,l)})})},me=()=>{const{tableData:s,tableRef:r,updateTable:c,loading:t,pager:d,onSelection:h,multiSelectedArr:f}=re(D.getUserList,{}),x=()=>{R.emit(S.OpenUserDrawer,{state:"add"})},l=a=>{R.emit(S.OpenUserDrawer,{user:a,state:"edit"})},j=a=>{R.emit(S.OpenUserDrawer,{user:a,state:"edit"})},o=async a=>{await G({handler:D.deleteUser,param:{id:a.id},message:`确认重置${a.nick}的密码吗？`,intent:"warning"})},N=async a=>{await G({handler:D.deleteUser,param:{id:a.id},message:`确认删除${a.nick}吗？`,icon:"trash",intent:"danger"})},n=(a,C)=>{c({pageNum:a,pageSize:C})},i=a=>e.jsx(A,{className:"flex items-center justify-center",children:a+1}),m=a=>e.jsx(A,{className:"flex items-center justify-center",children:e.jsxs(ee,{minimal:!0,children:[e.jsx(u,{onClick:()=>l(s[a]),intent:"primary",icon:"eye-open",children:"查看"}),e.jsx(u,{onClick:()=>j(s[a]),intent:"primary",icon:"edit",children:"编辑"}),e.jsx(u,{onClick:()=>o(s[a]),intent:"success",icon:"refresh",children:"重置密码"}),e.jsx(u,{onClick:()=>N(s[a]),intent:"danger",icon:"delete",children:"删除"})]})}),p=a=>{var C;return e.jsx(A,{className:"flex items-center justify-center",children:(C=s[a])==null?void 0:C.id})},b=a=>{var C;return e.jsx(A,{className:"flex items-center justify-center",children:(C=s[a])==null?void 0:C.nick})},v=a=>{var C;return e.jsx(A,{className:"flex items-center justify-center",children:(C=s[a])==null?void 0:C.tel})};return e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs(O,{className:"flex justify-between pb-0",children:[e.jsxs("div",{className:"flex",children:[e.jsx(E,{inline:!0,label:"姓名",labelFor:"search-input",className:"mr-2",children:e.jsx(P,{id:"search-input",placeholder:"请输入姓名",intent:"none"})}),e.jsx(E,{inline:!0,label:"电话",labelFor:"text-input",className:"mr-2",children:e.jsx(P,{id:"text-input",placeholder:"请输入电话",intent:"none"})})]}),e.jsxs("div",{className:"flex",children:[e.jsx(E,{inline:!0,className:"mr-2",children:e.jsx(u,{icon:"search",text:"搜索"})}),e.jsx(E,{inline:!0,children:e.jsx(u,{icon:"reset",text:"重置"})})]})]}),e.jsxs(O,{className:"flex flex-col flex-auto min-h-0 mt-3",children:[e.jsxs("div",{className:"flex",children:[e.jsx(E,{inline:!0,className:"mr-2",children:e.jsx(u,{onClick:x,icon:"search",text:"新增用户"})}),e.jsx(E,{inline:!0,className:"mr-2",children:e.jsx(u,{icon:"search",text:"批量删除",disabled:f.length===0})})]}),e.jsx("div",{className:"flex-auto min-h-0",children:e.jsx(Z,{children:e.jsxs(te,{ref:r,className:"overflow-x-hidden",numRows:s.length,rowHeights:I(()=>40,s.length),loadingOptions:t,rowHeaderCellRenderer:i,onSelection:a=>h(a,"id"),selectionModes:ne.ROWS_ONLY,columnWidths:[350,50,100,100],numFrozenColumns:1,cellRendererDependencies:[s],children:[e.jsx(w,{id:"user-operation",name:"操作",cellRenderer:m}),e.jsx(w,{id:"user-id",name:"ID",cellRenderer:p}),e.jsx(w,{id:"user-nick",name:"昵称",cellRenderer:b}),e.jsx(w,{id:"user-tel",name:"电话",cellRenderer:v})]})})}),e.jsx("div",{className:"flex justify-center mt-4",children:e.jsx(le,{...d,pagerCount:7,pageSizeArr:[5,10,15,20,50,100,500],onChange:n})})]}),e.jsx(ae,{})]})};export{me as default};
