import{_ as T,b as M,c as H,C as F,F as U,V,r as b,d as w,D as B,A as z,e as W,f as $,L as Y,M as K,I as X,g as I,h as q,i as J,j as e,B as h,k as P,l as k,m as N,E as R,R as Q,n as S,H as Z,o as D,p as ee}from"./index-997bde68.js";import{a as E,T as te,S as ne,C as A,b as y}from"./table2-d2574ab8.js";import ae from"./UserDrawer-12febda2.js";import{C as O}from"./card-5231de88.js";var _=function(s){T(r,s);function r(){return s!==null&&s.apply(this,arguments)||this}return r.prototype.render=function(){var c,t=this.props,d=t.children,f=t.className,x=t.elementRef,j=t.fill,l=t.vertical,g=M(t,["children","className","elementRef","fill","vertical"]),o=H(F,(c={},c[U]=j,c[V]=l,c),f);return b.createElement("div",w({},g,{className:o,ref:x}),d)},r.displayName="".concat(B,".ControlGroup"),r}(z),se=function(s){T(r,s);function r(){return s!==null&&s.apply(this,arguments)||this}return r.prototype.render=function(){var c,t=this.props,d=t.className,f=t.disabled,x=t.elementRef,j=t.fill,l=t.iconName,g=l===void 0?"double-caret-vertical":l,o=t.iconProps,v=t.large,n=t.minimal,i=t.options,m=i===void 0?[]:i,u=M(t,["className","disabled","elementRef","fill","iconName","iconProps","large","minimal","options"]),C=H(W,(c={},c[$]=f,c[U]=j,c[Y]=v,c[K]=n,c),d),L=m.map(function(a){var p=typeof a=="object"?a:{value:a};return b.createElement("option",w({},p,{key:p.value,children:p.label||p.value}))});return b.createElement("div",{className:C},b.createElement("select",w({disabled:f,ref:x,value:this.props.value},u,{multiple:!1}),L,u.children),b.createElement(X,w({icon:g,title:"Open dropdown"},o)))},r}(z);function re(s,r){const[c,t]=b.useState({pageSize:5,currentPage:1,total:0}),[d,f]=b.useState([...I(()=>({}),13)]),[x,j]=b.useState([]),[l,g]=b.useState([E.CELLS,E.COLUMN_HEADERS,E.ROW_HEADERS]),o=b.useRef(null),v=async i=>{g([E.CELLS,E.COLUMN_HEADERS,E.ROW_HEADERS]);const m=i||(r==null?void 0:r.param)||{pageSize:c.pageSize,pageNum:c.currentPage},{data:u}=await s(m);u.data&&(f([...u.data]),t({pageSize:u.pageSize||m.pageSize,currentPage:u.pageNum||m.pageNum,total:u.total||u.data.length}),g([]))};b.useEffect(()=>{v()},[]);const n=(i,m)=>{const u=i.map(C=>{if(C.rows!=null)return q(C.rows[0],C.rows[1],1)}).flat().map(C=>d[C][m]);j(u)};return b.useEffect(()=>{const i=new ResizeObserver(()=>{if(!o.current)return;const m=o.current;if(!m.locator)return;const u=m.locator.getViewportRect();r!=null&&r.widthArr&&m.setState({...m.state,viewportRect:u}),m.componentDidMount()});return i.observe(document.body),()=>{i.disconnect()}},[d]),{tableData:d,tableRef:o,updateTable:v,loading:l,pager:c,onSelection:n,multiSelectedArr:x}}const le=s=>{const{onChange:r,pageSizeArr:c=[5,10,15,20,50,100],currentPage:t=1,pageSize:d=5,total:f=0,pagerCount:x=7}=s,j=Math.ceil(f/d),l=J(j,x,t),g=n=>{r(1,parseInt(n.target.value))},o=n=>{n===t||n===0||n===j+1||r(n,d)},v=n=>{if(n.key==="Enter"){const i=parseInt(n.target.value);if(i<0||i>j||i===t)return;r(i,d)}};return e.jsxs("div",{className:"flex items-center",children:[`共${f}条`,e.jsx(_,{className:"ml-4",children:e.jsx(se,{options:c.map(n=>({labal:n,value:`${n}条/页`})),fill:!0,onChange:g})}),e.jsxs(_,{className:"ml-4",children:[e.jsx(h,{icon:"caret-left",onClick:()=>o(t-1)}),l[0]&&l[0].map((n,i)=>e.jsx(h,{onClick:()=>o(n),intent:t===n?"primary":"none",children:n},i)),l[1]&&l[1].length>0&&e.jsx(h,{className:"before:absolute before:bottom-0.5 text-2xl before:content-['···'] hover:before:content-['«']",onClick:()=>o(t-x)}),l[2]&&l[2].map((n,i)=>e.jsx(h,{onClick:()=>o(n),intent:t===n?"primary":"none",children:n},i)),l[3]&&l[3].length>0&&e.jsx(h,{className:"before:absolute before:bottom-0.5 text-2xl before:content-['···'] hover:before:content-['»']",onClick:()=>o(t+x)}),l[4]&&l[4].map((n,i)=>e.jsx(h,{onClick:()=>o(n),intent:t===n?"primary":"none",children:n},i)),e.jsx(h,{icon:"caret-right",onClick:()=>o(t+1)})]}),e.jsxs("div",{className:"flex items-center ml-4",children:[e.jsx("span",{children:"前往"}),e.jsx(P,{defaultValue:"1",className:"w-16 mx-2",inputClassName:"text-center",onKeyUp:v}),e.jsx("span",{children:"页"})]})]})},G=s=>{const{handler:r,param:c,message:t,icon:d,intent:f}=s;return k.clear(),N.emit(R.OpenGlobalAlert,{message:t,icon:d,intent:f}),new Promise((x,j)=>{const l=async()=>{const{code:g}=await r(c);g===Q.SUCCESS?(k.show({message:"成功",icon:"tick",intent:"success",timeout:1e3}),x(!0)):(j(!1),k.show({message:"失败",icon:"cross",intent:"danger"})),N.off(R.GlobalAlertConfirm,l),N.emit(R.CloseGlobalAlert)};N.on(R.GlobalAlertConfirm,l),N.on(R.GlobalAlertCancel,()=>{N.off(R.GlobalAlertConfirm,l)})})},me=()=>{const{tableData:s,tableRef:r,updateTable:c,loading:t,pager:d,onSelection:f,multiSelectedArr:x}=re(D.getUserList,{}),j=()=>{N.emit(R.OpenUserDrawer,{state:"add"})},l=a=>{N.emit(R.OpenUserDrawer,{user:a,state:"edit"})},g=a=>{N.emit(R.OpenUserDrawer,{user:a,state:"edit"})},o=async a=>{await G({handler:D.deleteUser,param:{id:a.id},message:`确认重置${a.nick}的密码吗？`,intent:"warning"})},v=async a=>{await G({handler:D.deleteUser,param:{id:a.id},message:`确认删除${a.nick}吗？`,icon:"trash",intent:"danger"})},n=(a,p)=>{c({pageNum:a,pageSize:p})},i=a=>e.jsx(y,{className:"flex items-center justify-center",children:a+1}),m=a=>e.jsx(y,{className:"flex items-center justify-center",children:e.jsxs(ee,{minimal:!0,children:[e.jsx(h,{onClick:()=>l(s[a]),intent:"primary",icon:"eye-open",children:"查看"}),e.jsx(h,{onClick:()=>g(s[a]),intent:"primary",icon:"edit",children:"编辑"}),e.jsx(h,{onClick:()=>o(s[a]),intent:"success",icon:"refresh",children:"重置密码"}),e.jsx(h,{onClick:()=>v(s[a]),intent:"danger",icon:"delete",children:"删除"})]})}),u=a=>{var p;return e.jsx(y,{className:"flex items-center justify-center",children:(p=s[a])==null?void 0:p.id})},C=a=>{var p;return e.jsx(y,{className:"flex items-center justify-center",children:(p=s[a])==null?void 0:p.nick})},L=a=>{var p;return e.jsx(y,{className:"flex items-center justify-center",children:(p=s[a])==null?void 0:p.tel})};return e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs(O,{className:"flex justify-between pb-0",children:[e.jsxs("div",{className:"flex",children:[e.jsx(S,{inline:!0,label:"姓名",labelFor:"search-input",className:"mr-2",children:e.jsx(P,{id:"search-input",placeholder:"请输入姓名",intent:"none"})}),e.jsx(S,{inline:!0,label:"电话",labelFor:"text-input",className:"mr-2",children:e.jsx(P,{id:"text-input",placeholder:"请输入电话",intent:"none"})})]}),e.jsxs("div",{className:"flex",children:[e.jsx(S,{inline:!0,className:"mr-2",children:e.jsx(h,{icon:"search",text:"搜索"})}),e.jsx(S,{inline:!0,children:e.jsx(h,{icon:"reset",text:"重置"})})]})]}),e.jsxs(O,{className:"flex flex-col flex-auto min-h-0 mt-3",children:[e.jsxs("div",{className:"flex",children:[e.jsx(S,{inline:!0,className:"mr-2",children:e.jsx(h,{onClick:j,icon:"search",text:"新增用户"})}),e.jsx(S,{inline:!0,className:"mr-2",children:e.jsx(h,{icon:"search",text:"批量删除",disabled:x.length===0})})]}),e.jsx("div",{className:"flex-auto min-h-0",children:e.jsx(Z,{children:e.jsxs(te,{ref:r,className:"overflow-x-hidden",numRows:s.length,rowHeights:I(()=>40,s.length),loadingOptions:t,rowHeaderCellRenderer:i,onSelection:a=>f(a,"id"),selectionModes:ne.ROWS_ONLY,columnWidths:[350,50,100,100],numFrozenColumns:1,cellRendererDependencies:[s],children:[e.jsx(A,{id:"user-operation",name:"操作",cellRenderer:m}),e.jsx(A,{id:"user-id",name:"ID",cellRenderer:u}),e.jsx(A,{id:"user-nick",name:"昵称",cellRenderer:C}),e.jsx(A,{id:"user-tel",name:"电话",cellRenderer:L})]})})}),e.jsx("div",{className:"flex justify-center mt-4",children:e.jsx(le,{...d,pagerCount:7,pageSizeArr:[5,10,15,20,50,100,500],onChange:n})})]}),e.jsx(ae,{})]})};export{me as default};
