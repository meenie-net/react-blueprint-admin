import{_ as T,b as z,c as M,aB as U,D as I,e as F,L as B,aC as W,r as g,h as k,ap as $,A as V,aD as H,aE as K,aF as J,j as e,G as m,I as P,aG as D,aH as S,aI as R,aJ as Y,av as E,aA as q,aK as L,C as Q}from"./index-3b7cfa19.js";import{a as y,T as X,S as Z,C as w,b as A}from"./table2-d7b04974.js";import ee from"./UserDrawer-e3d1bffa.js";import{C as O}from"./controlGroup-9543f625.js";import{C as G}from"./card-0a51f0a4.js";var te=function(r){T(i,r);function i(){return r!==null&&r.apply(this,arguments)||this}return i.prototype.render=function(){var c,a=this.props,p=a.className,h=a.disabled,x=a.elementRef,f=a.fill,l=a.iconProps,b=a.large,o=a.minimal,N=a.options,t=N===void 0?[]:N,s=z(a,["className","disabled","elementRef","fill","iconProps","large","minimal","options"]),d=M(U,(c={},c[I]=h,c[F]=f,c[B]=b,c[W]=o,c),p),u=t.map(function(j){var v=typeof j=="object"?j:{value:j};return g.createElement("option",k({},v,{key:v.value,children:v.label||v.value}))});return g.createElement("div",{className:d},g.createElement("select",k({disabled:h,ref:x,value:this.props.value},s,{multiple:!1}),u,s.children),g.createElement($,k({icon:"double-caret-vertical",title:"Open dropdown"},l)))},i}(V);function ae(r,i){const[c,a]=g.useState({pageSize:5,currentPage:1,total:0}),[p,h]=g.useState([...H(()=>({}),13)]),[x,f]=g.useState([]),[l,b]=g.useState([y.CELLS,y.COLUMN_HEADERS,y.ROW_HEADERS]),o=g.useRef(null),N=async s=>{b([y.CELLS,y.COLUMN_HEADERS,y.ROW_HEADERS]);const d=s||(i==null?void 0:i.param)||{pageSize:c.pageSize,pageNum:c.currentPage},{data:u}=await r(d);u.data&&(h([...u.data]),a({pageSize:u.pageSize||d.pageSize,currentPage:u.pageNum||d.pageNum,total:u.total||u.data.length}),b([]))};g.useEffect(()=>{N()},[]);const t=(s,d)=>{const u=s.map(j=>{if(j.rows!=null)return K(j.rows[0],j.rows[1],1)}).flat().map(j=>p[j][d]);f(u)};return g.useEffect(()=>{const s=new ResizeObserver(()=>{if(!o.current)return;const d=o.current;if(!d.locator)return;const u=d.locator.getViewportRect();i!=null&&i.widthArr&&d.setState({...d.state,viewportRect:u}),d.componentDidMount()});return s.observe(document.body),()=>{s.disconnect()}},[p]),{tableData:p,tableRef:o,updateTable:N,loading:l,pager:c,onSelection:t,multiSelectedArr:x}}const ne=r=>{const{onChange:i,pageSizeArr:c=[5,10,15,20,50,100],currentPage:a=1,pageSize:p=5,total:h=0,pagerCount:x=7}=r,f=Math.ceil(h/p),l=J(f,x,a),b=t=>{i(1,parseInt(t.target.value))},o=t=>{t===a||t===0||t===f+1||i(t,p)},N=t=>{if(t.key==="Enter"){const s=parseInt(t.target.value);if(s<0||s>f||s===a)return;i(s,p)}};return e.jsxs("div",{className:"flex items-center",children:[`共${h}条`,e.jsx(O,{className:"ml-4",children:e.jsx(te,{options:c.map(t=>({labal:t,value:`${t}条/页`})),fill:!0,onChange:b})}),e.jsxs(O,{className:"ml-4",children:[e.jsx(m,{icon:"caret-left",onClick:()=>o(a-1)}),l[0]&&l[0].map((t,s)=>e.jsx(m,{onClick:()=>o(t),intent:a===t?"primary":"none",children:t},s)),l[1]&&l[1].length>0&&e.jsx(m,{className:"before:absolute before:bottom-0.5 text-2xl before:content-['···'] hover:before:content-['«']",onClick:()=>o(a-x)}),l[2]&&l[2].map((t,s)=>e.jsx(m,{onClick:()=>o(t),intent:a===t?"primary":"none",children:t},s)),l[3]&&l[3].length>0&&e.jsx(m,{className:"before:absolute before:bottom-0.5 text-2xl before:content-['···'] hover:before:content-['»']",onClick:()=>o(a+x)}),l[4]&&l[4].map((t,s)=>e.jsx(m,{onClick:()=>o(t),intent:a===t?"primary":"none",children:t},s)),e.jsx(m,{icon:"caret-right",onClick:()=>o(a+1)})]}),e.jsxs("div",{className:"flex items-center ml-4",children:[e.jsx("span",{children:"前往"}),e.jsx(P,{defaultValue:"1",className:"w-16 mx-2",inputClassName:"text-center",onKeyUp:N}),e.jsx("span",{children:"页"})]})]})},_=r=>{const{handler:i,param:c,message:a,icon:p,intent:h}=r;return D.clear(),S.emit(R.OpenGlobalAlert,{message:a,icon:p,intent:h}),new Promise((x,f)=>{const l=async()=>{const{code:b}=await i(c);b===Y.SUCCESS?(D.show({message:"成功",icon:"tick",intent:"success",timeout:1e3}),x(!0)):(f(!1),D.show({message:"失败",icon:"cross",intent:"danger"})),S.off(R.GlobalAlertConfirm,l),S.emit(R.CloseGlobalAlert)};S.on(R.GlobalAlertConfirm,l),S.on(R.GlobalAlertCancel,()=>{S.off(R.GlobalAlertConfirm,l)})})},oe=()=>{const{tableData:r,tableRef:i,updateTable:c,loading:a,pager:p,onSelection:h,multiSelectedArr:x}=ae(L.getUserList,{}),f=()=>{S.emit(R.OpenUserDrawer,{state:"add"})},l=n=>{S.emit(R.OpenUserDrawer,{user:n,state:"edit"})},b=n=>{S.emit(R.OpenUserDrawer,{user:n,state:"edit"})},o=async n=>{await _({handler:L.deleteUser,param:{id:n.id},message:`确认重置${n.nick}的密码吗？`,intent:"warning"})},N=async n=>{await _({handler:L.deleteUser,param:{id:n.id},message:`确认删除${n.nick}吗？`,icon:"trash",intent:"danger"})},t=(n,C)=>{c({pageNum:n,pageSize:C})},s=n=>e.jsx(A,{className:"flex items-center justify-center",children:n+1}),d=n=>e.jsx(A,{className:"flex items-center justify-center",children:e.jsxs(Q,{minimal:!0,children:[e.jsx(m,{onClick:()=>l(r[n]),intent:"primary",icon:"eye-open",children:"查看"}),e.jsx(m,{onClick:()=>b(r[n]),intent:"primary",icon:"edit",children:"编辑"}),e.jsx(m,{onClick:()=>o(r[n]),intent:"success",icon:"refresh",children:"重置密码"}),e.jsx(m,{onClick:()=>N(r[n]),intent:"danger",icon:"delete",children:"删除"})]})}),u=n=>{var C;return e.jsx(A,{className:"flex items-center justify-center",children:(C=r[n])==null?void 0:C.id})},j=n=>{var C;return e.jsx(A,{className:"flex items-center justify-center",children:(C=r[n])==null?void 0:C.nick})},v=n=>{var C;return e.jsx(A,{className:"flex items-center justify-center",children:(C=r[n])==null?void 0:C.tel})};return e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs(G,{className:"flex justify-between pb-0",children:[e.jsxs("div",{className:"flex",children:[e.jsx(E,{inline:!0,label:"姓名",labelFor:"search-input",className:"mr-2",children:e.jsx(P,{id:"search-input",placeholder:"请输入姓名",intent:"none"})}),e.jsx(E,{inline:!0,label:"电话",labelFor:"text-input",className:"mr-2",children:e.jsx(P,{id:"text-input",placeholder:"请输入电话",intent:"none"})})]}),e.jsxs("div",{className:"flex",children:[e.jsx(E,{inline:!0,className:"mr-2",children:e.jsx(m,{icon:"search",text:"搜索"})}),e.jsx(E,{inline:!0,children:e.jsx(m,{icon:"reset",text:"重置"})})]})]}),e.jsxs(G,{className:"flex flex-col flex-auto min-h-0 mt-3",children:[e.jsxs("div",{className:"flex",children:[e.jsx(E,{inline:!0,className:"mr-2",children:e.jsx(m,{onClick:f,icon:"search",text:"新增用户"})}),e.jsx(E,{inline:!0,className:"mr-2",children:e.jsx(m,{icon:"search",text:"批量删除",disabled:x.length===0})})]}),e.jsx("div",{className:"flex-auto min-h-0",children:e.jsx(q,{children:e.jsxs(X,{ref:i,className:"overflow-x-hidden",numRows:r.length,rowHeights:H(()=>40,r.length),loadingOptions:a,rowHeaderCellRenderer:s,onSelection:n=>h(n,"id"),selectionModes:Z.ROWS_ONLY,columnWidths:[350,50,100,100],numFrozenColumns:1,cellRendererDependencies:[r],children:[e.jsx(w,{id:"user-operation",name:"操作",cellRenderer:d}),e.jsx(w,{id:"user-id",name:"ID",cellRenderer:u}),e.jsx(w,{id:"user-nick",name:"昵称",cellRenderer:j}),e.jsx(w,{id:"user-tel",name:"电话",cellRenderer:v})]})})}),e.jsx("div",{className:"flex justify-center mt-4",children:e.jsx(ne,{...p,pagerCount:7,pageSizeArr:[5,10,15,20,50,100,500],onChange:t})})]}),e.jsx(ee,{})]})};export{oe as default};
