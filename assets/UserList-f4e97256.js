import{r as S,aA as U,aB as L,aC as B,j as e,B as o,J as D,aD as k,aE as j,aF as g,aG as M,aH as F,F as w,az as W,aI as O,G as _}from"./index-13be1862.js";import{a as y,T as $,S as I,C as A,b as E}from"./table2-3e0f8043.js";import V from"./UserDrawer-e503a2e5.js";import{C as P,H as J}from"./htmlSelect-a7d7d674.js";import{u as K}from"./useRouteHandle-acf7793a.js";import{C as T}from"./card-ca3030b1.js";function Y(r,i){const[h,s]=S.useState({pageSize:5,currentPage:1,total:0}),[c,b]=S.useState([...U(()=>({}),13)]),[f,d]=S.useState([]),[l,C]=S.useState([y.CELLS,y.COLUMN_HEADERS,y.ROW_HEADERS]),m=S.useRef(null),R=async a=>{C([y.CELLS,y.COLUMN_HEADERS,y.ROW_HEADERS]);const u=a||(i==null?void 0:i.param)||{pageSize:h.pageSize,pageNum:h.currentPage},{data:p}=await r(u);p.data&&(b([...p.data]),s({pageSize:p.pageSize||u.pageSize,currentPage:p.pageNum||u.pageNum,total:p.total||p.data.length}),C([]))};S.useEffect(()=>{R()},[]);const t=(a,u)=>{const p=a.map(N=>{if(N.rows!=null)return L(N.rows[0],N.rows[1],1)}).flat().map(N=>c[N][u]);d(p)};return S.useEffect(()=>{const a=new ResizeObserver(()=>{if(!m.current)return;const u=m.current;if(!u.locator)return;const p=u.locator.getViewportRect();i!=null&&i.widthArr&&u.setState({...u.state,viewportRect:p}),u.componentDidMount()});return a.observe(document.body),()=>{a.disconnect()}},[c]),{tableData:c,tableRef:m,updateTable:R,loading:l,pager:h,onSelection:t,multiSelectedArr:f}}const q=r=>{const{onChange:i,pageSizeArr:h=[5,10,15,20,50,100],currentPage:s=1,pageSize:c=5,total:b=0,pagerCount:f=7}=r,d=Math.ceil(b/c),l=B(d,f,s),C=t=>{i(1,parseInt(t.target.value))},m=t=>{t===s||t===0||t===d+1||i(t,c)},R=t=>{if(t.key==="Enter"){const a=parseInt(t.target.value);if(a<0||a>d||a===s)return;i(a,c)}};return e.jsxs("div",{className:"flex items-center",children:[`共${b}条`,e.jsx(P,{className:"ml-4",children:e.jsx(J,{options:h.map(t=>({labal:t,value:`${t}条/页`})),fill:!0,onChange:C})}),e.jsxs(P,{className:"ml-4",children:[e.jsx(o,{icon:"caret-left",onClick:()=>m(s-1)}),l[0]&&l[0].map((t,a)=>e.jsx(o,{onClick:()=>m(t),intent:s===t?"primary":"none",children:t},a)),l[1]&&l[1].length>0&&e.jsx(o,{className:"before:absolute before:bottom-0.5 text-2xl before:content-['···'] hover:before:content-['«']",onClick:()=>m(s-f)}),l[2]&&l[2].map((t,a)=>e.jsx(o,{onClick:()=>m(t),intent:s===t?"primary":"none",children:t},a)),l[3]&&l[3].length>0&&e.jsx(o,{className:"before:absolute before:bottom-0.5 text-2xl before:content-['···'] hover:before:content-['»']",onClick:()=>m(s+f)}),l[4]&&l[4].map((t,a)=>e.jsx(o,{onClick:()=>m(t),intent:s===t?"primary":"none",children:t},a)),e.jsx(o,{icon:"caret-right",onClick:()=>m(s+1)})]}),e.jsxs("div",{className:"flex items-center ml-4",children:[e.jsx("span",{children:"前往"}),e.jsx(D,{defaultValue:"1",className:"w-16 mx-2",inputClassName:"text-center",onKeyUp:R}),e.jsx("span",{children:"页"})]})]})},v=r=>{const{handler:i,param:h,message:s,icon:c,intent:b}=r;return k.clear(),j.emit(g.OpenGlobalAlert,{message:s,icon:c,intent:b}),new Promise((f,d)=>{const l=async()=>{const{code:C}=await i(h);C===M.SUCCESS?(k.show({message:"成功",icon:"tick",intent:"success",timeout:1e3}),f(!0)):(d(!1),k.show({message:"失败",icon:"cross",intent:"danger"})),j.off(g.GlobalAlertConfirm,l),j.emit(g.CloseGlobalAlert)};j.on(g.GlobalAlertConfirm,l),j.on(g.GlobalAlertCancel,()=>{j.off(g.GlobalAlertConfirm,l)})})},Q=()=>{const{name:r}=K(),i=F().buttonPermission[r]||[];return{BUTTONS:(()=>{const s={};return i.forEach(c=>{s[c]=!0}),s})()}},ae=()=>{const{tableData:r,tableRef:i,updateTable:h,loading:s,pager:c,onSelection:b,multiSelectedArr:f}=Y(O.getUserList,{}),{BUTTONS:d}=Q(),l=(()=>Object.keys(d).reduce((n,x)=>n+x.length*14+43,100))(),C=()=>{j.emit(g.OpenUserDrawer,{state:"add"})},m=n=>{j.emit(g.OpenUserDrawer,{user:n,state:"edit"})},R=n=>{j.emit(g.OpenUserDrawer,{user:n,state:"edit"})},t=async n=>{await v({handler:O.deleteUser,param:{id:n.id},message:`确认重置${n.nick}的密码吗？`,intent:"warning"})},a=async n=>{await v({handler:O.deleteUser,param:{id:n.id},message:`确认删除${n.nick}吗？`,icon:"trash",intent:"danger"})},u=(n,x)=>{h({pageNum:n,pageSize:x})},p=n=>e.jsx(E,{className:"flex items-center justify-center",children:n+1}),N=n=>e.jsx(E,{className:"flex items-center justify-center",children:e.jsxs(_,{minimal:!0,children:[e.jsx(o,{onClick:()=>m(r[n]),intent:"primary",icon:"eye-open",children:"查看"}),d.edit&&e.jsx(o,{onClick:()=>R(r[n]),intent:"primary",icon:"edit",children:"编辑"}),d.edit&&e.jsx(o,{onClick:()=>t(r[n]),intent:"success",icon:"refresh",children:"重置密码"}),d.delete&&e.jsx(o,{onClick:()=>a(r[n]),intent:"danger",icon:"delete",children:"删除"})]})}),z=n=>{var x;return e.jsx(E,{className:"flex items-center justify-center",children:(x=r[n])==null?void 0:x.id})},G=n=>{var x;return e.jsx(E,{className:"flex items-center justify-center",children:(x=r[n])==null?void 0:x.nick})},H=n=>{var x;return e.jsx(E,{className:"flex items-center justify-center",children:(x=r[n])==null?void 0:x.tel})};return e.jsxs("div",{className:"flex h-full flex-col",children:[e.jsxs(T,{className:"flex justify-between pb-0",children:[e.jsxs("div",{className:"flex",children:[e.jsx(w,{inline:!0,label:"姓名",labelFor:"search-input",className:"mr-2",children:e.jsx(D,{id:"search-input",placeholder:"请输入姓名",intent:"none"})}),e.jsx(w,{inline:!0,label:"电话",labelFor:"text-input",className:"mr-2",children:e.jsx(D,{id:"text-input",placeholder:"请输入电话",intent:"none"})})]}),e.jsxs("div",{className:"flex",children:[e.jsx(w,{inline:!0,className:"mr-2",children:e.jsx(o,{icon:"search",text:"搜索"})}),e.jsx(w,{inline:!0,children:e.jsx(o,{icon:"reset",text:"重置"})})]})]}),e.jsxs(T,{className:"mt-3 flex min-h-0 flex-auto flex-col",children:[e.jsx("div",{className:"flex",children:d.delete&&e.jsxs(e.Fragment,{children:[e.jsx(w,{inline:!0,className:"mr-2",children:e.jsx(o,{onClick:C,icon:"search",text:"新增用户"})}),e.jsx(w,{inline:!0,className:"mr-2",children:e.jsx(o,{icon:"search",text:"批量删除",disabled:f.length===0})})]})}),e.jsx("div",{className:"min-h-0 flex-auto",children:e.jsx(W,{children:e.jsxs($,{ref:i,className:"overflow-x-hidden",numRows:r.length,rowHeights:U(()=>40,r.length),loadingOptions:s,rowHeaderCellRenderer:p,onSelection:n=>b(n,"id"),selectionModes:I.ROWS_ONLY,columnWidths:[l,50,100,100],numFrozenColumns:1,cellRendererDependencies:[r],children:[e.jsx(A,{id:"user-operation",name:"操作",cellRenderer:N}),e.jsx(A,{id:"user-id",name:"ID",cellRenderer:z}),e.jsx(A,{id:"user-nick",name:"昵称",cellRenderer:G}),e.jsx(A,{id:"user-tel",name:"电话",cellRenderer:H})]})})}),e.jsx("div",{className:"mt-4 flex justify-center",children:e.jsx(q,{...c,pagerCount:7,pageSizeArr:[5,10,15,20,50,100,500],onChange:u})})]}),e.jsx(V,{})]})};export{ae as default};
