import{r as S,aL as T,aM as G,aN as M,j as e,B as i,W as D,aO as A,e as j,E as g,aP as F,F as w,aH as W,aQ as O,T as B}from"./index-2924ae0c.js";import{a as y,T as _,S as $,C as k,b as E}from"./table2-e6388a48.js";import V from"./UserDrawer-d3571c8d.js";import{C as v}from"./controlGroup-81b3d936.js";import{H as I}from"./htmlSelect-08bc2ef3.js";import{u as K}from"./useButtonPermission-c7ff1d7e.js";import{C as P}from"./card-61bac0bd.js";import"./useRouteHandle-3d252655.js";function Q(r,o){const[h,l]=S.useState({pageSize:5,currentPage:1,total:0}),[x,b]=S.useState([...T(()=>({}),13)]),[f,c]=S.useState([]),[a,C]=S.useState([y.CELLS,y.COLUMN_HEADERS,y.ROW_HEADERS]),d=S.useRef(null),R=async s=>{C([y.CELLS,y.COLUMN_HEADERS,y.ROW_HEADERS]);const m=s||(o==null?void 0:o.param)||{pageSize:h.pageSize,pageNum:h.currentPage},{data:u}=await r(m);u.data&&(b([...u.data]),l({pageSize:u.pageSize||m.pageSize,currentPage:u.pageNum||m.pageNum,total:u.total||u.data.length}),C([]))};S.useEffect(()=>{R()},[]);const t=(s,m)=>{const u=s.map(N=>{if(N.rows!=null)return G(N.rows[0],N.rows[1],1)}).flat().map(N=>x[N][m]);c(u)};return S.useEffect(()=>{const s=new ResizeObserver(()=>{if(!d.current)return;const m=d.current;if(!m.locator)return;const u=m.locator.getViewportRect();o!=null&&o.widthArr&&m.setState({...m.state,viewportRect:u}),m.componentDidMount()});return s.observe(document.body),()=>{s.disconnect()}},[x]),{tableData:x,tableRef:d,updateTable:R,loading:a,pager:h,onSelection:t,multiSelectedArr:f}}const Y=r=>{const{onChange:o,pageSizeArr:h=[5,10,15,20,50,100],currentPage:l=1,pageSize:x=5,total:b=0,pagerCount:f=7}=r,c=Math.ceil(b/x),a=M(c,f,l),C=t=>{o(1,parseInt(t.target.value))},d=t=>{t===l||t===0||t===c+1||o(t,x)},R=t=>{if(t.key==="Enter"){const s=parseInt(t.target.value);if(s<0||s>c||s===l)return;o(s,x)}};return e.jsxs("div",{className:"flex items-center",children:[`共${b}条`,e.jsx(v,{className:"ml-4",children:e.jsx(I,{options:h.map(t=>({labal:t,value:`${t}条/页`})),fill:!0,onChange:C})}),e.jsxs(v,{className:"ml-4",children:[e.jsx(i,{icon:"caret-left",onClick:()=>d(l-1)}),a[0]&&a[0].map((t,s)=>e.jsx(i,{onClick:()=>d(t),intent:l===t?"primary":"none",children:t},s)),a[1]&&a[1].length>0&&e.jsx(i,{className:"before:absolute before:bottom-0.5 text-2xl before:content-['···'] hover:before:content-['«']",onClick:()=>d(l-f)}),a[2]&&a[2].map((t,s)=>e.jsx(i,{onClick:()=>d(t),intent:l===t?"primary":"none",children:t},s)),a[3]&&a[3].length>0&&e.jsx(i,{className:"before:absolute before:bottom-0.5 text-2xl before:content-['···'] hover:before:content-['»']",onClick:()=>d(l+f)}),a[4]&&a[4].map((t,s)=>e.jsx(i,{onClick:()=>d(t),intent:l===t?"primary":"none",children:t},s)),e.jsx(i,{icon:"caret-right",onClick:()=>d(l+1)})]}),e.jsxs("div",{className:"flex items-center ml-4",children:[e.jsx("span",{children:"前往"}),e.jsx(D,{defaultValue:"1",className:"w-16 mx-2",inputClassName:"text-center",onKeyUp:R}),e.jsx("span",{children:"页"})]})]})},L=r=>{const{handler:o,param:h,message:l,icon:x,intent:b}=r;return A.clear(),j.emit(g.OpenGlobalAlert,{message:l,icon:x,intent:b}),new Promise((f,c)=>{const a=async()=>{const{code:C}=await o(h);C===F.SUCCESS?(A.show({message:"成功",icon:"tick",intent:"success",timeout:1e3}),f(!0)):(c(!1),A.show({message:"失败",icon:"cross",intent:"danger"})),j.off(g.GlobalAlertConfirm,a),j.emit(g.CloseGlobalAlert)};j.on(g.GlobalAlertConfirm,a),j.on(g.GlobalAlertCancel,()=>{j.off(g.GlobalAlertConfirm,a)})})},ae=()=>{const{tableData:r,tableRef:o,updateTable:h,loading:l,pager:x,onSelection:b,multiSelectedArr:f}=Q(O.getUserList,{}),{BUTTONS:c}=K(),a=(()=>Object.keys(c).reduce((n,p)=>n+p.length*14+43,100))(),C=()=>{j.emit(g.OpenUserDrawer,{state:"add"})},d=n=>{j.emit(g.OpenUserDrawer,{user:n,state:"edit"})},R=n=>{j.emit(g.OpenUserDrawer,{user:n,state:"edit"})},t=async n=>{await L({handler:O.deleteUser,param:{id:n.id},message:`确认重置${n.nick}的密码吗？`,intent:"warning"})},s=async n=>{await L({handler:O.deleteUser,param:{id:n.id},message:`确认删除${n.nick}吗？`,icon:"trash",intent:"danger"})},m=(n,p)=>{h({pageNum:n,pageSize:p})},u=n=>e.jsx(E,{className:"flex items-center justify-center",children:n+1}),N=n=>e.jsx(E,{className:"flex items-center justify-center",children:e.jsxs(B,{minimal:!0,children:[e.jsx(i,{onClick:()=>d(r[n]),intent:"primary",icon:"eye-open",children:"查看"}),c.edit&&e.jsx(i,{onClick:()=>R(r[n]),intent:"primary",icon:"edit",children:"编辑"}),c.edit&&e.jsx(i,{onClick:()=>t(r[n]),intent:"success",icon:"refresh",children:"重置密码"}),c.delete&&e.jsx(i,{onClick:()=>s(r[n]),intent:"danger",icon:"delete",children:"删除"})]})}),U=n=>{var p;return e.jsx(E,{className:"flex items-center justify-center",children:(p=r[n])==null?void 0:p.id})},z=n=>{var p;return e.jsx(E,{className:"flex items-center justify-center",children:(p=r[n])==null?void 0:p.nick})},H=n=>{var p;return e.jsx(E,{className:"flex items-center justify-center",children:(p=r[n])==null?void 0:p.tel})};return e.jsxs("div",{className:"flex h-full flex-col",children:[e.jsxs(P,{className:"flex justify-between pb-0",children:[e.jsxs("div",{className:"flex",children:[e.jsx(w,{inline:!0,label:"姓名",labelFor:"search-input",className:"mr-2",children:e.jsx(D,{id:"search-input",placeholder:"请输入姓名",intent:"none"})}),e.jsx(w,{inline:!0,label:"电话",labelFor:"text-input",className:"mr-2",children:e.jsx(D,{id:"text-input",placeholder:"请输入电话",intent:"none"})})]}),e.jsxs("div",{className:"flex",children:[e.jsx(w,{inline:!0,className:"mr-2",children:e.jsx(i,{icon:"search",text:"搜索"})}),e.jsx(w,{inline:!0,children:e.jsx(i,{icon:"reset",text:"重置"})})]})]}),e.jsxs(P,{className:"mt-3 flex min-h-0 flex-auto flex-col",children:[e.jsx("div",{className:"flex",children:c.delete&&e.jsxs(e.Fragment,{children:[e.jsx(w,{inline:!0,className:"mr-2",children:e.jsx(i,{onClick:C,icon:"search",text:"新增用户"})}),e.jsx(w,{inline:!0,className:"mr-2",children:e.jsx(i,{icon:"search",text:"批量删除",disabled:f.length===0})})]})}),e.jsx("div",{className:"min-h-0 flex-auto",children:e.jsx(W,{children:e.jsxs(_,{ref:o,className:"overflow-x-hidden",numRows:r.length,rowHeights:T(()=>40,r.length),loadingOptions:l,rowHeaderCellRenderer:u,onSelection:n=>b(n,"id"),selectionModes:$.ROWS_ONLY,columnWidths:[a,50,100,100],numFrozenColumns:1,cellRendererDependencies:[r],children:[e.jsx(k,{id:"user-operation",name:"操作",cellRenderer:N}),e.jsx(k,{id:"user-id",name:"ID",cellRenderer:U}),e.jsx(k,{id:"user-nick",name:"昵称",cellRenderer:z}),e.jsx(k,{id:"user-tel",name:"电话",cellRenderer:H})]})})}),e.jsx("div",{className:"mt-4 flex justify-center",children:e.jsx(Y,{...x,pagerCount:7,pageSizeArr:[5,10,15,20,50,100,500],onChange:m})})]}),e.jsx(V,{})]})};export{ae as default};
