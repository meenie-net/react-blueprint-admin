import{_ as St,f as Rt,P as At,H as Pt,J as wt,K as Nt,L as Ot,r as E,M as Tt,w as yt,N as jt,g as fe,b as P,R as Bt,j as i,O as Ct,B as Be,Q as U}from"./index96641.js";import{u as Dt,a as Ft,E as re}from"./EnhancedFileInput96641.js";import{C as Ut}from"./card96641.js";var _t=function(e){St(t,e);function t(){return e!==null&&e.apply(this,arguments)||this}return t.prototype.render=function(){var n,r=this.props,s=r.animate,a=s===void 0?!0:s,o=r.className,l=r.intent,c=r.stripes,h=c===void 0?!0:c,u=r.value,f=Rt(At,Pt(l),(n={},n[wt]=!a,n[Nt]=!h,n),o),d=u==null?void 0:100*Ot(u,0,1),m=d==null?void 0:d+"%";return E.createElement("div",{"aria-valuemax":100,"aria-valuemin":0,"aria-valuenow":d==null?void 0:Math.round(d),className:f,role:"progressbar"},E.createElement("div",{className:Tt,style:{width:m}}))},t.displayName="".concat(yt,".ProgressBar"),t}(jt),Lt=function(e,t,n,r,s,a,o,l){if(!e){var c;if(t===void 0)c=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var h=[n,r,s,a,o,l],u=0;c=new Error(t.replace(/%s/g,function(){return h[u++]})),c.name="Invariant Violation"}throw c.framesToPop=1,c}},Mt=Lt;const w=fe(Mt);var Ht=Gt;function Gt(e,t,n){var r=null,s=null,a=n&&n.leading,o=n&&n.trailing;a==null&&(a=!0),o==null&&(o=!a),a==!0&&(o=!1);var l=function(){r&&(clearTimeout(r),r=null)},c=function(){var u=s;l(),u&&u()},h=function(){var u=a&&!r,f=this,d=arguments;if(s=function(){return e.apply(f,d)},r||(r=setTimeout(function(){if(r=null,o)return s()},t)),u)return u=!1,s()};return h.cancel=l,h.flush=c,h}const Ce="__rpldy-logger-debug__",I={PENDING:"pending",ADDED:"added",PROCESSING:"processing",UPLOADING:"uploading",CANCELLED:"cancelled",FINISHED:"finished",ABORTED:"aborted",ERROR:"error"},b={PENDING:"pending",ADDED:"added",UPLOADING:"uploading",CANCELLED:"cancelled",FINISHED:"finished",ERROR:"error",ABORTED:"aborted"},O=()=>typeof window=="object"&&!!window.document;let Q=null;const De=()=>(typeof Q!="boolean"&&(Q=O()&&("location"in window&&!!~window.location.search.indexOf("rpldy_debug=true")||window[Ce]===!0)),!!Q),$t=e=>{O()&&(window[Ce]=e),Q=e?!0:null},v=function(){De()&&console.log(...arguments)},Vt=function(e,t){const n=function(o){for(var l=arguments.length,c=new Array(l>1?l-1:0),h=1;h<l;h++)c[h-1]=arguments[h];return new Promise((u,f)=>{const d=e(o,...c);d&&d.length?Promise.all(d).catch(f).then(m=>m&&u(!!~m.findIndex(p=>p===!1))):u(!1)})};for(var r=arguments.length,s=new Array(r>2?r-2:0),a=2;a<r;a++)s[a-2]=arguments[a];return t?n(t,...s):n};function Qt(e){return typeof e=="function"}var zt=Qt;const B=fe(zt),Wt=e=>{const t=[].concat(e);return n=>n.map(r=>t.map(s=>r[s]).join())},Xt=(e,t,n)=>{let r=!0;const s=Wt(n);if(e&&t&&e.length===t.length){const a=s(e),o=s(t);r=!!a.find((l,c)=>l!==o[c])}return!r};function Yt(){return!0}var Zt=Yt;const j=fe(Zt),_=e=>j()?e:Object.freeze(e),me=e=>{var t;return!!e&&typeof e=="object"&&(((t=Object.getPrototypeOf(e))===null||t===void 0?void 0:t.constructor.name)==="Object"||Object.getPrototypeOf(e)===null)},Fe=e=>me(e)||Array.isArray(e),Jt=(e,t)=>{const n=Object.keys(e);return t.withSymbols?n.concat(Object.getOwnPropertySymbols(e)):n},pe=function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=function(n){for(var r=arguments.length,s=new Array(r>1?r-1:0),a=1;a<r;a++)s[a-1]=arguments[a];return n&&s.length&&s.forEach(o=>{o&&Jt(o,e).forEach(l=>{const c=o[l];(!e.predicate||e.predicate(l,c))&&(typeof c<"u"||e.undefinedOverwrites)&&(Fe(c)?((typeof n[l]>"u"||!me(n[l]))&&(n[l]=Array.isArray(c)?[]:{}),t(n[l],c)):n[l]=c)})}),n};return t},L=pe(),Ue=function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:L;return Fe(e)?t(Array.isArray(e)?[]:{},e):e},Kt=(e,t)=>e&&Object.keys(e).reduce((n,r)=>(~t.indexOf(r)&&(n[r]=e[r]),n),{});function ge(e){return!!e&&typeof e=="object"&&typeof e.then=="function"}const ve=O()&&window.requestIdleCallback,kt=ve?window.requestIdleCallback:setTimeout,qt=ve?window.cancelIdleCallback:clearTimeout,_e=function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;const n=kt(e,ve?{timeout:t}:t);return()=>qt(n)};function xe(e){return e==null}const en=function(e,t){const n=function(o){for(var l=arguments.length,c=new Array(l>1?l-1:0),h=1;h<l;h++)c[h-1]=arguments[h];return new Promise((u,f)=>{const d=e(o,...c);d&&d.length?Promise.all(d).catch(f).then(m=>{let p;if(m)for(;xe(p)&&m.length;)p=m.pop();u(xe(p)?void 0:p)}):u()})};for(var r=arguments.length,s=new Array(r>2?r-2:0),a=2;a<r;a++)s[a-2]=arguments[a];return t?n(t,...s):n},Le=Symbol.for("__rpldy-bi__");let Ie=0;const tn=(e,t)=>(e.url=t,e),nn=(e,t)=>(e.file=t,e),rn=e=>e&&(e instanceof File||e instanceof Blob||!!(typeof e=="object"&&e.name&&e.type)),Me=e=>!!(typeof e=="object"&&e.id&&e.batchId&&e[Le]===!0),sn=function(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;const r=Me(e);Ie+=r?0:1;const s=r&&e.id&&typeof e.id=="string"?e.id:`${t}.item-${Ie}`,a=n?b.PENDING:b.ADDED;let o={id:s,batchId:t,state:a,uploadStatus:0,total:0,completed:0,loaded:0,recycled:r,previousBatch:r?e.batchId:null};Object.defineProperty(o,Le,{value:!0,writable:!0});const l=r?e.file||e.url:e;if(typeof l=="string")o=tn(o,l);else if(rn(l))o=nn(o,l);else throw new Error(`Unknown type of file added: ${typeof l}`);return o};function an(e,t,n){return t=on(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function on(e){var t=ln(e,"string");return typeof t=="symbol"?t:String(t)}function ln(e,t){if(typeof e!="object"||e===null)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var r=n.call(e,t||"default");if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}class cn extends Promise{constructor(t,n){super(t),an(this,"xhr",void 0),this.xhr=n}}const dn=(e,t)=>{t&&Object.keys(t).forEach(n=>{t[n]!==void 0&&e.setRequestHeader(n,t[n])})},un=function(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};const r=new XMLHttpRequest;return new cn((s,a)=>{var o;r.onerror=()=>a(r),r.ontimeout=()=>a(r),r.onabort=()=>a(r),r.onload=()=>s(r),r.open((n==null?void 0:n.method)||"GET",e),dn(r,n==null?void 0:n.headers),r.withCredentials=!!(n!=null&&n.withCredentials),n==null||(o=n.preSend)===null||o===void 0||o.call(n,r),r.send(t)},r)},hn=e=>{let t;try{t=e.getAllResponseHeaders().trim().split(/[\r\n]+/).reduce((n,r)=>{const[s,a]=r.split(": ");return n[s]=a,n},{})}catch{v("uploady.request: failed to read response headers",e)}return t},fn=_({allowRegisterNonExistent:!0,canAddEvents:!0,canRemoveEvents:!0,collectStats:!1}),mn=(e,t)=>{if(!B(e))throw new Error(`'${t}' is not a valid function`)},pn=e=>typeof e>"u",He=Symbol.for("__le__"),Ge=Symbol.for("__le__pack__"),$e=e=>e?e[He]:null,T=e=>{const t=$e(e);if(!t)throw new Error("Didnt find LE internal object. Something very bad happened!");return t},gn=e=>!!$e(e),Ve=function(e,t,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;mn(n,"cb");const s=T(e);if(!s.options.allowRegisterNonExistent&&!~s.events.indexOf(t))throw new Error(`Cannot register for event ${t.toString()} that wasn't already defined (allowRegisterNonExistent = false)`);const a=s.registry[t]||[];return a.find(o=>o.cb===n)||(a.push({name:t,cb:n,once:r}),s.registry[t]=a),()=>Xe.call(e,t,n)},Qe=(e,t)=>{const n=T(e).registry;return t?n[t]?n[t].slice():[]:Object.values(n).flat()},vn={on:En,once:xn,off:Xe,getEvents:In},bn=()=>Object.entries(vn).reduce((e,t)=>{let[n,r]=t;return e[n]={value:r},e},{}),se={trigger:Sn,addEvent:An,removeEvent:Pn,hasEvent:wn,hasEventRegistrations:Nn,assign:Rn},ze=e=>Object.keys(se).reduce((t,n)=>(t[n]=se[n].bind(e),t),{target:e,...se}),Se=function(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;const r=T(e).registry;r[t]&&(n||!r[t].length)&&delete r[t]},We=(e,t,n)=>{const r=T(e).registry;r[t]&&(n?(r[t]=r[t].filter(s=>s.cb!==n),Se(e,t)):Se(e,t,!0))};function En(e,t){return Ve(this,e,t)}function xn(e,t){return Ve(this,e,t,!0)}function Xe(e,t){We(this,e,t)}function In(){return T(this).events.slice()}function Sn(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];const s=Qe(this,e);let a;if(s.length){var o;let l;n.length===1&&((o=n[0])===null||o===void 0?void 0:o[Ge])===!0&&(l=n[0].resolve()),a=s.map(c=>{let h;return c.once&&We(this,e,c.cb),l?h=c.cb(...l):n.length?n.length===1?h=c.cb(n[0]):n.length===2?h=c.cb(n[0],n[1]):n.length===3?h=c.cb(n[0],n[1],n[2]):h=c.cb(...n):h=c.cb(),h}).filter(c=>!pn(c)).map(c=>ge(c)?c:Promise.resolve(c))}return a&&(a.length?a:void 0)}function Rn(e){const t=T(this);return Ye(e,t.options,t.events,t.registry,t.stats),ze(e)}function An(e){const t=T(this);if(t.options.canAddEvents)if(!~t.events.indexOf(e))t.events.push(e);else throw new Error(`Event '${e}' already defined`);else throw new Error("Cannot add new events (canAddEvents = false)")}function Pn(e){const t=T(this);if(t.options.canRemoveEvents){const n=t.events.indexOf(e);t.events.splice(n,1)}else throw new Error("Cannot remove events (canRemoveEvents = false)")}function wn(e){return!!~T(this).events.indexOf(e)}function Nn(e){return!!Qe(this,e).length}const Ye=function(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{},s=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{};Object.defineProperties(e,{[He]:{value:Object.seal({registry:r,events:n,options:t,stats:s})},...bn()})},Ze=function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0;const r=e||{},s={...fn,...n};return gn(r)||Ye(r,s,t),ze(r)},On=e=>{const t={resolve:()=>[].concat(e())};return Object.defineProperty(t,Ge,{value:!0,configurable:!1}),t},Tn=(e,t)=>{e.items.forEach(n=>{var r;let{id:s}=n;return(r=t[s])===null||r===void 0?void 0:r.call(t)})},yn=e=>{Object.values(e).forEach(t=>t())},Re=(e,t,n)=>(v(`abort: aborting ${e.state} item  - `,e),n(e.id,{status:0,state:b.ABORTED,response:"aborted"}),!0),jn={[b.UPLOADING]:(e,t)=>(v("abort: aborting uploading item  - ",e),t[e.id]()),[b.ADDED]:Re,[b.PENDING]:Re},Je=(e,t,n)=>{const r=e==null?void 0:e.state,s=!!r&&jn[r];return s?s(e,t,n):!1},Ke=(e,t,n,r)=>Je(t[e],n,r),ke=(e,t)=>{let n=!1;return t!==0&&t&&(n=e>=t),n},Bn=(e,t,n,r,s)=>{const a=Object.values(n).flat(),o=ke(a.length,s.fastAbortThreshold);return v(`abort: doing abort-all (${o?"fast":"normal"} abort)`),o?yn(t):a.forEach(l=>Ke(l,e,t,r)),{isFast:o}},Cn=(e,t,n,r,s,a)=>{const o=t.fastAbortThreshold===0?0:t.fastAbortThreshold||a.fastAbortThreshold,l=ke(r[e.id].length,o);return v(`abort: doing abort-batch on: ${e.id} (${l?"fast":"normal"} abort)`),l?Tn(e,n):e.items.forEach(c=>Je(c,n,s)),{isFast:l}},qe=()=>e=>(e.update({abortAll:Bn,abortBatch:Cn,abortItem:Ke}),e),g=_({BATCH_ADD:"BATCH-ADD",BATCH_START:"BATCH-START",BATCH_PROGRESS:"BATCH_PROGRESS",BATCH_FINISH:"BATCH-FINISH",BATCH_ABORT:"BATCH-ABORT",BATCH_CANCEL:"BATCH-CANCEL",BATCH_ERROR:"BATCH-ERROR",BATCH_FINALIZE:"BATCH-FINALIZE",ITEM_START:"FILE-START",ITEM_CANCEL:"FILE-CANCEL",ITEM_PROGRESS:"FILE-PROGRESS",ITEM_FINISH:"FILE-FINISH",ITEM_ABORT:"FILE-ABORT",ITEM_ERROR:"FILE-ERROR",ITEM_FINALIZE:"FILE-FINALIZE",REQUEST_PRE_SEND:"REQUEST_PRE_SEND",ALL_ABORT:"ALL_ABORT"}),Dn=50,M=_({ITEM_PROGRESS:"ITEM_PROGRESS",BATCH_PROGRESS:"BATCH_PROGRESS"}),et=[b.FINISHED,b.ERROR,b.CANCELLED,b.ABORTED],X=Symbol.for("__rpldy-sstt-proxy__"),Y=Symbol.for("__rpldy-sstt-state__"),H=e=>!j()&&!!e&&!!~Object.getOwnPropertySymbols(e).indexOf(X),Fn=e=>O()&&e instanceof File||e.name&&e.size&&e.uri,tt=e=>Array.isArray(e)||me(e)&&!Fn(e),Un=pe({withSymbols:!0,predicate:e=>e!==X&&e!==Y}),ae=e=>j()?!0:e[Y].isUpdateable,Ae=(e,t)=>{j()||(e[Y].isUpdateable=t)},ie=(e,t)=>{let n;return tt(e)&&(H(e)||(e[X]=!0,n=new Proxy(e,t)),Object.keys(e).forEach(r=>{e[r]=ie(e[r],t)})),n||e},C=e=>H(e)?Ue(e,Un):e,_n=e=>{const t={set:(r,s,a)=>(ae(n)&&(r[s]=ie(a,t)),!0),get:(r,s)=>s===X?C(r):r[s],defineProperty:()=>{throw new Error("Simple State doesnt support defining property")},setPrototypeOf:()=>{throw new Error("Simple State doesnt support setting prototype")},deleteProperty:(r,s)=>(ae(n)&&delete r[s],!0)};!j()&&!H(e)&&Object.defineProperty(e,Y,{value:{isUpdateable:!1},configurable:!0});const n=j()?e:ie(e,t);return{state:n,update:r=>{if(!j()&&ae(n))throw new Error("Can't call update on State already being updated!");try{Ae(n,!0),r(n)}finally{Ae(n,!1)}return n},unwrap:r=>r?C(r):H(n)?C(n):n}},nt=function(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;e.updateState(r=>{const{batchId:s}=r.items[t]||{batchId:null};n&&delete r.items[t];const a=s?r.itemQueue[s].indexOf(t):-1;~a&&s&&r.itemQueue[s].splice(a,1);const o=r.activeIds.indexOf(t);~o&&r.activeIds.splice(o,1)})},rt=(e,t)=>!!e.getState().items[t],Z=e=>et.includes(e.state),Ln=pe({undefinedOverwrites:!0}),Mn=(e,t,n,r)=>{let s=n,a=t;if(r){if(v(`uploader.queue: REQUEST_PRE_SEND(${e}) event returned updated items/options`,r),r.items){if(r.items.length!==t.length||!Xt(r.items,t,["id","batchId","recycled"]))throw new Error(`REQUEST_PRE_SEND(${e}) event handlers must return same items with same ids`);a=r.items}r.options&&(s=Ln({},n,r.options))}return{items:a,options:s,cancelled:r===!1}},Hn=(e,t,n,r,s,a)=>en(e.trigger,s,t,r).then(o=>(a==null||a(o),Mn(s,n,r,o))),Gn=(e,t)=>{if(t.items[0]&&e.getState().batches[t.items[0].batchId]){e.updateState(r=>{t.items.forEach(s=>{Z(r.items[s.id])||(r.items[s.id]=s)}),r.batches[t.items[0].batchId].batchOptions=t.options});const n=e.getState();t.items=t.items.map(r=>n.items[r.id]),t.options=n.batches[t.items[0].batchId].batchOptions}},$n=(e,t,n,r,s,a)=>{const o=n(t),l=e.getState().batches[o[0].batchId].batchOptions,c=(r==null?void 0:r(t,l))||t;return Hn(e,c,o,l,a,s).then(h=>(h.cancelled||Gn(e,h),h))},st=function(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;return(s,a)=>$n(s,a,t,n,r,e)},Vn=st(g.BATCH_START,e=>e.items,null,function(){let{batch:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{batch:!1};if(e)throw new Error("BATCH_START event handlers cannot update batch data. Only items & options")}),Qn=[I.ADDED,I.PROCESSING,I.UPLOADING],zn=[I.ABORTED,I.CANCELLED,I.FINISHED,I.ERROR],F=(e,t)=>e.batches[t].batch,Wn=(e,t)=>F(e.getState(),t),J=(e,t)=>{const n=e.getState(),r=n.items[t];return n.batches[r.batchId]},V=(e,t)=>J(e,t).batch,K=(e,t)=>{Wn(e,t).items.forEach(r=>{let{id:s}=r;return nt(e,s,!0)})},k=(e,t)=>{e.updateState(n=>{delete n.batches[t],delete n.itemQueue[t];const r=n.batchQueue.indexOf(t);~r&&n.batchQueue.splice(r,1);const s=n.batchesStartPending.indexOf(t);~s&&n.batchesStartPending.splice(s,1)})},q=function(e,t,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:I.FINISHED,s=arguments.length>4?arguments[4]:void 0;e.updateState(a=>{const o=F(a,t);o.state=r,s&&(o.additionalInfo=s)}),z(e,t,n),z(e,t,g.BATCH_FINALIZE)},at=(e,t)=>{v("uploady.uploader.batchHelpers: cancelling batch: ",t),q(e,t,g.BATCH_CANCEL,I.CANCELLED),K(e,t),k(e,t)},Xn=(e,t)=>{if(rt(e,t)){const n=J(e,t),r=n==null?void 0:n.batch.id;r?at(e,r):v(`uploady.uploader.batchHelpers: cancel batch called for batch already removed (item id = ${t})`)}},Yn=(e,t,n)=>{const r=V(e,t),s=r.id;v("uploady.uploader.batchHelpers: failing batch: ",{batch:r}),q(e,s,g.BATCH_ERROR,I.ERROR,n.message),K(e,s),k(e,s)},Zn=(e,t)=>{const n=V(e,t);return e.getState().batchesStartPending.includes(n.id)},Jn=(e,t)=>{const n=V(e,t);return e.getState().currentBatch!==n.id},Kn=(e,t)=>{const n=V(e,t);return e.updateState(r=>{r.batchesStartPending.push(n.id)}),Vn(e,n).then(r=>{let{cancelled:s}=r,a=!1;return e.updateState(o=>{const l=o.batchesStartPending.indexOf(n.id);o.batchesStartPending.splice(l,1)}),s||(a=!rt(e,t),a||e.updateState(o=>{o.currentBatch=n.id})),!s&&!a})},kn=e=>{_e(()=>{const t=e.getState();Object.keys(t.batches).forEach(n=>{const{batch:r,finishedCounter:s}=t.batches[n],{orgItemCount:a}=r,o=ot(r);a===s&&(!o&&r.completed!==100&&(e.updateState(l=>{const c=F(l,n);c.completed=100,c.loaded=c.items.reduce((h,u)=>{let{loaded:f}=u;return h+f},0)}),z(e,n,g.BATCH_PROGRESS)),e.updateState(l=>{l.currentBatch===n&&(l.currentBatch=null)}),v(`uploady.uploader.batchHelpers: cleaning up batch: ${r.id}`),o||q(e,n,g.BATCH_FINISH),K(e,n),k(e,n))})})},z=(e,t,n)=>{const r=e.getState(),{batch:s,batchOptions:a}=r.batches[t],o=r.items,l={...C(s),items:s.items.map(c=>{let{id:h}=c;return C(o[h])})};e.trigger(n,l,C(a))},qn=(e,t)=>{const n=F(e.getState(),t);return Qn.includes(n.state)},er=(e,t)=>{const{previousBatch:n}=t;if(t.recycled&&n&&e.getState().batches[n]){const{id:r}=V(e,t.id);r===n&&e.updateState(s=>{const a=F(s,r),o=a.items.findIndex(l=>{let{id:c}=l;return c===t.id});~o&&a.items.splice(o,1)})}},tr=(e,t)=>{e.updateState(n=>{Object.keys(n.batches).forEach(r=>{const s=n.batches[r],{batch:a,batchOptions:o}=s;a.state===I.PENDING&&(a.items.forEach(l=>{l.state=b.ADDED}),a.state=I.ADDED,s.batchOptions=L({},o,t))})})},nr=e=>{const t=e.getState().batches;Object.keys(t).filter(n=>t[n].batch.state===I.PENDING).forEach(n=>{K(e,n),k(e,n)})},rr=(e,t)=>{e.updateState(n=>{n.batches[t].finishedCounter+=1})},ot=e=>zn.includes(e.state),sr=(e,t)=>{e.updateState(n=>{const{items:r}=F(n,t);delete n.batches[t],delete n.itemQueue[t];const s=n.batchQueue.indexOf(t);~s&&n.batchQueue.splice(s,1),n.currentBatch===t&&(n.currentBatch=null),r.forEach(a=>{let{id:o}=a;delete n.items[o];const l=n.activeIds.indexOf(o);~l&&n.activeIds.splice(l,1)})})},Pe={[b.PENDING]:null,[b.ADDED]:g.ITEM_START,[b.FINISHED]:g.ITEM_FINISH,[b.ERROR]:g.ITEM_ERROR,[b.CANCELLED]:g.ITEM_CANCEL,[b.ABORTED]:g.ITEM_ABORT,[b.UPLOADING]:g.ITEM_PROGRESS},we=e=>!!~et.indexOf(e.state),ee=(e,t,n)=>{t.forEach(r=>{const s=e.getState(),{id:a,info:o}=r;if(v("uploader.processor.queue: request finished for item - ",{id:a,info:o}),s.items[a]){e.updateState(u=>{const f=u.items[a];f.state=o.state,f.uploadResponse=o.response,f.uploadStatus=o.status,we(f)&&delete u.aborts[a]});const c=e.getState().items[a];if(o.state===b.FINISHED&&c.completed<100){var l;const u=((l=c.file)===null||l===void 0?void 0:l.size)||0;e.handleItemProgress(c,100,u,u)}const{batchOptions:h}=J(e,a);Pe[c.state]&&e.trigger(Pe[c.state],c,h),we(c)&&(rr(e,c.batchId),e.trigger(g.ITEM_FINALIZE,c,h))}nt(e,a)}),kn(e),n(e)},ar=st(g.REQUEST_PRE_SEND,e=>e,(e,t)=>({items:e,options:t})),or=(e,t,n)=>{e.updateState(r=>{t.forEach(s=>{const a=r.items[s.id];a.state=b.UPLOADING,r.aborts[s.id]=n.abort})})},ir=(e,t,n)=>{var r;const{items:s,options:a}=t,o=(r=e.getState().batches[s[0].batchId])===null||r===void 0?void 0:r.batch;if(o){let l;try{l=e.sender.send(s,o,a)}catch(h){v("uploader.queue: sender failed with unexpected error",h),l={request:Promise.resolve({status:0,state:b.ERROR,response:h.message}),abort:()=>!1,senderType:"exception-handler"}}const{request:c}=l;or(e,s,l),c.then(h=>{const u=s.map(f=>({id:f.id,info:h}));ee(e,u,n)})}},lr=(e,t,n,r)=>{const s=n.map((a,o)=>a?t[o].id:null).filter(Boolean);if(s.length){const a=s.map(o=>({id:o,info:{status:0,state:b.CANCELLED,response:"cancel"}}));ee(e,a,r)}return!!s.length},cr=(e,t,n,r)=>{const s=n.map(a=>{let{id:o}=a;return{id:o,info:{status:0,state:b.ERROR,response:e}}});ee(t,s,r)},dr=(e,t)=>{const n=t.getState().items[e];return n&&!Z(n)?n:void 0},ur=e=>{let{allowedItems:t,cancelledResults:n,queue:r,items:s,ids:a,next:o}=e;const l=t.length?ar(r,t):Promise.resolve();let c=n;return l.catch(h=>{v("uploader.queue: encountered error while preparing items for request",h),cr(h,r,s,o)}).then(h=>{let u;return h&&(h.cancelled?c=a.map(()=>!0):h.items.some(d=>Z(d))?v("uploader.queue: send data contains aborted items - not sending"):ir(r,{items:h.items,options:h.options},o)),lr(r,s,c,o)||(u=o(r)),u})},hr=(e,t,n)=>{const r=e.getState();let s=Object.values(r.items);return s=s.filter(a=>t.includes(a.id)&&!Z(a)),Promise.all(s.map(a=>{const{batchOptions:o}=J(e,a.id);return e.runCancellable(g.ITEM_START,a,o)})).then(a=>({allowedItems:a.map((l,c)=>l?null:dr(s[c].id,e)).filter(Boolean),cancelledResults:a,queue:e,items:s,ids:t,next:n})).then(ur)},fr=(e,t)=>e.getState().activeIds.flat().includes(t),mr=e=>e.state===b.ADDED,pr=e=>{const t=e.getState(),n=t.itemQueue,r=t.items;let s=null,a=0,o=0,l=t.batchQueue[a];for(;l&&!s;){if(qn(e,l))for(s=n[l][o];s&&(fr(e,s)||!mr(r[s]));)o+=1,s=n[l][o];s||(a+=1,l=t.batchQueue[a],o=0)}return s?[l,o]:null},gr=e=>{const t=e.getState(),n=t.itemQueue,[r,s]=pr(e)||[];let a=r&&~s?n[r][s]:null,o;if(a){const{batchOptions:l}=t.batches[r],c=l.maxGroupSize||0;l.grouped&&c>1?o=t.itemQueue[r].slice(s,s+c):o=[a]}return o},vr=(e,t)=>{e.updateState(n=>{n.activeIds=n.activeIds.concat(t)})},br=(e,t)=>{let n;return Zn(e,t[0])?n=Promise.resolve(!0):(vr(e,t),Jn(e,t[0])?n=Kn(e,t[0]).then(r=>{let s=!r;return s&&(Xn(e,t[0]),D(e)),s}).catch(r=>(v("uploader.processor: encountered error while preparing batch for request",r),Yn(e,t[0],r),D(e),!0)):n=Promise.resolve(!1)),n},D=e=>{let t;const n=gr(e);if(n){const r=e.getCurrentActiveCount(),{concurrent:s=!1,maxConcurrent:a=0}=e.getOptions();(!r||s&&r<a)&&(v("uploader.processor: Processing next upload - ",{ids:n,currentCount:r}),t=br(e,n).then(o=>{o||(hr(e,n,D),s&&D(e))}))}return t},be=e=>(t,n)=>ee(e,[{id:t,info:n}],D),Er=(e,t)=>{const n=e.getOptions().abortItem;w(!!n,"Abort Item method not provided yet abortItem was called");const r=e.getState();return n(t,r.items,r.aborts,be(e))},xr=(e,t)=>{const n=e.getOptions().abortBatch;w(!!n,"Abort Batch method not provided yet abortItem was called");const r=e.getState(),s=r.batches[t],a=s==null?void 0:s.batch;if(a&&!ot(a)){q(e,t,g.BATCH_ABORT,I.ABORTED);const{isFast:o}=n(a,s.batchOptions,r.aborts,r.itemQueue,be(e),e.getOptions());o&&e.clearBatchUploads(a.id)}},Ir=e=>{const t=e.getOptions().abortAll;w(!!t,"Abort All method not provided yet abortAll was called"),e.trigger(g.ALL_ABORT);const n=e.getState(),{isFast:r}=t(n.items,n.aborts,n.itemQueue,be(e),e.getOptions());r&&e.clearAllUploads()},Sr=(e,t,n,r,s)=>{const{state:a,update:o}=_n({itemQueue:{},batchQueue:[],currentBatch:null,batchesStartPending:[],batches:{},items:{},activeIds:[],aborts:{}}),l=()=>a,c=d=>{o(d)},h=d=>{if(a.items[d.id]&&!d.recycled)throw new Error(`Uploader queue conflict - item ${d.id} already exists`);d.recycled&&er(f,d),c(m=>{m.items[d.id]=d})},u=(d,m,p,x)=>{a.items[d.id]&&(c(R=>{const A=R.items[d.id];A.loaded=p,A.completed=m,A.total=x}),t(g.ITEM_PROGRESS,l().items[d.id]))};r.on(M.ITEM_PROGRESS,u),r.on(M.BATCH_PROGRESS,d=>{var m;const p=(m=a.batches[d.id])===null||m===void 0?void 0:m.batch.items;if(p){const[x,R]=p.reduce((A,y)=>{let{id:xt}=y;const{loaded:Ee,file:ne}=a.items[xt],It=(ne==null?void 0:ne.size)||Ee||1;return A[0]+=Ee,A[1]+=It,A},[0,0]);c(A=>{const y=A.batches[d.id].batch;y.total=R,y.loaded=x,y.completed=x/R}),z(f,d.id,g.BATCH_PROGRESS)}});const f={uploaderId:s,getOptions:()=>e,getCurrentActiveCount:()=>a.activeIds.length,getState:l,updateState:c,trigger:t,runCancellable:function(d){if(!B(n))throw new Error("Uploader queue - cancellable is of wrong type");for(var m=arguments.length,p=new Array(m>1?m-1:0),x=1;x<m;x++)p[x-1]=arguments[x];return n(d,...p)},sender:r,handleItemProgress:u,clearAllUploads:()=>{f.updateState(d=>{d.itemQueue={},d.batchQueue=[],d.currentBatch=null,d.batches={},d.items={},d.activeIds=[]})},clearBatchUploads:d=>{_e(()=>{v(`uploader.queue: started scheduled work to clear batch uploads (${d})`),l().batches[d]&&sr(f,d)})}};return O()&&De()&&(window[`__rpldy_${s}_queue_state`]=f),{updateState:c,getState:f.getState,runCancellable:f.runCancellable,uploadBatch:(d,m)=>{m&&c(p=>{p.batches[d.id].batchOptions=m}),D(f)},addBatch:(d,m)=>(c(p=>{p.batches[d.id]={batch:d,batchOptions:m,finishedCounter:0},p.batchQueue.push(d.id),p.itemQueue[d.id]=d.items.map(x=>{let{id:R}=x;return R})}),d.items.forEach(h),F(a,d.id)),abortItem:function(){for(var d=arguments.length,m=new Array(d),p=0;p<d;p++)m[p]=arguments[p];return Er(f,...m)},abortBatch:function(){for(var d=arguments.length,m=new Array(d),p=0;p<d;p++)m[p]=arguments[p];return xr(f,...m)},abortAll:function(){for(var d=arguments.length,m=new Array(d),p=0;p<d;p++)m[p]=arguments[p];return Ir(f,...m)},clearPendingBatches:()=>{nr(f)},uploadPendingBatches:d=>{tr(f,d),D(f)},cancelBatch:d=>at(f,d.id)}},Ne="rpldy-sender";class Rr extends Error{constructor(t){super(`${t} didn't receive upload URL`),this.name="MissingUrlError"}}const le=function(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),s=2;s<n;s++)r[s-2]=arguments[s];"set"in e?e.set(t,...r):("delete"in e&&e.delete(t),e.append(t,...r))},Ar=(e,t,n)=>{const r=t.length===1;t.forEach((s,a)=>{const o=r?n.paramName:B(n.formatGroupParamName)?n.formatGroupParamName(a,n.paramName):`${n.paramName}[${a}]`;s.file?le(e,o,s.file,s.file.name):s.url&&le(e,o,s.url)})},Pr=(e,t)=>{const n=new FormData;return t.params&&Object.entries(t.params).forEach(r=>{let[s,a]=r;(t.formDataAllowUndefined||a!==void 0)&&le(n,s,a)}),Ar(n,e,t),n},wr=[200,201,202,203,204],Nr=(e,t)=>{let n;if(t.sendWithFormData)v(`uploady.sender: sending ${e.length} item(s) as form data`),n=Pr(e,t);else{if(e.length>1)throw new Error(`XHR Sender - Request without form data can only contain 1 item. received ${e.length}`);const r=e[0];v(`uploady.sender: sending item ${r.id} as request body`),n=r.file||r.url}return n},Or=(e,t,n,r,s)=>{let a;const o=s!=null&&s.getRequestData?s.getRequestData(e,n):Nr(e,n),l=function(){let h=arguments.length>0&&arguments[0]!==void 0?arguments[0]:t,u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:o,f=arguments.length>2?arguments[2]:void 0;const d=L({...Kt(n,["method","headers","withCredentials"]),preSend:p=>{p.upload.onprogress=x=>{x.lengthComputable&&r&&r(x,e.slice())}}},f),m=un(h,u,d);return a=m.xhr,m},c=s!=null&&s.preRequestHandler?s.preRequestHandler(l,e,t,n,r,s):l();return{url:t,count:e.length,pXhr:c,getXhr:()=>a,aborted:!1}},Tr=(e,t,n)=>{let r=e;const s=t==null?void 0:t["content-type"];if(n.forceJsonResponse||s!=null&&s.includes("json"))try{r=JSON.parse(e)}catch{}return r},yr=(e,t)=>{const n=t.isSuccessfulCall?t.isSuccessfulCall(e):wr.includes(e.status);return ge(n)?n:Promise.resolve(n)},jr=(e,t)=>e.pXhr.then(n=>(v("uploady.sender: received upload response ",n),yr(n,t).then(r=>{var s,a;const o=r?b.FINISHED:b.ERROR,l=n.status,c=hn(n),h={data:(s=(a=t.formatServerResponse)===null||a===void 0?void 0:a.call(t,n.response,l,c))!==null&&s!==void 0?s:Tr(n.response,c,t),headers:c};return{status:l,state:o,response:h}}))).catch(n=>{let r,s;return e.aborted?(r=b.ABORTED,s="aborted"):(v("uploady.sender: upload failed: ",n),r=b.ERROR,s=n),{error:!0,state:r,response:s,status:0}}),Br=e=>{let t=!1;const{aborted:n,getXhr:r}=e,s=r();return!n&&s&&s.readyState&&s.readyState!==4&&(v(`uploady.sender: cancelling request with ${e.count} items to: ${e.url}`),s.abort(),e.aborted=!0,t=!0),t},Cr=e=>(t,n,r,s)=>{if(!n)throw new Rr(Ne);v("uploady.sender: sending file: ",{items:t,url:n,options:r});const a=Or(t,n,r,s,e);return{request:jr(a,r),abort:()=>Br(a),senderType:Ne}},Dr=Cr(),Fr="file",it=()=>!0,lt=_({autoUpload:!0,clearPendingOnAdd:!1,inputFieldName:"file",concurrent:!1,maxConcurrent:2,grouped:!1,maxGroupSize:5,method:"POST",params:{},fileFilter:it,forceJsonResponse:!1,withCredentials:!1,destination:{},send:null,sendWithFormData:!0,formDataAllowUndefined:!1,fastAbortThreshold:100}),Ur=(e,t,n,r,s)=>{e.forEach(a=>{v(`uploady.uploader.processor: file: ${a.id} progress event: loaded(${n}) - completed(${t})`),s(M.ITEM_PROGRESS,a,t,n,r)})},_r=(e,t,n,r)=>{const s=Math.min(n.loaded/n.total*100,100),a=s/e.length,o=n.loaded/e.length;Ur(e,a,o,n.total,r),r(M.BATCH_PROGRESS,t)},Lr=()=>{const{trigger:e,target:t}=Ze({send:(n,r,s)=>{const a=s.destination,o=a==null?void 0:a.url,l=Ht(h=>_r(n,r,h,e),Dn,!0);return(B(s.send)?s.send:Dr)(n,o,{method:(a==null?void 0:a.method)||s.method||lt.method,paramName:(a==null?void 0:a.filesParamName)||s.inputFieldName||Fr,params:{...s.params,...a==null?void 0:a.params},forceJsonResponse:s.forceJsonResponse,withCredentials:s.withCredentials,formatGroupParamName:s.formatGroupParamName,headers:a==null?void 0:a.headers,sendWithFormData:s.sendWithFormData,formatServerResponse:s.formatServerResponse,formDataAllowUndefined:s.formDataAllowUndefined,isSuccessfulCall:s.isSuccessfulCall},l)}},Object.values(M));return t},Mr=O()&&"FileList"in window,Hr=e=>({params:{},...e}),Gr=e=>({...lt,...e,destination:e&&e.destination?Hr(e.destination):null}),$r=e=>Mr&&e instanceof FileList||e.toString()==="[object FileList]",ce=function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,n=e;return j()||(t<3&&H(e)?n=C(e):t<3&&tt(e)&&(n=Array.isArray(e)?e.map(r=>ce(r,t+1)):Object.keys(e).reduce((r,s)=>(r[s]=ce(e[s],t+1),r),{}))),n};let Oe=0;const Vr=(e,t,n,r)=>{const s=r?Array.prototype.map.call(t,a=>Me(a)?a.file||a.url:a):[];return Promise.all(Array.prototype.map.call(t,(a,o)=>{const l=(r||it)(s[o],o,s);return ge(l)?l.then(c=>!!c&&a):!!l&&a})).then(a=>a.filter(Boolean).map(o=>sn(o,e,n)))},Qr=(e,t,n)=>{Oe+=1;const r=`batch-${Oe}`,s=$r(e),a=Array.isArray(e)||s?e:[e],o=!n.autoUpload;return Vr(r,a,o,n.fileFilter).then(l=>({id:r,uploaderId:t,items:l,state:o?I.PENDING:I.ADDED,completed:0,loaded:0,orgItemCount:l.length,additionalInfo:null}))},zr=(e,t,n,r)=>{const s=Lr(),a=Sr(n,e,t,s,r);return{abortBatch:o=>{a.abortBatch(o)},abort:o=>{o?a.abortItem(o):a.abortAll()},addNewBatch:(o,l)=>Qr(o,r,l).then(c=>{let h;if(c.items.length){const u=a.addBatch(c,l);h=a.runCancellable(g.BATCH_ADD,u,l).then(f=>(f?a.cancelBatch(u):(v(`uploady.uploader [${r}]: new items added - auto upload =
                       ${String(l.autoUpload)}`,u.items),l.autoUpload&&a.uploadBatch(u)),u))}else v(`uploady.uploader: no items to add. batch ${c.id} is empty. check fileFilter if this isn't intended`);return h||Promise.resolve(null)}),clearPendingBatches:()=>{a.clearPendingBatches()},processPendingBatches:o=>{a.uploadPendingBatches(o)}}},Wr=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(r){for(var s=arguments.length,a=new Array(s>1?s-1:0),o=1;o<s;o++)a[o-1]=arguments[o];return t.reduce((l,c)=>c(l,...a)||l,r)}},Xr=Object.values(g),Yr="Uploady - uploader extensions can only be registered by enhancers",Zr="Uploady - uploader extension by this name [%s] already exists";let oe=0;const Jr=e=>Wr(qe(),e),Kr=(e,t,n,r)=>{const s=t.enhancer?Jr(t.enhancer):qe();r(!0);const a=s(e,n);return r(!1),a||e},kr=e=>{oe+=1;const t=`uploader-${oe}`;let n=!1;const r={};v(`uploady.uploader: creating new instance (${t})`,{options:e,counter:oe});let s=Gr(e);const a=()=>{d.clearPendingBatches()},o=()=>Ue(s);let{trigger:l,target:c}=Ze({id:t,update:m=>(s=L({},s,m),c),add:(m,p)=>{const x=L({},s,p);return x.clearPendingOnAdd&&a(),d.addNewBatch(m,x).then(()=>{v("uploady.uploader: finished adding file data to be processed")})},upload:m=>{d.processPendingBatches(m)},abort:m=>{d.abort(m)},abortBatch:m=>{d.abortBatch(m)},getOptions:o,clearPending:a,registerExtension:(m,p)=>{w(n,Yr),w(!r[m],Zr,m),v(`uploady.uploader: registering extension: ${m.toString()}`,p),r[m]=p},getExtension:m=>r[m]},Xr,{canAddEvents:!1,canRemoveEvents:!1});const h=function(m){for(var p=arguments.length,x=new Array(p>1?p-1:0),R=1;R<p;R++)x[R-1]=arguments[R];const A=On(()=>x.map(ce));return l(m,A)},u=Vt(h),f=Kr(c,s,h,m=>{n=m}),d=zr(h,u,s,f.id);return _(f)},ct=Symbol.for("_rpldy-version_"),dt=()=>"1.6.0",ut=()=>O()?window:globalThis||process,ht=()=>ut()[ct],qr=()=>{ut()[ct]=dt()},es=()=>{const e=ht();return!!e&&e!==dt()},ft=P.createContext(null),Te="Uploady - Context. File input isn't available",ts=(e,t)=>{let n,r,s=!1;t?n=t:v("Uploady context - didn't receive input field ref - waiting for external ref");const a=()=>{var u;return(u=n)===null||u===void 0?void 0:u.current},o=()=>(n&&(s=!0),n),l=()=>s,c=()=>{const u=a();w(u,Te),u.removeEventListener("change",c);const f=r;r=null,h(u.files,f)},h=(u,f)=>{e.add(u,f)};return qr(),{hasUploader:()=>!!e,getInternalFileInput:o,setExternalFileInput:u=>{s=!0,n=u},getIsUsingExternalInput:l,showFileUpload:u=>{const f=a();w(f,Te),r=u,f.removeEventListener("change",c),f.addEventListener("change",c),f.value="",f.click()},upload:h,processPending:u=>{e.upload(u)},clearPending:()=>{e.clearPending()},setOptions:u=>{e.update(u)},getOptions:()=>e.getOptions(),getExtension:u=>e.getExtension(u),abort:u=>{e.abort(u)},abortBatch:u=>{e.abortBatch(u)},on:(u,f)=>e.on(u,f),once:(u,f)=>e.once(u,f),off:(u,f)=>e.off(u,f)}},ns="Uploady - Valid UploadyContext not found. Make sure you render inside <Uploady>",rs=`Uploady - Valid UploadyContext not found.
You may be using packages of different Uploady versions. <Uploady> and all other packages using the context provider must be of the same version: %s`,ss=e=>(w(!es(),rs,ht()),w(e&&e.hasUploader(),ns),e),te=()=>ss(E.useContext(ft)),mt=(e,t)=>{const n=te(),{on:r,off:s}=n;E.useEffect(()=>(r(e,t),()=>{s(e,t)}),[e,t,r,s])},pt=(e,t)=>(n,r)=>{const[s,a]=E.useState(null);let o=n,l=r;n&&!B(n)&&(l=n,o=void 0);const c=E.useCallback(function(h){if(!l||h.id===l){for(var u=arguments.length,f=new Array(u>1?u-1:0),d=1;d<u;d++)f[d-1]=arguments[d];a(t(h,...f)),B(o)&&o(h,...f)}},[o,l]);return mt(e,c),s},S=function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;return(n,r)=>{const s=E.useCallback(function(a){for(var o=arguments.length,l=new Array(o>1?o-1:0),c=1;c<o;c++)l[c-1]=arguments[c];return n&&(!t||!r||a.id===r)?n(a,...l):void 0},[n,r]);mt(e,s)}};S(g.BATCH_ADD,!1);const as=S(g.BATCH_START);S(g.BATCH_FINISH);S(g.BATCH_CANCEL);S(g.BATCH_ERROR);S(g.BATCH_FINALIZE);S(g.BATCH_ABORT);pt(g.BATCH_PROGRESS,e=>({...e}));S(g.ITEM_START);const os=S(g.ITEM_FINISH);S(g.ITEM_CANCEL);S(g.ITEM_ERROR);S(g.ITEM_ABORT);S(g.ITEM_FINALIZE);const ye=pt(g.ITEM_PROGRESS,e=>({...e}));S(g.REQUEST_PRE_SEND,!1);S(g.ALL_ABORT,!1);const is=Symbol.for("rpldy_component"),ls=e=>{e[is]=!0},cs=(e,t)=>{const n=E.useMemo(()=>(v("Uploady creating a new uploader instance",e),kr(e)),[e.enhancer]);return n.update(e),E.useEffect(()=>(t&&(v("Uploady setting event listeners",t),Object.entries(t).forEach(r=>{let[s,a]=r;n.on(s,a)})),()=>{t&&(v("Uploady removing event listeners",t),Object.entries(t).forEach(r=>{let[s,a]=r;return n.off(s,a)}))}),[t,n]),n},ds=e=>{const{listeners:t,debug:n,children:r,inputRef:s,...a}=e;$t(!!n),v("@@@@@@ Uploady Rendering @@@@@@",e);const o=cs(a,t),l=E.useMemo(()=>ts(o,s),[o,s]);return P.createElement(ft.Provider,{value:l},r)},us=e=>{const t=te();return e&&t.setOptions(e),t.getOptions()};function de(){return de=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},de.apply(this,arguments)}const gt=e=>{let{eventType:t,getIsValidEventData:n,getRequestData:r}=e;return s=>a=>{const o=te(),[l,c]=E.useState({updateRequest:null,requestData:null}),{id:h}=a;return E.useLayoutEffect(()=>{const u=function(){for(var f=arguments.length,d=new Array(f),m=0;m<f;m++)d[m]=arguments[m];return n(h,...d)===!0?new Promise(p=>{c({updateRequest:x=>{o.off(t,u),p(x)},requestData:r(...d)})}):void 0};return h&&o.on(t,u),()=>{h&&o.off(t,u)}},[o,h]),P.createElement(s,de({},a,l))}};gt({eventType:g.REQUEST_PRE_SEND,getIsValidEventData:(e,t)=>{let{items:n}=t;return!!n.find(r=>r.id===e)},getRequestData:e=>{let{items:t,options:n}=e;return{items:t,options:n}}});gt({eventType:g.BATCH_START,getIsValidEventData:(e,t)=>t.id===e,getRequestData:(e,t)=>({batch:e,items:e.items,options:t})});function ue(){return ue=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},ue.apply(this,arguments)}const vt=e=>{const t=(n,r)=>{const{showFileUpload:s}=te(),{id:a,className:o,text:l,children:c,extraProps:h,onClick:u,...f}=n,d=E.useRef();d.current=f;const m=E.useCallback(p=>{s(d.current),u==null||u(p)},[s,d,u]);return P.createElement(e,ue({ref:r,onClick:m,id:a,className:o,children:c||l||"Upload"},h))};return ls(t),E.forwardRef(t)};function he(){return he=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},he.apply(this,arguments)}vt(E.forwardRef((e,t)=>P.createElement("button",he({ref:t},e))));const G={IMAGE:"image",VIDEO:"video"},hs=_({rememberPreviousBatches:!1,loadFirstOnly:!1,maxPreviewImageSize:2e7,maxPreviewVideoSize:1e8,fallbackUrl:"",imageMimeTypes:["image/jpeg","image/webp","image/gif","image/png","image/apng","image/bmp","image/x-icon","image/svg+xml"],videoMimeTypes:["video/mp4","video/webm","video/ogg"],previewComponentProps:void 0}),fs=e=>({...hs,...e}),bt=(e,t)=>{let n=B(e)?e(t):e;return typeof n=="string"&&(n={url:n,name:t.name,type:G.IMAGE}),n},je=(e,t,n,r)=>{let s;return t&&~t.indexOf(r.type)&&(!n||r.size<=n)&&(s={url:URL.createObjectURL(r),name:r.name,type:e}),s},ms=(e,t)=>{let n=je(G.IMAGE,t.imageMimeTypes,t.maxPreviewImageSize||0,e);return n||(n=je(G.VIDEO,t.videoMimeTypes,t.maxPreviewVideoSize||0,e)),n},ps=(e,t,n,r)=>B(e)?e(t,n,r):e,gs=(e,t,n)=>{let r,s=!1;if(e.file){const a=e.file;r=ms(e.file,t),r||(r=bt(t.fallbackUrl,a),s=!0)}else r={url:e.url,name:e.url,type:G.IMAGE};return r&&{...r,id:e.id,isFallback:s,removePreview:()=>n(e.id)}},vs=(e,t)=>{const n=[];return t.forEach(r=>{const s=e.findIndex(a=>a.id===r.id);~s?e.splice(s,1,r):n.push(r)}),e.concat(n)},bs=(e,t,n)=>{let r=e;return n&&(r=e.map(s=>({...s,props:ps(n,t.find(a=>{let{id:o}=a;return o===s.id}),s.url,s.type)}))),r},Es=e=>t=>{const n=t.previewComponentProps,[r,s]=E.useState({previews:[],items:[]}),a=fs(t),o=E.useCallback(()=>{s({previews:[],items:[]})},[]),l=E.useCallback(h=>{s(u=>{let{previews:f,items:d}=u;return{previews:f.filter(m=>m.id!==h),items:d.filter(m=>m.id!==h)}})},[]);return e(h=>{const u=a.loadFirstOnly?h.items.slice(0,1):h.items,f=u.map(d=>gs(d,a,l)).filter(Boolean);s({previews:t.rememberPreviousBatches?vs(r.previews,f):f,items:t.rememberPreviousBatches?r.items.concat(u):u})}),{previews:E.useMemo(()=>bs(r.previews,r.items,n),[r,n]),clearPreviews:o,removeItemFromPreview:l}};function $(){return $=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},$.apply(this,arguments)}const xs=(e,t,n,r)=>e===G.VIDEO?P.createElement("video",$({key:t,src:t,controls:!0},n)):P.createElement("img",$({key:t,onError:r,src:t},n)),Is=(e,t,n,r,s)=>{E.useImperativeHandle(n,()=>({clear:t,removePreview:s}),[t,s]),E.useEffect(()=>{r&&r(e)},[e,r])},Ss=function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:as;const t=Es(e);return n=>{const{PreviewComponent:r,previewMethodsRef:s,onPreviewsChanged:a,...o}=n,{previews:l,clearPreviews:c,removeItemFromPreview:h}=t(o),u=E.useCallback(f=>{const d=f.currentTarget,m=bt(n.fallbackUrl,d.src);m&&(d.src=m.url)},[n.fallbackUrl]);return Is(l,c,s,a,h),l.map(f=>{const{id:d,url:m,type:p,name:x,isFallback:R,removePreview:A,props:y}=f;return r?P.createElement(r,$({key:d+m,id:d,url:m,type:p,name:x,isFallback:R,removePreview:A},y)):xs(p,m,y,u)})}},Rs=Ss();function W(){return W=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},W.apply(this,arguments)}const As="Uploady - Container for file input must be a valid dom element",Et=(e,t,n)=>P.createElement("input",W({},e,{name:t.inputFieldName,type:"file",ref:n})),Ps=(e,t,n,r,s)=>e&&t?Bt.createPortal(Et(n,r,s),e):null,ws=E.memo(E.forwardRef((e,t)=>{let{container:n,noPortal:r,...s}=e;const a=us(),o=n&&n.nodeType===1;return w(o||!O(),As),r?Et(s,a,t):Ps(n,o,s,a,t)})),Ns=e=>{const{multiple:t=!0,capture:n,accept:r,webkitdirectory:s,children:a,inputFieldContainer:o,customInput:l,fileInputId:c,noPortal:h=!1,...u}=e,f=l?null:o||(O()?document.body:null),d=E.useRef();return P.createElement(ds,W({},u,{inputRef:d}),l?null:P.createElement(ws,{container:f,multiple:t,capture:n,accept:r,webkitdirectory:s==null?void 0:s.toString(),style:{display:"none"},ref:d,id:c,noPortal:h}),a)},N=({controllerConfig:e={name:"image"},formgroupProps:t={},childrenProps:{uploadButton:n,type:r="thumbnail"}})=>{const{field:s,fieldState:{error:a}}=Dt(e),o=()=>{const[u,f]=E.useState(0);return ye(d=>{f(d.completed),console.log(`>>>>> (hook) File ${d.file.name} completed: ${d.completed}`)}),u===0||u===100?null:i.jsx(_t,{intent:"danger",value:u})},l=()=>{const[u,f]=E.useState("");return ye(d=>{f(d.file.name)}),i.jsx("div",{children:u})},c=vt(u=>n?i.jsx("button",{...u,children:n}):i.jsx(Be,{...u,style:{cursor:"pointer"},small:!0,children:"点击选择"})),h=()=>(os(u=>{console.log(`item ${u.id} finished uploading, response was: `,u.uploadResponse,u.uploadStatus)}),null);return i.jsx(Ct,{...t,helperText:a!=null&&a.message?a==null?void 0:a.message:t.helperText,intent:s.value?a?"danger":"success":"none",children:i.jsxs(Ns,{destination:{url:"http://localhost:3000/file/imgUpload"},inputFieldName:"img",children:[r==="thumbnail"?i.jsxs("div",{className:"flex gap-2",children:[i.jsxs("div",{className:"relative border",children:[i.jsx(Rs,{previewComponentProps:{className:"w-36 h-24 border cover"},fallbackUrl:"https://icon-library.net/images/image-placeholder-icon/image-placeholder-icon-6.jpg"}),i.jsx("div",{className:"absolute bottom-0 w-full",children:i.jsx(o,{})})]}),i.jsx(c,{})]}):i.jsxs("div",{children:[i.jsx(c,{}),i.jsxs("div",{className:"border",children:[i.jsx(l,{}),i.jsx("div",{className:"w-full",children:i.jsx(o,{})})]})]}),i.jsx(h,{})]})})},js=()=>{const{control:e}=Ft({mode:"all"});return i.jsx(Ut,{className:"h-full overflow-y-auto",children:i.jsxs("div",{className:"grid grid-cols-1 gap-2 px-2",children:[i.jsxs("div",{children:[i.jsx("h1",{className:"py-2 text-2xl",children:"依赖包：react-uploady"}),i.jsxs("table",{className:"my-2 text-center",children:[i.jsx("thead",{children:i.jsxs("tr",{className:"bg-slate-100",children:[i.jsx("th",{className:"border",children:"属性"}),i.jsx("th",{className:"border",children:"说明"}),i.jsx("th",{className:"border",children:"类型"}),i.jsx("th",{className:"border",children:"默认值"})]})}),i.jsxs("tbody",{children:[i.jsxs("tr",{children:[i.jsx("td",{className:"border",children:i.jsx("pre",{children:"uploadButton"})}),i.jsxs("td",{className:"border",children:["包含在一个",i.jsx("code",{children:"button"}),"中，定制入口样式"]}),i.jsx("td",{className:"border px-2",children:i.jsx("code",{className:"rounded-sm bg-gray-200 px-1",children:"ReactElement"})}),i.jsx("td",{className:"border p-2",children:i.jsx(Be,{small:!0,children:"点击选择"})})]}),i.jsxs("tr",{children:[i.jsx("td",{className:"border",children:i.jsx("pre",{children:"type"})}),i.jsx("td",{className:"border",children:"等待区显示类型"}),i.jsx("td",{className:"border px-2",children:i.jsx("code",{className:"rounded-sm bg-gray-200 px-1",children:'"fileName" | "thumbnail"'})}),i.jsx("td",{className:"border",children:'"fileName"'})]}),i.jsxs("tr",{children:[i.jsx("td",{className:"border",children:i.jsx("pre",{children:"crop"})}),i.jsx("td",{className:"border",children:"是否裁剪"}),i.jsx("td",{className:"border px-2",children:i.jsx("code",{className:"rounded-sm bg-gray-200 px-1",children:"boolean"})}),i.jsx("td",{className:"border",children:"false"})]}),i.jsxs("tr",{children:[i.jsx("td",{className:"border",children:i.jsx("pre",{children:"preview"})}),i.jsx("td",{className:"border",children:"是否预览"}),i.jsx("td",{className:"border px-2",children:i.jsx("code",{className:"rounded-sm bg-gray-200 px-1",children:"boolean"})}),i.jsx("td",{className:"border",children:"false"})]})]})]}),i.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[i.jsxs("div",{className:"border",children:[i.jsx("h1",{children:"单图片上传（无裁剪）"}),i.jsx("div",{className:"bg-slate-200 p-3",children:i.jsx(N,{controllerConfig:{name:"file",control:e,defaultValue:""},formgroupProps:{label:i.jsx("div",{children:"上传图片"}),labelInfo:i.jsx("div",{children:"(必填)"}),inline:!0},childrenProps:{}})})]}),i.jsxs("div",{className:"border",children:[i.jsx("h1",{children:"单图片上传（裁剪）"}),i.jsx("div",{className:"bg-slate-200 p-3",children:i.jsx(N,{controllerConfig:{name:"file",control:e,defaultValue:""},formgroupProps:{helperText:"填写说明：",label:i.jsx("div",{children:"上传图片"}),labelInfo:i.jsx("div",{children:"(必填)"}),inline:!0},childrenProps:{uploadButton:i.jsxs("div",{className:"flex h-24 w-36 flex-col items-center justify-center rounded border border-dashed border-gray-300 bg-white hover:border-blue-600 ",children:[i.jsx("div",{children:i.jsx(U,{icon:"ph:image",height:"1.5em"})}),i.jsx("div",{children:"选择"})]}),preview:!0}})})]}),i.jsxs("div",{className:"border",children:[i.jsx("h1",{children:"选择头像（单图裁剪固定比例及大小）"}),i.jsx("div",{className:"bg-slate-200 p-3",children:i.jsx(N,{controllerConfig:{name:"file",control:e,defaultValue:""},formgroupProps:{helperText:"填写说明：",label:i.jsx("div",{children:"上传图片"}),labelInfo:i.jsx("div",{children:"(必填)"}),inline:!0},childrenProps:{uploadButton:i.jsxs("div",{className:"flex h-24 w-36 flex-col items-center justify-center rounded border border-dashed border-gray-300 bg-white hover:border-blue-600 ",children:[i.jsx("div",{children:i.jsx(U,{icon:"ph:image",height:"1.5em"})}),i.jsx("div",{children:"选择"})]}),preview:!0}})})]}),i.jsxs("div",{className:"border",children:[i.jsx("h1",{children:"多图片上传（无裁剪）"}),i.jsx("div",{className:"bg-slate-200 p-3",children:i.jsx(N,{controllerConfig:{name:"file",control:e,defaultValue:""},formgroupProps:{helperText:"填写说明：",label:i.jsx("div",{children:"上传图片"}),labelInfo:i.jsx("div",{children:"(必填)"}),inline:!0},childrenProps:{uploadButton:i.jsxs("div",{className:"flex h-24 w-36 flex-col items-center justify-center rounded border border-dashed border-gray-300 bg-white hover:border-blue-600 ",children:[i.jsx("div",{children:i.jsx(U,{icon:"ph:image",height:"1.5em"})}),i.jsx("div",{children:"选择"})]}),preview:!0}})})]}),i.jsxs("div",{className:"border",children:[i.jsx("h1",{children:"多图片上传（裁剪）"}),i.jsx("div",{className:"bg-slate-200 p-3",children:i.jsx(N,{controllerConfig:{name:"file",control:e,defaultValue:""},formgroupProps:{helperText:"填写说明：",label:i.jsx("div",{children:"上传图片"}),labelInfo:i.jsx("div",{children:"(必填)"}),inline:!0},childrenProps:{uploadButton:i.jsxs("div",{className:"flex h-24 w-36 flex-col items-center justify-center rounded border border-dashed border-gray-300 bg-white hover:border-blue-600 ",children:[i.jsx("div",{children:i.jsx(U,{icon:"ph:image",height:"1.5em"})}),i.jsx("div",{children:"选择"})]}),preview:!0}})})]}),i.jsxs("div",{className:"border",children:[i.jsx("h1",{children:"图片视频上传（预览）"}),i.jsx("div",{className:"bg-slate-200 p-3",children:i.jsx(N,{controllerConfig:{name:"file",control:e,defaultValue:""},formgroupProps:{helperText:"填写说明：",label:i.jsx("div",{children:"上传图片"}),labelInfo:i.jsx("div",{children:"(必填)"}),inline:!0},childrenProps:{uploadButton:i.jsxs("div",{className:"flex h-24 w-36 flex-col items-center justify-center rounded border border-dashed border-gray-300 bg-white hover:border-blue-600 ",children:[i.jsx("div",{children:i.jsx(U,{icon:"ph:image",height:"1.5em"})}),i.jsx("div",{children:"选择"})]}),preview:!0}})})]}),i.jsxs("div",{className:"border",children:[i.jsx("h1",{children:"文件上传（进度条）"}),i.jsx("div",{className:"bg-slate-200 p-3",children:i.jsx(N,{controllerConfig:{name:"file",control:e,defaultValue:""},formgroupProps:{helperText:"填写说明：",label:i.jsx("div",{children:"上传图片"}),labelInfo:i.jsx("div",{children:"(必填)"}),inline:!0},childrenProps:{uploadButton:i.jsxs("div",{className:"flex h-24 w-36 flex-col items-center justify-center rounded border border-dashed border-gray-300 bg-white hover:border-blue-600 ",children:[i.jsx("div",{children:i.jsx(U,{icon:"ph:image",height:"1.5em"})}),i.jsx("div",{children:"选择"})]}),preview:!0}})})]})]})]}),i.jsxs("div",{children:[i.jsx("h1",{className:"py-2 text-2xl",children:"依赖包：react-filepond"}),i.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[i.jsxs("div",{className:"border",children:[i.jsx("h1",{children:"单图片上传（裁剪）"}),i.jsx("div",{className:"bg-slate-200 p-3",children:i.jsx(re,{controllerConfig:{name:"file",control:e,defaultValue:""},formgroupProps:{helperText:"填写说明：",label:i.jsx("div",{children:"单图片上传（裁剪）"}),labelInfo:i.jsx("div",{children:"(必填)"})},childrenProps:{text:"请选择要上传的图片",buttonText:"点击选择",small:!0}})})]}),i.jsxs("div",{className:"border",children:[i.jsx("h1",{children:"选择头像（单图裁剪固定比例及大小）"}),i.jsx("div",{className:"bg-slate-200 p-3",children:i.jsx(re,{controllerConfig:{name:"file",control:e,defaultValue:""},formgroupProps:{helperText:"填写说明：比例1：1；大小不超过120k",label:i.jsx("div",{children:"选择头像"}),labelInfo:i.jsx("div",{children:"(必填)"})},childrenProps:{text:"请选择图片",buttonText:"点击选择",small:!0}})})]})]})]}),i.jsxs("div",{children:[i.jsx("h1",{className:"py-2 text-2xl",children:"依赖包：react-dropzone-uploader"}),i.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[i.jsxs("div",{className:"border",children:[i.jsx("h1",{children:"图片视频上传（预览）"}),i.jsx("div",{className:"bg-slate-200 p-3",children:i.jsx(N,{controllerConfig:{name:"file",control:e,defaultValue:""},formgroupProps:{label:i.jsx("div",{children:"上传图片"}),labelInfo:i.jsx("div",{children:"(必填)"})},childrenProps:{preview:!0}})})]}),i.jsxs("div",{className:"border",children:[i.jsx("h1",{children:"文件上传（进度条）"}),i.jsx("div",{className:"bg-slate-200 p-3",children:i.jsx(re,{controllerConfig:{name:"file",control:e,defaultValue:""},formgroupProps:{helperText:"填写说明：",label:i.jsx("div",{children:"文件上传"}),labelInfo:i.jsx("div",{children:"(必填)"})},childrenProps:{text:"请选择要上传的文件",buttonText:"点击选择",small:!0}})})]}),i.jsxs("div",{className:"border",children:[i.jsx("h1",{children:"图片视频上传（预览）"}),i.jsx("div",{className:"bg-slate-200 p-3",children:i.jsx(N,{controllerConfig:{name:"file",control:e,defaultValue:""},formgroupProps:{label:i.jsx("div",{children:"上传图片"}),labelInfo:i.jsx("div",{children:"(必填)"}),inline:!0},childrenProps:{preview:!0}})})]})]})]})]})})};export{js as default};
